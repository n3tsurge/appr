<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1.0"/>
<title>AppInventory â€” Enterprise Registry</title>
<link rel="preconnect" href="https://fonts.googleapis.com"/>
<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&family=JetBrains+Mono:wght@400;500&display=swap" rel="stylesheet"/>
<script src="https://cdnjs.cloudflare.com/ajax/libs/vue/3.4.21/vue.global.prod.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/d3/7.9.0/d3.min.js"></script>
<style>
:root{
  --bg:#f5f7fa;--surface:#ffffff;--surface2:#f0f4f8;--surface3:#e4ecf4;
  --border:#d0dcea;--border2:#b0c8de;
  --text:#1a2a3a;--text-dim:#5a7a96;--text-bright:#003057;
  --holman-blue:#003057;--holman-fresh:#0069A7;--holman-green:#2C9942;
  --holman-neutral:#F3E8DA;
  --accent:#0069A7;--accent-dim:#003057;
  --blue:#003057;--green:#2C9942;--amber:#e08c00;--red:#c0392b;
  --purple:#5a4fcf;--pink:#c0396b;--orange:#d4650a;
  --degraded:#e08c00;--outage:#c0392b;--operational:#2C9942;
  --font-display:'Poppins',sans-serif;--font-body:'Poppins',sans-serif;--font-mono:'JetBrains Mono',monospace;
  --sidebar-w:228px;--header-h:56px;--radius:8px;--radius-lg:12px;
}
*,*::before,*::after{box-sizing:border-box;margin:0;padding:0}
body{background:var(--bg);color:var(--text);font-family:var(--font-body);font-size:14px;line-height:1.5;overflow:hidden;height:100vh;-webkit-font-smoothing:antialiased}
#app{display:flex;flex-direction:column;height:100vh}

/* HEADER */
.header{height:var(--header-h);background:#003057;border-bottom:none;display:flex;align-items:center;padding:0 20px;gap:16px;flex-shrink:0;z-index:100}
.logo{font-family:var(--font-display);font-weight:700;font-size:18px;color:#fff;letter-spacing:-0.3px;display:flex;align-items:center;gap:8px;white-space:nowrap}
.logo-badge{background:#2C9942;color:#fff;font-size:10px;font-weight:700;padding:2px 6px;border-radius:4px;font-family:var(--font-mono)}
.header-stats{display:flex;gap:14px;margin-left:auto;flex-wrap:nowrap}
.header-stat{display:flex;align-items:center;gap:5px;color:rgba(255,255,255,0.65);font-size:12px;font-family:var(--font-mono);white-space:nowrap}
.header-stat-num{color:#7fd4ff;font-weight:600}
.header-actions{display:flex;gap:8px;flex-shrink:0}

/* SIDEBAR */
.body-layout{display:flex;flex:1;overflow:hidden}
.sidebar{width:var(--sidebar-w);background:#003057;border-right:none;display:flex;flex-direction:column;flex-shrink:0;overflow-y:auto;padding:12px 0}
.nav-section-label{font-size:10px;font-weight:600;letter-spacing:1.5px;text-transform:uppercase;color:rgba(255,255,255,0.4);padding:8px 16px 4px;font-family:var(--font-mono)}
.nav-item{display:flex;align-items:center;gap:10px;padding:9px 16px;cursor:pointer;color:rgba(255,255,255,0.65);font-size:13px;font-weight:400;transition:all 0.15s;border-left:3px solid transparent;user-select:none}
.nav-item:hover{color:#fff;background:rgba(255,255,255,0.08)}
.nav-item.active{color:#fff;background:rgba(0,105,167,0.5);border-left-color:#2C9942}
.nav-icon{width:18px;height:18px;flex-shrink:0;display:flex;align-items:center;justify-content:center}
.nav-badge{margin-left:auto;background:rgba(255,255,255,0.1);color:rgba(255,255,255,0.55);font-size:10px;font-family:var(--font-mono);padding:1px 6px;border-radius:10px;border:1px solid rgba(255,255,255,0.15)}
.nav-item.active .nav-badge{background:#2C9942;color:#fff;border-color:#2C9942}
.nav-badge.has-incidents{background:#c0392b!important;color:#fff!important;border-color:#c0392b!important;animation:pulse-badge 1.5s ease-in-out infinite}
@keyframes pulse-badge{0%,100%{opacity:1}50%{opacity:.6}}

/* MAIN */
.main-content{flex:1;overflow:hidden;display:flex;flex-direction:column}
.view-header{padding:20px 24px 16px;border-bottom:2px solid var(--border);display:flex;align-items:center;gap:16px;flex-shrink:0}
.view-title{font-family:var(--font-display);font-size:20px;font-weight:700;color:#003057}
.view-subtitle{font-size:12px;color:var(--text-dim);margin-top:2px}

/* IMPACT BANNER */
.impact-banner{background:#fff3cd;border-bottom:2px solid #e08c00;padding:8px 24px;display:flex;align-items:center;gap:10px;flex-shrink:0}
.impact-banner.outage{background:#fde8e8;border-bottom-color:#c0392b}
.impact-banner-icon{font-size:16px}
.impact-banner-text{font-size:13px;font-weight:500;color:#5a3800}
.impact-banner.outage .impact-banner-text{color:#7a0000}
.impact-banner-chips{display:flex;gap:6px;flex-wrap:wrap;margin-left:8px}

/* ENTITY LAYOUT */
.entity-layout{display:flex;flex:1;overflow:hidden}
.entity-list{width:360px;flex-shrink:0;border-right:1px solid var(--border);overflow-y:auto;display:flex;flex-direction:column}
.entity-list-toolbar{padding:12px 16px;border-bottom:1px solid var(--border);display:flex;gap:8px;align-items:center;flex-shrink:0}
.search-input{flex:1;background:#f0f4f8;border:1px solid #d0dcea;border-radius:var(--radius);color:#1a2a3a;padding:6px 12px;font-family:var(--font-body);font-size:13px;outline:none;transition:border-color 0.15s}
.search-input:focus{border-color:#0069A7}
.search-input::placeholder{color:var(--text-dim)}
.entity-card{padding:12px 16px;border-bottom:1px solid var(--border);cursor:pointer;transition:background 0.1s;display:flex;flex-direction:column;gap:4px;border-left:3px solid transparent}
.entity-card:hover{background:var(--surface2)}
.entity-card.selected{background:#e8f4fb;border-left-color:#0069A7}
.entity-card.degraded{border-left-color:#e08c00}
.entity-card.outage{border-left-color:#c0392b}
.entity-card-name{font-weight:500;color:#1a2a3a;font-size:13px;display:flex;align-items:center;gap:8px;flex-wrap:wrap}
.entity-card-meta{font-size:11px;color:var(--text-dim);font-family:var(--font-mono);display:flex;gap:10px;flex-wrap:wrap;align-items:center}
.entity-detail{flex:1;overflow-y:auto;padding:24px}
.empty-state{flex:1;display:flex;align-items:center;justify-content:center;flex-direction:column;gap:12px;color:#5a7a96}
.empty-state-icon{font-size:48px;opacity:0.3}
.empty-list{padding:32px 16px;text-align:center;color:var(--text-dim);font-size:13px}

/* DETAIL */
.detail-header{display:flex;align-items:flex-start;justify-content:space-between;margin-bottom:24px}
.detail-title{font-family:var(--font-display);font-size:22px;font-weight:700;color:#003057;display:flex;align-items:center;gap:10px;flex-wrap:wrap}
.detail-id{font-family:var(--font-mono);font-size:11px;color:var(--text-dim);margin-top:4px}
.detail-actions{display:flex;gap:8px;flex-shrink:0}
.detail-section{margin-bottom:24px}
.detail-section-title{font-size:10px;font-weight:600;letter-spacing:1.5px;text-transform:uppercase;color:var(--text-dim);margin-bottom:12px;padding-bottom:8px;border-bottom:1px solid var(--border);font-family:var(--font-mono)}
.detail-grid{display:grid;grid-template-columns:150px 1fr;gap:8px 16px}
.detail-label{font-size:12px;color:var(--text-dim);padding-top:2px}
.detail-value{font-size:13px;color:var(--text)}
.detail-value.mono{font-family:var(--font-mono);font-size:12px;word-break:break-all}

/* IMPACT PANEL */
.impact-panel{border-radius:var(--radius);padding:14px 16px;margin-bottom:20px}
.impact-panel.degraded{background:#fff8e6;border:1.5px solid #e08c00}
.impact-panel.outage{background:#fdeaea;border:1.5px solid #c0392b}
.impact-panel-title{font-size:12px;font-weight:600;margin-bottom:8px;display:flex;align-items:center;gap:6px}
.impact-panel.degraded .impact-panel-title{color:#7a4800}
.impact-panel.outage .impact-panel-title{color:#7a0000}

/* BADGES */
.badge{display:inline-flex;align-items:center;padding:2px 8px;border-radius:4px;font-size:11px;font-weight:600;font-family:var(--font-mono);border:1px solid;white-space:nowrap}
/* Service type */
.badge-api{background:rgba(0,105,167,.1);color:#0069A7;border-color:rgba(0,105,167,.3)}
.badge-web_application{background:rgba(44,153,66,.1);color:#2C9942;border-color:rgba(44,153,66,.3)}
.badge-database{background:rgba(224,140,0,.1);color:#e08c00;border-color:rgba(224,140,0,.3)}
.badge-message_queue{background:rgba(90,79,207,.1);color:#5a4fcf;border-color:rgba(90,79,207,.3)}
.badge-cache{background:rgba(192,57,107,.1);color:#c0396b;border-color:rgba(192,57,107,.3)}
.badge-infrastructure{background:rgba(90,122,150,.1);color:#5a7a96;border-color:rgba(90,122,150,.3)}
/* Component type */
.badge-library{background:rgba(212,101,10,.1);color:#d4650a;border-color:rgba(212,101,10,.3)}
.badge-microservice{background:rgba(192,57,59,.1);color:#c0392b;border-color:rgba(192,57,59,.3)}
.badge-sdk{background:rgba(100,180,30,.1);color:#4a9010;border-color:rgba(100,180,30,.3)}
.badge-agent{background:rgba(90,79,207,.1);color:#5a4fcf;border-color:rgba(90,79,207,.3)}
.badge-ui_component{background:rgba(212,101,10,.1);color:#d4650a;border-color:rgba(212,101,10,.3)}
/* Resource type */
.badge-ec2{background:rgba(255,153,0,.1);color:#c07000;border-color:rgba(255,153,0,.3)}
.badge-virtual_machine{background:rgba(0,120,212,.1);color:#0078d4;border-color:rgba(0,120,212,.3)}
.badge-logic_app{background:rgba(128,0,255,.1);color:#7800c8;border-color:rgba(128,0,255,.3)}
.badge-storage_account{background:rgba(0,164,239,.1);color:#0069A7;border-color:rgba(0,164,239,.3)}
.badge-container_instance{background:rgba(0,153,204,.1);color:#007a9e;border-color:rgba(0,153,204,.3)}
.badge-kubernetes{background:rgba(50,108,229,.1);color:#2c60c8;border-color:rgba(50,108,229,.3)}
.badge-function_app{background:rgba(255,185,0,.12);color:#9a6800;border-color:rgba(255,185,0,.35)}
.badge-load_balancer{background:rgba(44,153,66,.1);color:#2C9942;border-color:rgba(44,153,66,.3)}
.badge-api_gateway{background:rgba(0,48,87,.1);color:#003057;border-color:rgba(0,48,87,.3)}
.badge-cdn{background:rgba(90,79,207,.1);color:#5a4fcf;border-color:rgba(90,79,207,.3)}
/* Status */
.badge-active{background:rgba(44,153,66,.1);color:#2C9942;border-color:rgba(44,153,66,.3)}
.badge-deprecated{background:rgba(192,57,59,.1);color:#c0392b;border-color:rgba(192,57,59,.3)}
.badge-maintenance{background:rgba(224,140,0,.1);color:#e08c00;border-color:rgba(224,140,0,.3)}
.badge-planned{background:rgba(90,79,207,.1);color:#5a4fcf;border-color:rgba(90,79,207,.3)}
.badge-product{background:rgba(0,48,87,.1);color:#003057;border-color:rgba(0,48,87,.3)}
/* Operational status */
.badge-operational{background:rgba(44,153,66,.1);color:#2C9942;border-color:rgba(44,153,66,.3)}
.badge-degraded{background:rgba(224,140,0,.12);color:#7a4800;border-color:rgba(224,140,0,.4);animation:badge-pulse-amber .5s ease-in-out infinite alternate}
.badge-outage{background:rgba(192,57,59,.12);color:#7a0000;border-color:rgba(192,57,59,.4);animation:badge-pulse-red .5s ease-in-out infinite alternate}
@keyframes badge-pulse-amber{from{background:rgba(224,140,0,.12)}to{background:rgba(224,140,0,.22)}}
@keyframes badge-pulse-red{from{background:rgba(192,57,59,.12)}to{background:rgba(192,57,59,.22)}}

/* RELATION CHIPS */
.relation-list{display:flex;flex-wrap:wrap;gap:6px}
.relation-chip{display:inline-flex;align-items:center;gap:6px;padding:4px 10px;background:var(--surface2);border:1px solid var(--border);border-radius:6px;font-size:12px;cursor:pointer;transition:border-color 0.15s}
.relation-chip:hover{border-color:#0069A7;color:#0069A7}
.relation-chip.chip-degraded{border-color:#e08c00;background:#fff8e6}
.relation-chip.chip-outage{border-color:#c0392b;background:#fdeaea}

/* BUTTONS */
.btn{display:inline-flex;align-items:center;gap:6px;padding:7px 14px;border-radius:var(--radius);font-size:13px;font-weight:500;cursor:pointer;border:1px solid transparent;transition:all 0.15s;font-family:var(--font-body);outline:none;white-space:nowrap}
.btn-primary{background:#0069A7;color:#fff;border-color:#0069A7}
.btn-primary:hover{background:#003057;border-color:#003057}
.btn-secondary{background:var(--surface2);color:var(--text);border-color:var(--border)}
.btn-secondary:hover{background:var(--surface3);border-color:var(--border2)}
.btn-danger{background:rgba(192,57,59,.08);color:#c0392b;border-color:rgba(192,57,59,.3)}
.btn-danger:hover{background:rgba(192,57,59,.16)}
.btn-warning{background:rgba(224,140,0,.1);color:#7a4800;border-color:rgba(224,140,0,.4)}
.btn-warning:hover{background:rgba(224,140,0,.2)}
.btn-outage{background:rgba(192,57,59,.1);color:#7a0000;border-color:rgba(192,57,59,.4)}
.btn-outage:hover{background:rgba(192,57,59,.2)}
.btn-success{background:rgba(44,153,66,.1);color:#1a6b2a;border-color:rgba(44,153,66,.4)}
.btn-success:hover{background:rgba(44,153,66,.2)}
.btn-ghost{background:transparent;color:#5a7a96;border-color:transparent;padding:7px 10px}
.btn-ghost:hover{color:#003057;background:#e8f0f7}
.btn-sm{padding:4px 10px;font-size:12px}

/* MODAL */
.modal-overlay{position:fixed;inset:0;background:rgba(0,48,87,.45);backdrop-filter:blur(4px);z-index:1000;display:flex;align-items:center;justify-content:center;padding:24px}
.modal{background:#fff;border:1px solid var(--border2);border-radius:var(--radius-lg);width:100%;max-width:700px;max-height:88vh;overflow-y:auto;box-shadow:0 24px 80px rgba(0,0,0,.2)}
.modal-header{padding:20px 24px 16px;border-bottom:1px solid var(--border);display:flex;align-items:center;justify-content:space-between;position:sticky;top:0;background:#fff;z-index:1}
.modal-title{font-family:var(--font-display);font-size:17px;font-weight:700;color:#003057}
.modal-body{padding:20px 24px}
.modal-footer{padding:16px 24px;border-top:1px solid var(--border);display:flex;justify-content:flex-end;gap:8px;position:sticky;bottom:0;background:#fff}

/* FORMS */
.form-group{margin-bottom:16px}
.form-label{display:block;font-size:12px;font-weight:500;color:var(--text-dim);margin-bottom:6px;letter-spacing:.3px}
.form-control{width:100%;background:#f0f4f8;border:1px solid #d0dcea;border-radius:var(--radius);color:#1a2a3a;padding:8px 12px;font-family:var(--font-body);font-size:13px;outline:none;transition:border-color .15s;appearance:none}
.form-control:focus{border-color:#0069A7;box-shadow:0 0 0 3px rgba(0,105,167,.12)}
.form-control::placeholder{color:var(--text-dim)}
select.form-control{cursor:pointer;background-image:url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='12' height='12' viewBox='0 0 12 12'%3E%3Cpath fill='%230069A7' d='M6 8L1 3h10z'/%3E%3C/svg%3E");background-repeat:no-repeat;background-position:right 12px center;padding-right:32px}
select.form-control option{background:#fff;color:#1a2a3a}
textarea.form-control{resize:vertical;min-height:76px}
.form-check{display:flex;align-items:center;gap:8px;cursor:pointer}
.form-check input[type="checkbox"]{width:16px;height:16px;accent-color:#0069A7;cursor:pointer}
.form-row{display:grid;grid-template-columns:1fr 1fr;gap:16px}
.form-section-title{font-size:10px;font-weight:600;letter-spacing:1.5px;text-transform:uppercase;color:#0069A7;margin:8px 0 12px;font-family:var(--font-mono)}
.multi-select-container{background:#f0f4f8;border:1px solid #d0dcea;border-radius:var(--radius);max-height:150px;overflow-y:auto}
.multi-select-item{display:flex;align-items:center;gap:8px;padding:7px 12px;cursor:pointer;transition:background .1s;font-size:13px}
.multi-select-item:hover{background:#e8f0f7}
.multi-select-item input[type="checkbox"]{accent-color:#0069A7;flex-shrink:0}

/* OPERATIONAL STATUS SELECTOR */
.opstatus-picker{display:flex;gap:8px}
.opstatus-option{flex:1;padding:8px;border:2px solid var(--border);border-radius:var(--radius);cursor:pointer;text-align:center;font-size:12px;font-weight:600;transition:all .15s;opacity:.6}
.opstatus-option:hover{opacity:.8}
.opstatus-option.selected{opacity:1;border-width:2px}
.opstatus-option.opt-operational.selected{border-color:#2C9942;background:rgba(44,153,66,.1);color:#2C9942}
.opstatus-option.opt-degraded.selected{border-color:#e08c00;background:rgba(224,140,0,.12);color:#7a4800}
.opstatus-option.opt-outage.selected{border-color:#c0392b;background:rgba(192,57,59,.12);color:#7a0000}

/* DASHBOARD */
.dashboard-grid{display:grid;grid-template-columns:repeat(4,1fr);gap:16px;padding:24px}
.stat-card{background:#fff;border:1px solid var(--border);border-radius:var(--radius-lg);padding:20px;position:relative;overflow:hidden}
.stat-card::before{content:'';position:absolute;top:0;left:0;right:0;height:3px}
.stat-card.c-blue::before{background:#003057}
.stat-card.c-cyan::before{background:#0069A7}
.stat-card.c-green::before{background:#2C9942}
.stat-card.c-amber::before{background:#e08c00}
.stat-card.c-red::before{background:#c0392b}
.stat-num{font-family:var(--font-display);font-size:36px;font-weight:800;line-height:1.2;margin-bottom:4px;padding-top:2px}
.stat-label{font-size:12px;color:var(--text-dim);font-weight:500}
.stat-sub{font-size:11px;color:var(--text-dim);margin-top:8px;font-family:var(--font-mono)}
.progress-bar{height:4px;background:var(--surface3);border-radius:2px;margin-top:6px;overflow:hidden}
.progress-fill{height:100%;border-radius:2px;transition:width .4s}
.dash-body{overflow-y:auto;flex:1}

/* GRAPH */
.graph-view{flex:1;display:flex;flex-direction:column;overflow:hidden}
.graph-toolbar{padding:12px 20px;border-bottom:1px solid var(--border);display:flex;gap:8px;align-items:center;flex-shrink:0;flex-wrap:wrap}
.graph-container{flex:1;position:relative;overflow:hidden}
.graph-legend{position:absolute;bottom:16px;left:16px;background:rgba(255,255,255,.96);border:1px solid var(--border);border-radius:var(--radius);padding:12px;display:flex;flex-direction:column;gap:5px;backdrop-filter:blur(8px);max-height:calc(100% - 32px);overflow-y:auto}
.legend-title{font-size:10px;font-weight:600;letter-spacing:1px;text-transform:uppercase;color:#5a7a96;margin-bottom:2px;font-family:var(--font-mono)}
.legend-item{display:flex;align-items:center;gap:8px;font-size:11px;color:#1a2a3a}
.legend-dot{width:10px;height:10px;border-radius:50%;flex-shrink:0}
.legend-divider{border-top:1px solid var(--border);margin:4px 0}
.graph-tooltip{position:absolute;background:#fff;border:1px solid var(--border2);border-radius:var(--radius);padding:10px 14px;font-size:12px;pointer-events:none;opacity:0;transition:opacity .15s;max-width:240px;z-index:100;box-shadow:0 8px 32px rgba(0,0,0,.12)}
.graph-tooltip.visible{opacity:1}
.graph-tooltip-name{font-weight:600;color:#003057;margin-bottom:3px}
.graph-tooltip-type{color:var(--text-dim);font-family:var(--font-mono);font-size:11px}
.graph-tooltip-status{font-size:11px;margin-top:4px;padding:2px 6px;border-radius:3px;display:inline-block;font-weight:600}
.graph-tooltip-status.degraded{background:#fff3cd;color:#7a4800}
.graph-tooltip-status.outage{background:#fdeaea;color:#7a0000}
.graph-hint{position:absolute;top:12px;right:12px;font-size:11px;color:var(--text-dim);font-family:var(--font-mono);background:rgba(255,255,255,.9);padding:6px 10px;border-radius:6px;border:1px solid var(--border)}
.filter-tabs{display:flex;gap:4px;flex-wrap:wrap}
.filter-tab{padding:4px 10px;border-radius:4px;font-size:11px;font-family:var(--font-mono);cursor:pointer;border:1px solid var(--border);background:var(--surface2);color:var(--text-dim);transition:all .15s;user-select:none}
.filter-tab.active{border-color:#0069A7;color:#0069A7;background:rgba(0,105,167,.08)}

/* MISC */
.owner-avatar{width:28px;height:28px;border-radius:50%;background:linear-gradient(135deg,#003057,#0069A7);display:flex;align-items:center;justify-content:center;font-size:11px;font-weight:700;color:#fff;flex-shrink:0}
.fade-enter-active,.fade-leave-active{transition:opacity .15s}
.fade-enter-from,.fade-leave-to{opacity:0}
::-webkit-scrollbar{width:6px;height:6px}
::-webkit-scrollbar-track{background:transparent}
::-webkit-scrollbar-thumb{background:#b0c8de;border-radius:3px}
::-webkit-scrollbar-thumb:hover{background:#0069A7}

/* GRAPH PULSE ANIMATIONS */
@keyframes pulse-degraded{0%,100%{r:var(--pulse-r);opacity:.7}50%{r:calc(var(--pulse-r) + 6px);opacity:.2}}
@keyframes pulse-outage{0%,100%{r:var(--pulse-r);opacity:.9}50%{r:calc(var(--pulse-r) + 8px);opacity:.1}}

/* INCIDENTS */
.badge-investigating{background:rgba(192,57,59,.1);color:#c0392b;border-color:rgba(192,57,59,.3)}
.badge-identified{background:rgba(224,140,0,.1);color:#e08c00;border-color:rgba(224,140,0,.3)}
.badge-monitoring{background:rgba(0,105,167,.1);color:#0069A7;border-color:rgba(0,105,167,.3)}
.badge-resolved{background:rgba(44,153,66,.1);color:#2C9942;border-color:rgba(44,153,66,.3)}
.badge-critical{background:rgba(192,57,59,.15);color:#c0392b;border-color:rgba(192,57,59,.4)}
.badge-major{background:rgba(224,140,0,.15);color:#7a4800;border-color:rgba(224,140,0,.4)}
.badge-minor{background:rgba(90,122,150,.12);color:#5a7a96;border-color:rgba(90,122,150,.35)}
.incident-card.active-incident{border-left-color:#c0392b}
.incident-card.resolved-incident{opacity:.7}

/* TIMELINE */
.timeline{border-left:2px solid var(--border);padding-left:16px;margin:8px 0}
.timeline-entry{position:relative;padding-bottom:14px}
.timeline-entry::before{content:'';position:absolute;left:-21px;top:4px;width:10px;height:10px;border-radius:50%;background:var(--accent);border:2px solid #fff}
.timeline-entry.resolved::before{background:#2C9942}
.timeline-entry:last-child{padding-bottom:0}
.timeline-time{font-size:11px;color:var(--text-dim);font-family:var(--font-mono)}
.timeline-text{font-size:13px;color:var(--text);margin-top:2px}
.timeline-add{display:flex;gap:8px;margin-top:12px}
.timeline-add input{flex:1}

/* REPOSITORIES */
.badge-github{background:rgba(26,26,26,.08);color:#1a1a1a;border-color:rgba(26,26,26,.25)}
.badge-gitlab{background:rgba(252,109,38,.1);color:#c45a14;border-color:rgba(252,109,38,.3)}
.badge-azure_devops{background:rgba(0,105,167,.1);color:#0069A7;border-color:rgba(0,105,167,.3)}
.badge-bitbucket{background:rgba(0,82,204,.1);color:#0052cc;border-color:rgba(0,82,204,.3)}
.repo-link{font-family:var(--font-mono);font-size:12px;color:#0069A7;text-decoration:none;word-break:break-all}
.repo-link:hover{text-decoration:underline}

/* TEAMS */
.badge-team{background:rgba(0,48,87,.1);color:#003057;border-color:rgba(0,48,87,.3)}
.team-avatar{width:28px;height:28px;border-radius:6px;background:linear-gradient(135deg,#0069A7,#003057);display:flex;align-items:center;justify-content:center;font-size:11px;font-weight:700;color:#fff;flex-shrink:0}
.role-chip{display:inline-flex;align-items:center;gap:4px;padding:3px 8px;background:var(--surface2);border:1px solid var(--border);border-radius:4px;font-size:11px;font-family:var(--font-mono);color:var(--text-dim)}
.role-chip .role-name{color:var(--text);font-weight:500}
.assignment-row{display:flex;align-items:center;gap:8px;padding:8px 0;border-bottom:1px solid var(--surface2);font-size:13px}
.assignment-row:last-child{border-bottom:none}

/* SCORECARDS */
.scorecard-grade{display:inline-flex;align-items:center;justify-content:center;width:36px;height:36px;border-radius:8px;font-size:16px;font-weight:700;font-family:var(--font-mono);flex-shrink:0}
.scorecard-grade.grade-a{background:rgba(44,153,66,.15);color:#1a7a2e;border:2px solid rgba(44,153,66,.4)}
.scorecard-grade.grade-b{background:rgba(0,105,167,.12);color:#0069A7;border:2px solid rgba(0,105,167,.35)}
.scorecard-grade.grade-c{background:rgba(224,140,0,.12);color:#7a4800;border:2px solid rgba(224,140,0,.4)}
.scorecard-grade.grade-d{background:rgba(210,100,40,.12);color:#8a3500;border:2px solid rgba(210,100,40,.4)}
.scorecard-grade.grade-f{background:rgba(192,57,59,.1);color:#7a0000;border:2px solid rgba(192,57,59,.35)}
.scorecard-mini{display:flex;align-items:center;gap:8px;padding:8px 12px;background:var(--surface2);border:1px solid var(--border);border-radius:var(--radius);cursor:pointer;transition:all .15s}
.scorecard-mini:hover{background:var(--bg);border-color:#0069A7}
.scorecard-mini-grade{width:26px;height:26px;border-radius:5px;font-size:12px;font-weight:700;font-family:var(--font-mono);display:flex;align-items:center;justify-content:center;flex-shrink:0}
.scorecard-bar{height:6px;border-radius:3px;background:var(--surface2);overflow:hidden;flex:1}
.scorecard-bar-fill{height:100%;border-radius:3px;transition:width .3s ease}
.scorecard-bar-fill.fill-a{background:#2C9942}
.scorecard-bar-fill.fill-b{background:#0069A7}
.scorecard-bar-fill.fill-c{background:#e08c00}
.scorecard-bar-fill.fill-d{background:#d26428}
.scorecard-bar-fill.fill-f{background:#c0392b}
.criteria-row{display:flex;align-items:center;gap:10px;padding:10px 0;border-bottom:1px solid var(--surface2);font-size:13px}
.criteria-row:last-child{border-bottom:none}
.criteria-icon{width:20px;height:20px;border-radius:50%;display:flex;align-items:center;justify-content:center;flex-shrink:0;font-size:11px}
.criteria-icon.pass{background:rgba(44,153,66,.15);color:#2C9942}
.criteria-icon.fail{background:rgba(192,57,59,.1);color:#c0392b}
.scorecard-entity-row{display:flex;align-items:center;gap:10px;padding:10px 12px;border:1px solid var(--border);border-radius:var(--radius);margin-bottom:6px;cursor:pointer;transition:all .15s}
.scorecard-entity-row:hover{background:var(--surface2);border-color:#0069A7}
.scorecard-pct{font-size:12px;font-weight:600;font-family:var(--font-mono);min-width:38px;text-align:right}

/* PRODUCT GRAPH */
.product-graph-container{border:1px solid var(--border);border-radius:var(--radius-lg);overflow:hidden;position:relative;background:#f5f7fa;margin-bottom:24px}
.product-graph-container svg{display:block}
.product-graph-header{display:flex;align-items:center;justify-content:space-between;padding:10px 14px;background:#fff;border-bottom:1px solid var(--border)}
.product-graph-title{font-size:10px;font-weight:600;letter-spacing:1.5px;text-transform:uppercase;color:var(--text-dim);font-family:var(--font-mono)}

/* STATUS PAGE */
.status-page{overflow-y:auto;flex:1;padding:0}
.status-banner{padding:24px 32px;text-align:center;border-bottom:2px solid var(--border)}
.status-banner.all-ok{background:linear-gradient(135deg,rgba(44,153,66,.08),rgba(44,153,66,.02));border-bottom-color:#2C9942}
.status-banner.has-issues{background:linear-gradient(135deg,rgba(224,140,0,.08),rgba(224,140,0,.02));border-bottom-color:#e08c00}
.status-banner.has-outage{background:linear-gradient(135deg,rgba(192,57,59,.08),rgba(192,57,59,.02));border-bottom-color:#c0392b}
.status-banner-icon{font-size:42px;margin-bottom:8px}
.status-banner-text{font-family:var(--font-display);font-size:22px;font-weight:700}
.status-banner.all-ok .status-banner-text{color:#2C9942}
.status-banner.has-issues .status-banner-text{color:#7a4800}
.status-banner.has-outage .status-banner-text{color:#7a0000}
.status-banner-sub{font-size:12px;color:var(--text-dim);margin-top:4px;font-family:var(--font-mono)}
.status-product{background:#fff;border:1px solid var(--border);border-radius:var(--radius-lg);margin:12px 24px;overflow:hidden;transition:box-shadow .15s}
.status-product:hover{box-shadow:0 4px 16px rgba(0,0,0,.06)}
.status-product-header{display:flex;align-items:center;gap:12px;padding:14px 18px;cursor:pointer;user-select:none}
.status-product-indicator{width:12px;height:12px;border-radius:50%;flex-shrink:0}
.status-product-indicator.operational{background:#2C9942}
.status-product-indicator.degraded{background:#e08c00;animation:pulse-indicator 1.5s ease-in-out infinite}
.status-product-indicator.outage{background:#c0392b;animation:pulse-indicator 1s ease-in-out infinite}
@keyframes pulse-indicator{0%,100%{opacity:1;transform:scale(1)}50%{opacity:.5;transform:scale(1.3)}}
.status-product-name{font-family:var(--font-display);font-weight:600;font-size:15px;color:#003057;flex:1}
.status-product-badge{font-size:11px;font-weight:600;font-family:var(--font-mono);padding:3px 10px;border-radius:4px}
.status-product-badge.operational{background:rgba(44,153,66,.1);color:#2C9942;border:1px solid rgba(44,153,66,.3)}
.status-product-badge.degraded{background:rgba(224,140,0,.12);color:#7a4800;border:1px solid rgba(224,140,0,.4)}
.status-product-badge.outage{background:rgba(192,57,59,.12);color:#7a0000;border:1px solid rgba(192,57,59,.4)}
.status-product-chevron{color:var(--text-dim);transition:transform .2s;font-size:14px}
.status-product-chevron.open{transform:rotate(180deg)}
.status-services-list{border-top:1px solid var(--border);padding:8px 18px 14px}
.status-service-row{display:flex;align-items:center;gap:10px;padding:8px 0;border-bottom:1px solid var(--surface2)}
.status-service-row:last-child{border-bottom:none}
.status-service-dot{width:8px;height:8px;border-radius:50%;flex-shrink:0}
.status-service-dot.operational{background:#2C9942}
.status-service-dot.degraded{background:#e08c00}
.status-service-dot.outage{background:#c0392b}
.status-service-name{font-size:13px;color:var(--text);flex:1}
.status-service-type{font-size:11px;color:var(--text-dim);font-family:var(--font-mono)}
.status-service-status{font-size:11px;font-weight:600;font-family:var(--font-mono);padding:2px 8px;border-radius:4px}
.status-incident-banner{margin:0 24px 12px;padding:12px 16px;background:#fdeaea;border:1px solid rgba(192,57,59,.3);border-radius:var(--radius);display:flex;align-items:center;gap:10px}
.status-incident-banner.warn{background:#fff8e6;border-color:rgba(224,140,0,.4)}
</style>
</head>
<body>
<div id="app">
  <header class="header">
    <div class="logo">
      <svg width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="#7fd4ff" stroke-width="2.5"><path d="M12 2L2 7l10 5 10-5-10-5z"/><path d="M2 17l10 5 10-5"/><path d="M2 12l10 5 10-5"/></svg>
      AppInventory
      <span class="logo-badge">HOLMAN</span>
    </div>
    <div class="header-stats">
      <div class="header-stat"><span>Products</span><span class="header-stat-num">{{ inventory.products.length }}</span></div>
      <div class="header-stat" style="color:rgba(255,255,255,.2)">Â·</div>
      <div class="header-stat"><span>Services</span><span class="header-stat-num">{{ inventory.services.length }}</span></div>
      <div class="header-stat" style="color:rgba(255,255,255,.2)">Â·</div>
      <div class="header-stat"><span>Components</span><span class="header-stat-num">{{ inventory.components.length }}</span></div>
      <div class="header-stat" style="color:rgba(255,255,255,.2)">Â·</div>
      <div class="header-stat"><span>Resources</span><span class="header-stat-num">{{ inventory.resources.length }}</span></div>
      <div class="header-stat" style="color:rgba(255,255,255,.2)">Â·</div>
      <div class="header-stat"><span>Repos</span><span class="header-stat-num">{{ inventory.repositories.length }}</span></div>
      <div class="header-stat" v-if="activeIncidents.length" style="color:rgba(255,255,255,.2)">Â·</div>
      <div class="header-stat" v-if="activeIncidents.length"><span style="color:#ff6b6b">Incidents</span><span class="header-stat-num" style="color:#ff6b6b">{{ activeIncidents.length }}</span></div>
    </div>
    <div class="header-actions">
      <button class="btn btn-secondary btn-sm" style="background:rgba(255,255,255,.1);color:#fff;border-color:rgba(255,255,255,.2)" @click="triggerImport">
        <svg width="13" height="13" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><path d="M21 15v4a2 2 0 01-2 2H5a2 2 0 01-2-2v-4M7 10l5 5 5-5M12 15V3"/></svg>Import
      </button>
      <button class="btn btn-secondary btn-sm" style="background:rgba(255,255,255,.1);color:#fff;border-color:rgba(255,255,255,.2)" @click="exportJSON">
        <svg width="13" height="13" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><path d="M21 15v4a2 2 0 01-2 2H5a2 2 0 01-2-2v-4M17 8l-5-5-5 5M12 3v12"/></svg>Export
      </button>
      <button class="btn btn-primary btn-sm" @click="loadSampleData">Load Sample Data</button>
    </div>
    <input type="file" ref="fileInput" accept=".json" style="display:none" @change="handleImport"/>
  </header>

  <div class="body-layout">
    <nav class="sidebar">
      <div class="nav-section-label">Overview</div>
      <div class="nav-item" :class="{active:currentView==='dashboard'}" @click="navigate('dashboard')">
        <div class="nav-icon"><svg width="15" height="15" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><rect x="3" y="3" width="7" height="7" rx="1"/><rect x="14" y="3" width="7" height="7" rx="1"/><rect x="3" y="14" width="7" height="7" rx="1"/><rect x="14" y="14" width="7" height="7" rx="1"/></svg></div>
        Dashboard
        <span v-if="incidentCount>0" class="nav-badge has-incidents">{{ incidentCount }}</span>
      </div>
      <div class="nav-item" :class="{active:currentView==='graph'}" @click="navigate('graph')">
        <div class="nav-icon"><svg width="15" height="15" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><circle cx="12" cy="5" r="2"/><circle cx="5" cy="19" r="2"/><circle cx="19" cy="19" r="2"/><path d="M12 7v4M5.5 17.5l5.5-4M18.5 17.5L13 13.5"/></svg></div>
        Dependency Graph
      </div>
      <div class="nav-item" :class="{active:currentView==='status'}" @click="navigate('status')">
        <div class="nav-icon"><svg width="15" height="15" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><path d="M22 12h-4l-3 9L9 3l-3 9H2"/></svg></div>
        Status Page
        <span v-if="statusPageHasIssues" class="nav-badge has-incidents">!</span>
      </div>
      <div class="nav-item" :class="{active:currentView==='scorecards'}" @click="navigate('scorecards')">
        <div class="nav-icon"><svg width="15" height="15" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><path d="M9 11l3 3L22 4"/><path d="M21 12v7a2 2 0 01-2 2H5a2 2 0 01-2-2V5a2 2 0 012-2h11"/></svg></div>
        Scorecards<span class="nav-badge">{{ inventory.scorecards.length }}</span>
      </div>
      <div class="nav-item" :class="{active:currentView==='incidents'}" @click="navigate('incidents')">
        <div class="nav-icon"><svg width="15" height="15" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><path d="M10.29 3.86L1.82 18a2 2 0 001.71 3h16.94a2 2 0 001.71-3L13.71 3.86a2 2 0 00-3.42 0z"/><line x1="12" y1="9" x2="12" y2="13"/><line x1="12" y1="17" x2="12.01" y2="17"/></svg></div>
        Incidents
        <span v-if="activeIncidents.length" class="nav-badge has-incidents">{{ activeIncidents.length }}</span>
        <span v-else class="nav-badge">{{ inventory.incidents.length }}</span>
      </div>
      <div class="nav-section-label" style="margin-top:8px">Catalog</div>
      <div class="nav-item" :class="{active:currentView==='products'}" @click="navigate('products')">
        <div class="nav-icon"><svg width="15" height="15" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><path d="M21 16V8a2 2 0 00-1-1.73l-7-4a2 2 0 00-2 0l-7 4A2 2 0 003 8v8a2 2 0 001 1.73l7 4a2 2 0 002 0l7-4A2 2 0 0021 16z"/></svg></div>
        Products<span class="nav-badge">{{ inventory.products.length }}</span>
      </div>
      <div class="nav-item" :class="{active:currentView==='services'}" @click="navigate('services')">
        <div class="nav-icon"><svg width="15" height="15" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><path d="M5 12.55a11 11 0 0114.08 0"/><path d="M1.42 9a16 16 0 0121.16 0"/><path d="M8.53 16.11a6 6 0 016.95 0"/><circle cx="12" cy="20" r="1"/></svg></div>
        Services<span class="nav-badge">{{ inventory.services.length }}</span>
      </div>
      <div class="nav-item" :class="{active:currentView==='components'}" @click="navigate('components')">
        <div class="nav-icon"><svg width="15" height="15" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><polyline points="16 18 22 12 16 6"/><polyline points="8 6 2 12 8 18"/></svg></div>
        Components<span class="nav-badge">{{ inventory.components.length }}</span>
      </div>
      <div class="nav-item" :class="{active:currentView==='resources'}" @click="navigate('resources')">
        <div class="nav-icon"><svg width="15" height="15" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><rect x="2" y="3" width="20" height="14" rx="2"/><path d="M8 21h8M12 17v4"/></svg></div>
        Resources<span class="nav-badge">{{ inventory.resources.length }}</span>
      </div>
      <div class="nav-item" :class="{active:currentView==='repositories'}" @click="navigate('repositories')">
        <div class="nav-icon"><svg width="15" height="15" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><path d="M9 19c-5 1.5-5-2.5-7-3m14 6v-3.87a3.37 3.37 0 00-.94-2.61c3.14-.35 6.44-1.54 6.44-7A5.44 5.44 0 0020 4.77 5.07 5.07 0 0019.91 1S18.73.65 16 2.48a13.38 13.38 0 00-7 0C6.27.65 5.09 1 5.09 1A5.07 5.07 0 005 4.77a5.44 5.44 0 00-1.5 3.78c0 5.42 3.3 6.61 6.44 7A3.37 3.37 0 009 18.13V22"/></svg></div>
        Repositories<span class="nav-badge">{{ inventory.repositories.length }}</span>
      </div>
      <div class="nav-section-label" style="margin-top:8px">Organization</div>
      <div class="nav-item" :class="{active:currentView==='teams'}" @click="navigate('teams')">
        <div class="nav-icon"><svg width="15" height="15" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><path d="M17 21v-2a4 4 0 00-4-4H5a4 4 0 00-4 4v2"/><circle cx="9" cy="7" r="4"/><path d="M23 21v-2a4 4 0 00-3-3.87M16 3.13a4 4 0 010 7.75"/></svg></div>
        Teams<span class="nav-badge">{{ inventory.teams.length }}</span>
      </div>
      <div class="nav-item" :class="{active:currentView==='people'}" @click="navigate('people')">
        <div class="nav-icon"><svg width="15" height="15" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><path d="M20 21v-2a4 4 0 00-4-4H8a4 4 0 00-4 4v2"/><circle cx="12" cy="7" r="4"/></svg></div>
        People<span class="nav-badge">{{ inventory.owners.length }}</span>
      </div>
    </nav>

    <main class="main-content">

      <!-- DASHBOARD -->
      <div v-if="currentView==='dashboard'" class="dash-body">
        <!-- Impact banner -->
        <div v-if="outageItems.length" class="impact-banner outage">
          <span class="impact-banner-icon">ðŸ”´</span>
          <span class="impact-banner-text">{{ outageItems.length }} OUTAGE{{ outageItems.length>1?'S':'' }} ACTIVE</span>
          <div class="impact-banner-chips">
            <span v-for="e in outageItems" :key="e.id" class="badge badge-outage" style="cursor:pointer" @click="navigateTo(e)">{{ e.name }}</span>
          </div>
        </div>
        <div v-else-if="degradedItems.length" class="impact-banner">
          <span class="impact-banner-icon">ðŸŸ¡</span>
          <span class="impact-banner-text">{{ degradedItems.length }} DEGRADED</span>
          <div class="impact-banner-chips">
            <span v-for="e in degradedItems" :key="e.id" class="badge badge-degraded" style="cursor:pointer" @click="navigateTo(e)">{{ e.name }}</span>
          </div>
        </div>

        <div class="view-header">
          <div><div class="view-title">Dashboard</div><div class="view-subtitle">Enterprise application inventory overview</div></div>
        </div>
        <div class="dashboard-grid">
          <div class="stat-card c-blue"><div class="stat-num" style="color:#003057">{{ inventory.products.length }}</div><div class="stat-label">Products</div><div class="stat-sub">{{ activeCount('products') }} active</div></div>
          <div class="stat-card c-cyan"><div class="stat-num" style="color:#0069A7">{{ inventory.services.length }}</div><div class="stat-label">Services</div><div class="stat-sub">{{ Object.keys(servicesByType).length }} types</div></div>
          <div class="stat-card c-green"><div class="stat-num" style="color:#2C9942">{{ inventory.components.length }}</div><div class="stat-label">Components</div><div class="stat-sub">{{ Object.keys(componentsByType).length }} types</div></div>
          <div class="stat-card" :class="incidentCount>0?'c-red':'c-amber'">
            <div class="stat-num" :style="'color:'+(incidentCount>0?'#c0392b':'#003057')">{{ inventory.resources.length }}</div>
            <div class="stat-label">Resources</div>
            <div class="stat-sub" :style="incidentCount>0?'color:#c0392b;font-weight:600':''">{{ incidentCount>0?incidentCount+' incident(s)':inventory.owners.length+' owner(s)' }}</div>
          </div>
        </div>

        <!-- Incident summary -->
        <div v-if="incidentCount>0" style="padding:0 24px 16px">
          <div class="stat-card c-red">
            <div class="detail-section-title">âš¡ Active Incidents & Upstream Impact</div>
            <div v-for="e in [...outageItems,...degradedItems]" :key="e.id" style="padding:10px 0;border-bottom:1px solid var(--border)">
              <div style="display:flex;align-items:center;gap:8px;margin-bottom:6px">
                <span :class="'badge badge-'+e.operationalStatus">{{ e.operationalStatus.toUpperCase() }}</span>
                <span :class="'badge badge-'+e.type">{{ getTypeLabel(e) }}</span>
                <strong style="color:#003057;font-size:13px">{{ e.name }}</strong>
                <button class="btn btn-ghost btn-sm" style="margin-left:auto" @click="navigateTo(e)">View â†’</button>
              </div>
              <div v-if="getUpstreamImpacts(e.id, e._entityType).length" style="font-size:12px;color:#5a7a96;display:flex;align-items:center;gap:6px;flex-wrap:wrap">
                <svg width="12" height="12" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><polyline points="18 15 12 9 6 15"/></svg>
                Upstream impact:
                <span v-for="u in getUpstreamImpacts(e.id, e._entityType)" :key="u.id" :class="'badge badge-'+u.operationalStatus+''" style="cursor:pointer" @click="navigateTo(u)">{{ u.name }}</span>
              </div>
            </div>
          </div>
        </div>

        <!-- Active Incident Entities -->
        <div v-if="activeIncidents.length" style="padding:0 24px 16px">
          <div class="stat-card c-red">
            <div class="detail-section-title">ðŸš¨ Active Incident Tracker</div>
            <div v-for="inc in activeIncidents" :key="inc.id" style="padding:10px 0;border-bottom:1px solid var(--border)">
              <div style="display:flex;align-items:center;gap:8px;margin-bottom:6px">
                <span :class="'badge badge-'+inc.severity">{{ inc.severity }}</span>
                <span :class="'badge badge-'+inc.status">{{ inc.status }}</span>
                <strong style="color:#003057;font-size:13px">{{ inc.title }}</strong>
                <button class="btn btn-ghost btn-sm" style="margin-left:auto" @click="navigate('incidents');selectItem('incidents',inc)">View â†’</button>
              </div>
              <div v-if="inc.description" style="font-size:12px;color:#5a7a96;margin-bottom:4px">{{ inc.description }}</div>
              <div style="font-size:11px;color:var(--text-dim);font-family:var(--font-mono)">Created {{ formatDate(inc.createdAt) }} Â· {{ (inc.affectedEntityIds||[]).length }} affected entities</div>
            </div>
          </div>
        </div>

        <div style="padding:0 24px 24px;display:grid;grid-template-columns:1fr 1fr;gap:16px">
          <div class="stat-card">
            <div class="detail-section-title">Services by Type</div>
            <div v-if="!inventory.services.length" style="color:var(--text-dim);font-size:12px">No services yet</div>
            <div v-for="(count,type) in servicesByType" :key="type" style="margin-bottom:10px">
              <div style="display:flex;justify-content:space-between;align-items:center"><span :class="'badge badge-'+type">{{ typeLabels.service[type] }}</span><span style="font-family:var(--font-mono);font-size:11px;color:var(--text-dim)">{{ count }}</span></div>
              <div class="progress-bar"><div class="progress-fill" :style="{width:(count/inventory.services.length*100)+'%',background:typeColors.service[type]}"></div></div>
            </div>
          </div>
          <div class="stat-card">
            <div class="detail-section-title">Resources by Type</div>
            <div v-if="!inventory.resources.length" style="color:var(--text-dim);font-size:12px">No resources yet</div>
            <div v-for="(count,type) in resourcesByType" :key="type" style="margin-bottom:10px">
              <div style="display:flex;justify-content:space-between;align-items:center"><span :class="'badge badge-'+type">{{ typeLabels.resource[type] }}</span><span style="font-family:var(--font-mono);font-size:11px;color:var(--text-dim)">{{ count }}</span></div>
              <div class="progress-bar"><div class="progress-fill" :style="{width:(count/inventory.resources.length*100)+'%',background:typeColors.resource[type]}"></div></div>
            </div>
          </div>
        </div>

        <!-- Scorecard Summary -->
        <div v-if="inventory.scorecards.length" style="padding:0 24px 24px">
          <div class="stat-card">
            <div class="detail-section-title" style="display:flex;align-items:center;gap:8px">
              <svg width="16" height="16" fill="none" stroke="#003057" stroke-width="2" viewBox="0 0 24 24"><path d="M9 11l3 3L22 4"/><path d="M21 12v7a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11"/></svg>
              Scorecard Overview
              <button class="btn btn-ghost btn-sm" style="margin-left:auto" @click="navigate('scorecards')">View All â†’</button>
            </div>
            <div style="display:grid;grid-template-columns:repeat(auto-fill,minmax(260px,1fr));gap:12px;margin-top:8px">
              <div v-for="sc in inventory.scorecards" :key="sc.id" class="scorecard-entity-row" @click="navigate('scorecards');selectItem('scorecards',sc)" style="cursor:pointer">
                <span :class="'scorecard-mini-grade grade-'+scorecardOverallGrade(sc).toLowerCase()">{{ scorecardOverallGrade(sc) }}</span>
                <div style="flex:1;min-width:0">
                  <div style="font-weight:600;font-size:12px;color:#003057;white-space:nowrap;overflow:hidden;text-overflow:ellipsis">{{ sc.name }}</div>
                  <div style="display:flex;align-items:center;gap:8px;margin-top:4px">
                    <div class="scorecard-bar" style="flex:1"><div :class="'scorecard-bar-fill fill-'+scorecardOverallGrade(sc).toLowerCase()" :style="{width:scorecardOverallPct(sc)+'%'}"></div></div>
                    <span class="scorecard-pct">{{ scorecardOverallPct(sc) }}%</span>
                  </div>
                  <div style="font-size:10px;color:var(--text-dim);margin-top:2px">{{ (sc.criteria||[]).length }} criteria Â· {{ (sc.entityTypes||[]).join(', ') }}</div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- GRAPH -->
      <div v-if="currentView==='graph'" class="graph-view">
        <div class="view-header">
          <div><div class="view-title">Dependency Graph</div><div class="view-subtitle">Click nodes to navigate Â· Degraded/outage nodes pulse</div></div>
        </div>
        <div class="graph-toolbar">
          <span style="font-size:11px;color:var(--text-dim);font-family:var(--font-mono);white-space:nowrap">Show:</span>
          <div class="filter-tabs">
            <div class="filter-tab" :class="{active:graphFilters.includes('product')}" @click="toggleGraphFilter('product')">Products</div>
            <div class="filter-tab" :class="{active:graphFilters.includes('service')}" @click="toggleGraphFilter('service')">Services</div>
            <div class="filter-tab" :class="{active:graphFilters.includes('component')}" @click="toggleGraphFilter('component')">Components</div>
            <div class="filter-tab" :class="{active:graphFilters.includes('resource')}" @click="toggleGraphFilter('resource')">Resources</div>
            <div class="filter-tab" :class="{active:graphFilters.includes('incidents_only')}" @click="toggleGraphFilter('incidents_only')" style="border-color:#e08c00;color:#7a4800">âš¡ Incidents Only</div>
          </div>
          <div style="display:flex;gap:8px;margin-left:auto">
            <button class="btn btn-secondary btn-sm" @click="resetGraphZoom">âŠ• Fit</button>
            <button class="btn btn-secondary btn-sm" @click="initGraph">â†º Reshuffle</button>
          </div>
        </div>
        <div class="graph-container" ref="graphContainer">
          <svg id="graph-svg" ref="graphSvg"></svg>
          <div class="graph-hint">Drag nodes Â· Scroll to zoom Â· Click to navigate</div>
          <div class="graph-legend">
            <div class="legend-title">Node Types</div>
            <div class="legend-item"><div class="legend-dot" style="background:#003057"></div>Product</div>
            <div class="legend-item"><div class="legend-dot" style="background:#0069A7"></div>API Service</div>
            <div class="legend-item"><div class="legend-dot" style="background:#2C9942"></div>Web App</div>
            <div class="legend-item"><div class="legend-dot" style="background:#e08c00"></div>Database</div>
            <div class="legend-item"><div class="legend-dot" style="background:#5a4fcf"></div>Queue</div>
            <div class="legend-item"><div class="legend-dot" style="background:#c0396b"></div>Cache</div>
            <div class="legend-item"><div class="legend-dot" style="background:#d4650a"></div>Components</div>
            <div class="legend-item"><div class="legend-dot" style="background:#c07000;border-radius:3px"></div>Resources</div>
            <div class="legend-divider"></div>
            <div class="legend-title">Status</div>
            <div class="legend-item"><div style="width:12px;height:12px;border-radius:50%;border:2px solid #e08c00;background:rgba(224,140,0,.2)"></div>Degraded</div>
            <div class="legend-item"><div style="width:12px;height:12px;border-radius:50%;border:2px solid #c0392b;background:rgba(192,57,59,.2)"></div>Outage</div>
            <div class="legend-divider"></div>
            <div class="legend-title">Edges</div>
            <div class="legend-item"><svg width="24" height="8"><line x1="0" y1="4" x2="24" y2="4" stroke="#00305750" stroke-width="2"/></svg>Composition</div>
            <div class="legend-item"><svg width="24" height="8"><line x1="0" y1="4" x2="24" y2="4" stroke="#2C994260" stroke-width="1.5" stroke-dasharray="4,3"/></svg>Dependency</div>
            <div class="legend-item"><svg width="24" height="8"><line x1="0" y1="4" x2="24" y2="4" stroke="#c0700050" stroke-width="1.5" stroke-dasharray="2,3"/></svg>Runs On</div>
          </div>
          <div class="graph-tooltip" ref="graphTooltip">
            <div class="graph-tooltip-name" ref="tooltipName"></div>
            <div class="graph-tooltip-type" ref="tooltipType"></div>
            <div ref="tooltipStatus"></div>
            <div ref="tooltipOwner" style="font-size:11px;color:var(--text-dim);margin-top:2px"></div>
          </div>
        </div>
      </div>

      <!-- PRODUCTS -->
      <div v-if="currentView==='products'" style="display:flex;flex-direction:column;flex:1;overflow:hidden">
        <div class="view-header">
          <div><div class="view-title">Products</div><div class="view-subtitle">Top-level business products and solutions</div></div>
          <button class="btn btn-primary" style="margin-left:auto" @click="openCreateForm('products')">+ Add Product</button>
        </div>
        <div class="entity-layout">
          <div class="entity-list">
            <div class="entity-list-toolbar"><input class="search-input" v-model="searchQuery" placeholder="Search productsâ€¦"/></div>
            <div v-if="!filteredProducts.length" class="empty-list">No products found</div>
            <div v-for="p in filteredProducts" :key="p.id" class="entity-card" :class="{selected:selectedId===p.id}" @click="selectItem('products',p)">
              <div class="entity-card-name"><span :class="'badge badge-'+(p.status||'active')">{{ p.status||'active' }}</span>{{ p.name }}</div>
              <div class="entity-card-meta"><span>{{ teamName(p.teamId) }}</span><span>{{ (p.serviceIds||[]).length }} service(s)</span>
                <span v-if="productImpactStatus(p)" :class="'badge badge-'+productImpactStatus(p)">{{ productImpactStatus(p) }}</span>
              </div>
            </div>
          </div>
          <div class="entity-detail" v-if="selectedEntity && currentView==='products'">
            <!-- Impact panel -->
            <div v-if="productImpactStatus(selectedEntity)" :class="'impact-panel '+productImpactStatus(selectedEntity)">
              <div class="impact-panel-title">âš ï¸ {{ productImpactStatus(selectedEntity)==='outage'?'Outage':'Degradation' }} â€” Upstream impact from dependent services</div>
              <div class="relation-list">
                <span v-for="s in impactedServicesForProduct(selectedEntity)" :key="s.id" :class="'badge badge-'+s.operationalStatus">{{ s.name }}: {{ s.operationalStatus }}</span>
              </div>
            </div>
            <div class="detail-header">
              <div><div class="detail-title">{{ selectedEntity.name }}</div><div class="detail-id">ID: {{ selectedEntity.id }}</div></div>
              <div class="detail-actions"><button class="btn btn-secondary" @click="openEditForm('products',selectedEntity)">Edit</button><button class="btn btn-danger" @click="deleteItem('products',selectedEntity.id)">Delete</button></div>
            </div>
            <div class="detail-section">
              <div class="detail-section-title">Details</div>
              <div class="detail-grid">
                <span class="detail-label">Status</span><span class="detail-value"><span :class="'badge badge-'+(selectedEntity.status||'active')">{{ selectedEntity.status||'active' }}</span></span>
                <span class="detail-label">Team</span><span class="detail-value">{{ teamName(selectedEntity.teamId) }}</span>
                <span class="detail-label">Version</span><span class="detail-value mono">{{ selectedEntity.version||'â€”' }}</span>
                <span class="detail-label">Description</span><span class="detail-value">{{ selectedEntity.description||'â€”' }}</span>
                <span class="detail-label">Tags</span><span class="detail-value">{{ (selectedEntity.tags||[]).join(', ')||'â€”' }}</span>
              </div>
            </div>
            <div class="detail-section" v-if="selectedEntity.assignments && selectedEntity.assignments.length">
              <div class="detail-section-title">Assignments</div>
              <div v-for="a in selectedEntity.assignments" :key="a.personId+a.role" class="assignment-row">
                <div class="owner-avatar">{{ ownerInitials(findPerson(a.personId)) }}</div>
                <span style="font-weight:500">{{ findPerson(a.personId).name }}</span>
                <span class="role-chip">{{ a.role }}</span>
              </div>
            </div>
            <div class="detail-section" v-if="entityScorecards('products').length">
              <div class="detail-section-title">Scorecards</div>
              <div v-for="sc in entityScorecards('products')" :key="sc.id" class="scorecard-mini" @click="navigate('scorecards');$nextTick(()=>selectItem('scorecards',sc))" style="margin-bottom:6px">
                <span :class="'scorecard-mini-grade scorecard-grade grade-'+entityGrade(sc,selectedEntity).toLowerCase()">{{ entityGrade(sc,selectedEntity) }}</span>
                <div style="flex:1;min-width:0">
                  <div style="font-size:12px;font-weight:600;color:var(--text)">{{ sc.name }}</div>
                  <div style="display:flex;align-items:center;gap:8px;margin-top:4px">
                    <div class="scorecard-bar"><div :class="'scorecard-bar-fill fill-'+entityGrade(sc,selectedEntity).toLowerCase()" :style="'width:'+entityScorePct(sc,selectedEntity)+'%'"></div></div>
                    <span class="scorecard-pct" :style="'color:'+gradeColor(entityGrade(sc,selectedEntity))">{{ entityScorePct(sc,selectedEntity) }}%</span>
                  </div>
                </div>
                <div style="display:flex;gap:3px">
                  <span v-for="c in sc.criteria" :key="c.id" :class="'criteria-icon '+(evaluateCriterion(c,selectedEntity)?'pass':'fail')" :title="c.name">{{ evaluateCriterion(c,selectedEntity)?'âœ“':'âœ—' }}</span>
                </div>
              </div>
            </div>
            <!-- Product Dependency Graph -->
            <div class="detail-section">
              <div class="product-graph-container">
                <div class="product-graph-header">
                  <span class="product-graph-title">Dependency Map</span>
                  <button class="btn btn-ghost btn-sm" @click="initProductGraph(selectedEntity)">â†º Refresh</button>
                </div>
                <div :ref="'productGraphContainer'" style="height:340px;position:relative">
                  <svg :ref="'productGraphSvg'"></svg>
                </div>
              </div>
            </div>
            <div class="detail-section">
              <div class="detail-section-title">Services ({{ (selectedEntity.serviceIds||[]).length }})</div>
              <div class="relation-list">
                <div v-for="s in productServices" :key="s.id" :class="'relation-chip'+(s.operationalStatus&&s.operationalStatus!=='operational'?' chip-'+s.operationalStatus:'')" @click="navigate('services');selectItem('services',s)">
                  <span :class="'badge badge-'+s.type">{{ typeLabels.service[s.type] }}</span>{{ s.name }}
                  <span v-if="s.operationalStatus&&s.operationalStatus!=='operational'" :class="'badge badge-'+s.operationalStatus">{{ s.operationalStatus }}</span>
                </div>
                <span v-if="!productServices.length" style="color:var(--text-dim);font-size:12px">No services assigned</span>
              </div>
            </div>
          </div>
          <div class="empty-state" v-else><div class="empty-state-icon">ðŸ“¦</div><div style="color:#5a7a96;font-size:14px">Select a product to view details</div></div>
        </div>
      </div>

      <!-- SERVICES -->
      <div v-if="currentView==='services'" style="display:flex;flex-direction:column;flex:1;overflow:hidden">
        <div class="view-header">
          <div><div class="view-title">Services</div><div class="view-subtitle">APIs, web applications, databases, queues, and more</div></div>
          <button class="btn btn-primary" style="margin-left:auto" @click="openCreateForm('services')">+ Add Service</button>
        </div>
        <div class="entity-layout">
          <div class="entity-list">
            <div class="entity-list-toolbar">
              <input class="search-input" v-model="searchQuery" placeholder="Search servicesâ€¦"/>
              <select class="form-control" style="width:120px;flex-shrink:0" v-model="typeFilter"><option value="">All types</option><option v-for="(label,type) in typeLabels.service" :key="type" :value="type">{{ label }}</option></select>
            </div>
            <div v-if="!filteredServices.length" class="empty-list">No services found</div>
            <div v-for="s in filteredServices" :key="s.id" class="entity-card" :class="{selected:selectedId===s.id,...(s.operationalStatus&&s.operationalStatus!=='operational'?{[s.operationalStatus]:true}:{})}" @click="selectItem('services',s)">
              <div class="entity-card-name"><span :class="'badge badge-'+s.type">{{ typeLabels.service[s.type] }}</span>{{ s.name }}</div>
              <div class="entity-card-meta">
                <span>{{ teamName(s.teamId) }}</span>
                <span :class="'badge badge-'+(s.status||'active')" style="font-size:10px">{{ s.status||'active' }}</span>
                <span v-if="s.operationalStatus&&s.operationalStatus!=='operational'" :class="'badge badge-'+s.operationalStatus">{{ s.operationalStatus }}</span>
              </div>
            </div>
          </div>
          <div class="entity-detail" v-if="selectedEntity && currentView==='services'">
            <!-- Impact panel for degraded/outage -->
            <div v-if="selectedEntity.operationalStatus && selectedEntity.operationalStatus!=='operational'" :class="'impact-panel '+selectedEntity.operationalStatus" style="margin-bottom:20px">
              <div class="impact-panel-title">
                {{ selectedEntity.operationalStatus==='outage'?'ðŸ”´ OUTAGE':'ðŸŸ¡ DEGRADED' }} â€” {{ selectedEntity.name }}
              </div>
              <div style="font-size:12px;margin-bottom:8px" :style="selectedEntity.operationalStatus==='outage'?'color:#7a0000':'color:#7a4800'">
                Upstream products impacted:
              </div>
              <div class="relation-list" style="margin-bottom:8px">
                <span v-for="p in serviceProducts" :key="p.id" class="badge badge-product" style="cursor:pointer" @click="navigate('products');selectItem('products',p)">{{ p.name }}</span>
                <span v-if="!serviceProducts.length" style="font-size:12px;color:var(--text-dim)">None</span>
              </div>
              <div style="font-size:12px;margin-bottom:8px" :style="selectedEntity.operationalStatus==='outage'?'color:#7a0000':'color:#7a4800'">
                Downstream services depending on this:
              </div>
              <div class="relation-list">
                <span v-for="ds in downstreamDependentServices" :key="ds.id" :class="'badge badge-'+ds.type" style="cursor:pointer" @click="selectItem('services',ds)">{{ ds.name }}</span>
                <span v-if="!downstreamDependentServices.length" style="font-size:12px;color:var(--text-dim)">None</span>
              </div>
            </div>
            <div class="detail-header">
              <div>
                <div class="detail-title">{{ selectedEntity.name }}
                  <span v-if="selectedEntity.operationalStatus&&selectedEntity.operationalStatus!=='operational'" :class="'badge badge-'+selectedEntity.operationalStatus">{{ selectedEntity.operationalStatus }}</span>
                </div>
                <div class="detail-id">ID: {{ selectedEntity.id }}</div>
              </div>
              <div class="detail-actions">
                <button v-if="selectedEntity.operationalStatus==='operational'||!selectedEntity.operationalStatus" class="btn btn-warning btn-sm" @click="setOpStatus('services', selectedEntity, 'degraded')">Mark Degraded</button>
                <button v-if="selectedEntity.operationalStatus==='operational'||!selectedEntity.operationalStatus" class="btn btn-outage btn-sm" @click="setOpStatus('services', selectedEntity, 'outage')">Mark Outage</button>
                <button v-if="selectedEntity.operationalStatus&&selectedEntity.operationalStatus!=='operational'" class="btn btn-success btn-sm" @click="setOpStatus('services', selectedEntity, 'operational')">âœ“ Resolve</button>
                <button class="btn btn-secondary" @click="openEditForm('services',selectedEntity)">Edit</button>
                <button class="btn btn-danger" @click="deleteItem('services',selectedEntity.id)">Delete</button>
              </div>
            </div>
            <div class="detail-section">
              <div class="detail-section-title">Details</div>
              <div class="detail-grid">
                <span class="detail-label">Type</span><span class="detail-value"><span :class="'badge badge-'+selectedEntity.type">{{ typeLabels.service[selectedEntity.type] }}</span></span>
                <span class="detail-label">Status</span><span class="detail-value"><span :class="'badge badge-'+(selectedEntity.status||'active')">{{ selectedEntity.status||'active' }}</span></span>
                <span class="detail-label">Operational</span><span class="detail-value"><span :class="'badge badge-'+(selectedEntity.operationalStatus||'operational')">{{ selectedEntity.operationalStatus||'operational' }}</span></span>
                <span class="detail-label">Team</span><span class="detail-value">{{ teamName(selectedEntity.teamId) }}</span>
                <span class="detail-label">Description</span><span class="detail-value">{{ selectedEntity.description||'â€”' }}</span>
              </div>
            </div>
            <div class="detail-section" v-if="selectedEntity.assignments && selectedEntity.assignments.length">
              <div class="detail-section-title">Assignments</div>
              <div v-for="a in selectedEntity.assignments" :key="a.personId+a.role" class="assignment-row">
                <div class="owner-avatar">{{ ownerInitials(findPerson(a.personId)) }}</div>
                <span style="font-weight:500">{{ findPerson(a.personId).name }}</span>
                <span class="role-chip">{{ a.role }}</span>
              </div>
            </div>
            <div class="detail-section" v-if="entityScorecards('services').length">
              <div class="detail-section-title">Scorecards</div>
              <div v-for="sc in entityScorecards('services')" :key="sc.id" class="scorecard-mini" @click="navigate('scorecards');$nextTick(()=>selectItem('scorecards',sc))" style="margin-bottom:6px">
                <span :class="'scorecard-mini-grade scorecard-grade grade-'+entityGrade(sc,selectedEntity).toLowerCase()">{{ entityGrade(sc,selectedEntity) }}</span>
                <div style="flex:1;min-width:0"><div style="font-size:12px;font-weight:600;color:var(--text)">{{ sc.name }}</div><div style="display:flex;align-items:center;gap:8px;margin-top:4px"><div class="scorecard-bar"><div :class="'scorecard-bar-fill fill-'+entityGrade(sc,selectedEntity).toLowerCase()" :style="'width:'+entityScorePct(sc,selectedEntity)+'%'"></div></div><span class="scorecard-pct" :style="'color:'+gradeColor(entityGrade(sc,selectedEntity))">{{ entityScorePct(sc,selectedEntity) }}%</span></div></div>
                <div style="display:flex;gap:3px"><span v-for="c in sc.criteria" :key="c.id" :class="'criteria-icon '+(evaluateCriterion(c,selectedEntity)?'pass':'fail')" :title="c.name">{{ evaluateCriterion(c,selectedEntity)?'âœ“':'âœ—' }}</span></div>
              </div>
            </div>
            <div class="detail-section" v-if="serviceTypeFields.length">
              <div class="detail-section-title">{{ typeLabels.service[selectedEntity.type] }} Attributes</div>
              <div class="detail-grid">
                <template v-for="f in serviceTypeFields" :key="f.key">
                  <span class="detail-label">{{ f.label }}</span>
                  <span class="detail-value" :class="{mono:isMonoField(f.key)}">
                    <template v-if="f.type==='checkbox'">{{ selectedEntity.attributes?.[f.key]?'âœ“ Yes':'âœ— No' }}</template>
                    <template v-else>{{ selectedEntity.attributes?.[f.key]||'â€”' }}</template>
                  </span>
                </template>
              </div>
            </div>
            <div class="detail-section">
              <div class="detail-section-title">Parent Products</div>
              <div class="relation-list">
                <div v-for="p in serviceProducts" :key="p.id" class="relation-chip" @click="navigate('products');selectItem('products',p)"><span class="badge badge-product">product</span>{{ p.name }}</div>
                <span v-if="!serviceProducts.length" style="color:var(--text-dim);font-size:12px">Not in any product</span>
              </div>
            </div>
            <div class="detail-section">
              <div class="detail-section-title">Components ({{ (selectedEntity.componentIds||[]).length }})</div>
              <div class="relation-list">
                <div v-for="c in serviceComponents" :key="c.id" :class="'relation-chip'+(c.operationalStatus&&c.operationalStatus!=='operational'?' chip-'+c.operationalStatus:'')" @click="navigate('components');selectItem('components',c)">
                  <span :class="'badge badge-'+c.type">{{ typeLabels.component[c.type] }}</span>{{ c.name }}
                  <span v-if="c.operationalStatus&&c.operationalStatus!=='operational'" :class="'badge badge-'+c.operationalStatus">{{ c.operationalStatus }}</span>
                </div>
                <span v-if="!serviceComponents.length" style="color:var(--text-dim);font-size:12px">No components</span>
              </div>
            </div>
            <div class="detail-section">
              <div class="detail-section-title">Runs On (Resources)</div>
              <div class="relation-list">
                <div v-for="r in serviceResources" :key="r.id" :class="'relation-chip'+(r.operationalStatus&&r.operationalStatus!=='operational'?' chip-'+r.operationalStatus:'')" @click="navigate('resources');selectItem('resources',r)">
                  <span :class="'badge badge-'+r.type">{{ typeLabels.resource[r.type] }}</span>{{ r.name }}
                  <span v-if="r.operationalStatus&&r.operationalStatus!=='operational'" :class="'badge badge-'+r.operationalStatus">{{ r.operationalStatus }}</span>
                </div>
                <span v-if="!serviceResources.length" style="color:var(--text-dim);font-size:12px">No resources linked</span>
              </div>
            </div>
            <div class="detail-section">
              <div class="detail-section-title">Depends On (Services)</div>
              <div class="relation-list">
                <div v-for="s in serviceDependencies" :key="s.id" :class="'relation-chip'+(s.operationalStatus&&s.operationalStatus!=='operational'?' chip-'+s.operationalStatus:'')" @click="selectItem('services',s)">
                  <span :class="'badge badge-'+s.type">{{ typeLabels.service[s.type] }}</span>{{ s.name }}
                  <span v-if="s.operationalStatus&&s.operationalStatus!=='operational'" :class="'badge badge-'+s.operationalStatus">{{ s.operationalStatus }}</span>
                </div>
                <span v-if="!serviceDependencies.length" style="color:var(--text-dim);font-size:12px">No dependencies</span>
              </div>
            </div>
            <div class="detail-section">
              <div class="detail-section-title">Components Depending On This (bi-directional)</div>
              <div class="relation-list">
                <div v-for="c in componentsDependingOnService" :key="c.id" :class="'relation-chip'+(c.operationalStatus&&c.operationalStatus!=='operational'?' chip-'+c.operationalStatus:'')" @click="navigate('components');selectItem('components',c)">
                  <span :class="'badge badge-'+c.type">{{ typeLabels.component[c.type] }}</span>{{ c.name }}
                  <span v-if="c.operationalStatus&&c.operationalStatus!=='operational'" :class="'badge badge-'+c.operationalStatus">{{ c.operationalStatus }}</span>
                </div>
                <span v-if="!componentsDependingOnService.length" style="color:var(--text-dim);font-size:12px">No components depend on this service</span>
              </div>
            </div>
            <div class="detail-section">
              <div class="detail-section-title">Repositories</div>
              <div class="relation-list">
                <div v-for="r in entityRepositories" :key="r.id" class="relation-chip" @click="navigate('repositories');selectItem('repositories',r)"><span :class="'badge badge-'+r.provider">{{ providerLabels[r.provider] }}</span>{{ r.name }}</div>
                <span v-if="!entityRepositories.length" style="color:var(--text-dim);font-size:12px">No repositories linked</span>
              </div>
            </div>
            <div class="detail-section">
              <div class="detail-section-title">Active Incidents</div>
              <div class="relation-list">
                <div v-for="inc in entityIncidents" :key="inc.id" class="relation-chip" :class="{'chip-outage':inc.severity==='critical','chip-degraded':inc.severity!=='critical'}" @click="navigate('incidents');selectItem('incidents',inc)">
                  <span :class="'badge badge-'+inc.severity">{{ inc.severity }}</span><span :class="'badge badge-'+inc.status">{{ inc.status }}</span>{{ inc.title }}
                </div>
                <span v-if="!entityIncidents.length" style="color:var(--text-dim);font-size:12px">No incidents</span>
              </div>
            </div>
          </div>
          <div class="empty-state" v-else><div class="empty-state-icon">âš¡</div><div style="color:#5a7a96;font-size:14px">Select a service to view details</div></div>
        </div>
      </div>

      <!-- COMPONENTS -->
      <div v-if="currentView==='components'" style="display:flex;flex-direction:column;flex:1;overflow:hidden">
        <div class="view-header">
          <div><div class="view-title">Components</div><div class="view-subtitle">Libraries, microservices, SDKs, agents, and UI components</div></div>
          <button class="btn btn-primary" style="margin-left:auto" @click="openCreateForm('components')">+ Add Component</button>
        </div>
        <div class="entity-layout">
          <div class="entity-list">
            <div class="entity-list-toolbar">
              <input class="search-input" v-model="searchQuery" placeholder="Search componentsâ€¦"/>
              <select class="form-control" style="width:120px;flex-shrink:0" v-model="typeFilter"><option value="">All types</option><option v-for="(label,type) in typeLabels.component" :key="type" :value="type">{{ label }}</option></select>
            </div>
            <div v-if="!filteredComponents.length" class="empty-list">No components found</div>
            <div v-for="c in filteredComponents" :key="c.id" class="entity-card" :class="{selected:selectedId===c.id,...(c.operationalStatus&&c.operationalStatus!=='operational'?{[c.operationalStatus]:true}:{})}" @click="selectItem('components',c)">
              <div class="entity-card-name"><span :class="'badge badge-'+c.type">{{ typeLabels.component[c.type] }}</span>{{ c.name }}</div>
              <div class="entity-card-meta">
                <span>{{ teamName(c.teamId) }}</span>
                <span :class="'badge badge-'+(c.status||'active')" style="font-size:10px">{{ c.status||'active' }}</span>
                <span v-if="c.operationalStatus&&c.operationalStatus!=='operational'" :class="'badge badge-'+c.operationalStatus">{{ c.operationalStatus }}</span>
              </div>
            </div>
          </div>
          <div class="entity-detail" v-if="selectedEntity && currentView==='components'">
            <div v-if="selectedEntity.operationalStatus && selectedEntity.operationalStatus!=='operational'" :class="'impact-panel '+selectedEntity.operationalStatus" style="margin-bottom:20px">
              <div class="impact-panel-title">{{ selectedEntity.operationalStatus==='outage'?'ðŸ”´ OUTAGE':'ðŸŸ¡ DEGRADED' }} â€” {{ selectedEntity.name }}</div>
              <div style="font-size:12px;margin-bottom:6px" :style="selectedEntity.operationalStatus==='outage'?'color:#7a0000':'color:#7a4800'">Parent services impacted:</div>
              <div class="relation-list">
                <span v-for="s in componentServices" :key="s.id" :class="'badge badge-'+s.type" style="cursor:pointer" @click="navigate('services');selectItem('services',s)">{{ s.name }}</span>
                <span v-if="!componentServices.length" style="font-size:12px;color:var(--text-dim)">None</span>
              </div>
            </div>
            <div class="detail-header">
              <div>
                <div class="detail-title">{{ selectedEntity.name }}
                  <span v-if="selectedEntity.operationalStatus&&selectedEntity.operationalStatus!=='operational'" :class="'badge badge-'+selectedEntity.operationalStatus">{{ selectedEntity.operationalStatus }}</span>
                </div>
                <div class="detail-id">ID: {{ selectedEntity.id }}</div>
              </div>
              <div class="detail-actions">
                <button v-if="!selectedEntity.operationalStatus||selectedEntity.operationalStatus==='operational'" class="btn btn-warning btn-sm" @click="setOpStatus('components', selectedEntity, 'degraded')">Mark Degraded</button>
                <button v-if="!selectedEntity.operationalStatus||selectedEntity.operationalStatus==='operational'" class="btn btn-outage btn-sm" @click="setOpStatus('components', selectedEntity, 'outage')">Mark Outage</button>
                <button v-if="selectedEntity.operationalStatus&&selectedEntity.operationalStatus!=='operational'" class="btn btn-success btn-sm" @click="setOpStatus('components', selectedEntity, 'operational')">âœ“ Resolve</button>
                <button class="btn btn-secondary" @click="openEditForm('components',selectedEntity)">Edit</button>
                <button class="btn btn-danger" @click="deleteItem('components',selectedEntity.id)">Delete</button>
              </div>
            </div>
            <div class="detail-section">
              <div class="detail-section-title">Details</div>
              <div class="detail-grid">
                <span class="detail-label">Type</span><span class="detail-value"><span :class="'badge badge-'+selectedEntity.type">{{ typeLabels.component[selectedEntity.type] }}</span></span>
                <span class="detail-label">Status</span><span class="detail-value"><span :class="'badge badge-'+(selectedEntity.status||'active')">{{ selectedEntity.status||'active' }}</span></span>
                <span class="detail-label">Operational</span><span class="detail-value"><span :class="'badge badge-'+(selectedEntity.operationalStatus||'operational')">{{ selectedEntity.operationalStatus||'operational' }}</span></span>
                <span class="detail-label">Team</span><span class="detail-value">{{ teamName(selectedEntity.teamId) }}</span>
                <span class="detail-label">Description</span><span class="detail-value">{{ selectedEntity.description||'â€”' }}</span>
              </div>
            </div>
            <div class="detail-section" v-if="selectedEntity.assignments && selectedEntity.assignments.length">
              <div class="detail-section-title">Assignments</div>
              <div v-for="a in selectedEntity.assignments" :key="a.personId+a.role" class="assignment-row">
                <div class="owner-avatar">{{ ownerInitials(findPerson(a.personId)) }}</div>
                <span style="font-weight:500">{{ findPerson(a.personId).name }}</span>
                <span class="role-chip">{{ a.role }}</span>
              </div>
            </div>
            <div class="detail-section" v-if="entityScorecards('components').length">
              <div class="detail-section-title">Scorecards</div>
              <div v-for="sc in entityScorecards('components')" :key="sc.id" class="scorecard-mini" @click="navigate('scorecards');$nextTick(()=>selectItem('scorecards',sc))" style="margin-bottom:6px">
                <span :class="'scorecard-mini-grade scorecard-grade grade-'+entityGrade(sc,selectedEntity).toLowerCase()">{{ entityGrade(sc,selectedEntity) }}</span>
                <div style="flex:1;min-width:0"><div style="font-size:12px;font-weight:600;color:var(--text)">{{ sc.name }}</div><div style="display:flex;align-items:center;gap:8px;margin-top:4px"><div class="scorecard-bar"><div :class="'scorecard-bar-fill fill-'+entityGrade(sc,selectedEntity).toLowerCase()" :style="'width:'+entityScorePct(sc,selectedEntity)+'%'"></div></div><span class="scorecard-pct" :style="'color:'+gradeColor(entityGrade(sc,selectedEntity))">{{ entityScorePct(sc,selectedEntity) }}%</span></div></div>
                <div style="display:flex;gap:3px"><span v-for="c in sc.criteria" :key="c.id" :class="'criteria-icon '+(evaluateCriterion(c,selectedEntity)?'pass':'fail')" :title="c.name">{{ evaluateCriterion(c,selectedEntity)?'âœ“':'âœ—' }}</span></div>
              </div>
            </div>
            <div class="detail-section" v-if="componentTypeFields.length">
              <div class="detail-section-title">{{ typeLabels.component[selectedEntity.type] }} Attributes</div>
              <div class="detail-grid">
                <template v-for="f in componentTypeFields" :key="f.key">
                  <span class="detail-label">{{ f.label }}</span>
                  <span class="detail-value" :class="{mono:isMonoField(f.key)}">
                    <template v-if="f.type==='checkbox'">{{ selectedEntity.attributes?.[f.key]?'âœ“ Yes':'âœ— No' }}</template>
                    <template v-else>{{ selectedEntity.attributes?.[f.key]||'â€”' }}</template>
                  </span>
                </template>
              </div>
            </div>
            <div class="detail-section">
              <div class="detail-section-title">Parent Services</div>
              <div class="relation-list">
                <div v-for="s in componentServices" :key="s.id" class="relation-chip" @click="navigate('services');selectItem('services',s)"><span :class="'badge badge-'+s.type">{{ typeLabels.service[s.type] }}</span>{{ s.name }}</div>
                <span v-if="!componentServices.length" style="color:var(--text-dim);font-size:12px">Not in any service</span>
              </div>
            </div>
            <div class="detail-section">
              <div class="detail-section-title">Depends On (Components)</div>
              <div class="relation-list">
                <div v-for="c in componentDependencies" :key="c.id" :class="'relation-chip'+(c.operationalStatus&&c.operationalStatus!=='operational'?' chip-'+c.operationalStatus:'')" @click="selectItem('components',c)">
                  <span :class="'badge badge-'+c.type">{{ typeLabels.component[c.type] }}</span>{{ c.name }}
                  <span v-if="c.operationalStatus&&c.operationalStatus!=='operational'" :class="'badge badge-'+c.operationalStatus">{{ c.operationalStatus }}</span>
                </div>
                <span v-if="!componentDependencies.length" style="color:var(--text-dim);font-size:12px">No dependencies</span>
              </div>
            </div>
            <div class="detail-section">
              <div class="detail-section-title">Depends On (Services)</div>
              <div class="relation-list">
                <div v-for="s in componentServiceDependencies" :key="s.id" :class="'relation-chip'+(s.operationalStatus&&s.operationalStatus!=='operational'?' chip-'+s.operationalStatus:'')" @click="navigate('services');selectItem('services',s)">
                  <span :class="'badge badge-'+s.type">{{ typeLabels.service[s.type] }}</span>{{ s.name }}
                  <span v-if="s.operationalStatus&&s.operationalStatus!=='operational'" :class="'badge badge-'+s.operationalStatus">{{ s.operationalStatus }}</span>
                </div>
                <span v-if="!componentServiceDependencies.length" style="color:var(--text-dim);font-size:12px">No service dependencies</span>
              </div>
            </div>
            <div class="detail-section">
              <div class="detail-section-title">Repositories</div>
              <div class="relation-list">
                <div v-for="r in entityRepositories" :key="r.id" class="relation-chip" @click="navigate('repositories');selectItem('repositories',r)"><span :class="'badge badge-'+r.provider">{{ providerLabels[r.provider] }}</span>{{ r.name }}</div>
                <span v-if="!entityRepositories.length" style="color:var(--text-dim);font-size:12px">No repositories linked</span>
              </div>
            </div>
            <div class="detail-section">
              <div class="detail-section-title">Active Incidents</div>
              <div class="relation-list">
                <div v-for="inc in entityIncidents" :key="inc.id" class="relation-chip" :class="{'chip-outage':inc.severity==='critical','chip-degraded':inc.severity!=='critical'}" @click="navigate('incidents');selectItem('incidents',inc)">
                  <span :class="'badge badge-'+inc.severity">{{ inc.severity }}</span><span :class="'badge badge-'+inc.status">{{ inc.status }}</span>{{ inc.title }}
                </div>
                <span v-if="!entityIncidents.length" style="color:var(--text-dim);font-size:12px">No incidents</span>
              </div>
            </div>
          </div>
          <div class="empty-state" v-else><div class="empty-state-icon">âš™ï¸</div><div style="color:#5a7a96;font-size:14px">Select a component to view details</div></div>
        </div>
      </div>

      <!-- RESOURCES -->
      <div v-if="currentView==='resources'" style="display:flex;flex-direction:column;flex:1;overflow:hidden">
        <div class="view-header">
          <div><div class="view-title">Resources</div><div class="view-subtitle">Cloud and infrastructure resources that services run on</div></div>
          <button class="btn btn-primary" style="margin-left:auto" @click="openCreateForm('resources')">+ Add Resource</button>
        </div>
        <div class="entity-layout">
          <div class="entity-list">
            <div class="entity-list-toolbar">
              <input class="search-input" v-model="searchQuery" placeholder="Search resourcesâ€¦"/>
              <select class="form-control" style="width:120px;flex-shrink:0" v-model="typeFilter"><option value="">All types</option><option v-for="(label,type) in typeLabels.resource" :key="type" :value="type">{{ label }}</option></select>
            </div>
            <div v-if="!filteredResources.length" class="empty-list">No resources found</div>
            <div v-for="r in filteredResources" :key="r.id" class="entity-card" :class="{selected:selectedId===r.id,...(r.operationalStatus&&r.operationalStatus!=='operational'?{[r.operationalStatus]:true}:{})}" @click="selectItem('resources',r)">
              <div class="entity-card-name"><span :class="'badge badge-'+r.type">{{ typeLabels.resource[r.type] }}</span>{{ r.name }}</div>
              <div class="entity-card-meta">
                <span>{{ teamName(r.teamId) }}</span>
                <span v-if="r.attributes && r.attributes.region" style="font-family:var(--font-mono)">{{ r.attributes.region }}</span>
                <span v-if="r.operationalStatus&&r.operationalStatus!=='operational'" :class="'badge badge-'+r.operationalStatus">{{ r.operationalStatus }}</span>
              </div>
            </div>
          </div>
          <div class="entity-detail" v-if="selectedEntity && currentView==='resources'">
            <div v-if="selectedEntity.operationalStatus && selectedEntity.operationalStatus!=='operational'" :class="'impact-panel '+selectedEntity.operationalStatus" style="margin-bottom:20px">
              <div class="impact-panel-title">{{ selectedEntity.operationalStatus==='outage'?'ðŸ”´ OUTAGE':'ðŸŸ¡ DEGRADED' }} â€” {{ selectedEntity.name }}</div>
              <div style="font-size:12px;margin-bottom:6px" :style="selectedEntity.operationalStatus==='outage'?'color:#7a0000':'color:#7a4800'">Services running on this resource:</div>
              <div class="relation-list">
                <span v-for="s in resourceServices" :key="s.id" :class="'badge badge-'+s.type" style="cursor:pointer" @click="navigate('services');selectItem('services',s)">{{ s.name }}</span>
                <span v-if="!resourceServices.length" style="font-size:12px;color:var(--text-dim)">None assigned</span>
              </div>
            </div>
            <div class="detail-header">
              <div>
                <div class="detail-title">{{ selectedEntity.name }}
                  <span v-if="selectedEntity.operationalStatus&&selectedEntity.operationalStatus!=='operational'" :class="'badge badge-'+selectedEntity.operationalStatus">{{ selectedEntity.operationalStatus }}</span>
                </div>
                <div class="detail-id">ID: {{ selectedEntity.id }}</div>
              </div>
              <div class="detail-actions">
                <button v-if="!selectedEntity.operationalStatus||selectedEntity.operationalStatus==='operational'" class="btn btn-warning btn-sm" @click="setOpStatus('resources', selectedEntity, 'degraded')">Mark Degraded</button>
                <button v-if="!selectedEntity.operationalStatus||selectedEntity.operationalStatus==='operational'" class="btn btn-outage btn-sm" @click="setOpStatus('resources', selectedEntity, 'outage')">Mark Outage</button>
                <button v-if="selectedEntity.operationalStatus&&selectedEntity.operationalStatus!=='operational'" class="btn btn-success btn-sm" @click="setOpStatus('resources', selectedEntity, 'operational')">âœ“ Resolve</button>
                <button class="btn btn-secondary" @click="openEditForm('resources',selectedEntity)">Edit</button>
                <button class="btn btn-danger" @click="deleteItem('resources',selectedEntity.id)">Delete</button>
              </div>
            </div>
            <div class="detail-section">
              <div class="detail-section-title">Details</div>
              <div class="detail-grid">
                <span class="detail-label">Type</span><span class="detail-value"><span :class="'badge badge-'+selectedEntity.type">{{ typeLabels.resource[selectedEntity.type] }}</span></span>
                <span class="detail-label">Operational</span><span class="detail-value"><span :class="'badge badge-'+(selectedEntity.operationalStatus||'operational')">{{ selectedEntity.operationalStatus||'operational' }}</span></span>
                <span class="detail-label">Team</span><span class="detail-value">{{ teamName(selectedEntity.teamId) }}</span>
                <span class="detail-label">Description</span><span class="detail-value">{{ selectedEntity.description||'â€”' }}</span>
              </div>
            </div>
            <div class="detail-section" v-if="selectedEntity.assignments && selectedEntity.assignments.length">
              <div class="detail-section-title">Assignments</div>
              <div v-for="a in selectedEntity.assignments" :key="a.personId+a.role" class="assignment-row">
                <div class="owner-avatar">{{ ownerInitials(findPerson(a.personId)) }}</div>
                <span style="font-weight:500">{{ findPerson(a.personId).name }}</span>
                <span class="role-chip">{{ a.role }}</span>
              </div>
            </div>
            <div class="detail-section" v-if="entityScorecards('resources').length">
              <div class="detail-section-title">Scorecards</div>
              <div v-for="sc in entityScorecards('resources')" :key="sc.id" class="scorecard-mini" @click="navigate('scorecards');$nextTick(()=>selectItem('scorecards',sc))" style="margin-bottom:6px">
                <span :class="'scorecard-mini-grade scorecard-grade grade-'+entityGrade(sc,selectedEntity).toLowerCase()">{{ entityGrade(sc,selectedEntity) }}</span>
                <div style="flex:1;min-width:0"><div style="font-size:12px;font-weight:600;color:var(--text)">{{ sc.name }}</div><div style="display:flex;align-items:center;gap:8px;margin-top:4px"><div class="scorecard-bar"><div :class="'scorecard-bar-fill fill-'+entityGrade(sc,selectedEntity).toLowerCase()" :style="'width:'+entityScorePct(sc,selectedEntity)+'%'"></div></div><span class="scorecard-pct" :style="'color:'+gradeColor(entityGrade(sc,selectedEntity))">{{ entityScorePct(sc,selectedEntity) }}%</span></div></div>
                <div style="display:flex;gap:3px"><span v-for="c in sc.criteria" :key="c.id" :class="'criteria-icon '+(evaluateCriterion(c,selectedEntity)?'pass':'fail')" :title="c.name">{{ evaluateCriterion(c,selectedEntity)?'âœ“':'âœ—' }}</span></div>
              </div>
            </div>
            <div class="detail-section" v-if="resourceTypeFields.length">
              <div class="detail-section-title">{{ typeLabels.resource[selectedEntity.type] }} Attributes</div>
              <div class="detail-grid">
                <template v-for="f in resourceTypeFields" :key="f.key">
                  <span class="detail-label">{{ f.label }}</span>
                  <span class="detail-value" :class="{mono:isMonoField(f.key)}">
                    <template v-if="f.type==='checkbox'">{{ selectedEntity.attributes?.[f.key]?'âœ“ Yes':'âœ— No' }}</template>
                    <template v-else>{{ selectedEntity.attributes?.[f.key]||'â€”' }}</template>
                  </span>
                </template>
              </div>
            </div>
            <div class="detail-section">
              <div class="detail-section-title">Services Running on This Resource</div>
              <div class="relation-list">
                <div v-for="s in resourceServices" :key="s.id" :class="'relation-chip'+(s.operationalStatus&&s.operationalStatus!=='operational'?' chip-'+s.operationalStatus:'')" @click="navigate('services');selectItem('services',s)">
                  <span :class="'badge badge-'+s.type">{{ typeLabels.service[s.type] }}</span>{{ s.name }}
                </div>
                <span v-if="!resourceServices.length" style="color:var(--text-dim);font-size:12px">No services linked</span>
              </div>
            </div>
            <div class="detail-section">
              <div class="detail-section-title">Active Incidents</div>
              <div class="relation-list">
                <div v-for="inc in entityIncidents" :key="inc.id" class="relation-chip" :class="{'chip-outage':inc.severity==='critical','chip-degraded':inc.severity!=='critical'}" @click="navigate('incidents');selectItem('incidents',inc)">
                  <span :class="'badge badge-'+inc.severity">{{ inc.severity }}</span><span :class="'badge badge-'+inc.status">{{ inc.status }}</span>{{ inc.title }}
                </div>
                <span v-if="!entityIncidents.length" style="color:var(--text-dim);font-size:12px">No incidents</span>
              </div>
            </div>
          </div>
          <div class="empty-state" v-else><div class="empty-state-icon">ðŸ–¥ï¸</div><div style="color:#5a7a96;font-size:14px">Select a resource to view details</div></div>
        </div>
      </div>

      <!-- TEAMS -->
      <div v-if="currentView==='teams'" style="display:flex;flex-direction:column;flex:1;overflow:hidden">
        <div class="view-header">
          <div><div class="view-title">Teams</div><div class="view-subtitle">Organizational teams that own products, services, and infrastructure</div></div>
          <button class="btn btn-primary" style="margin-left:auto" @click="openCreateForm('teams')">+ Add Team</button>
        </div>
        <div class="entity-layout">
          <div class="entity-list">
            <div class="entity-list-toolbar"><input class="search-input" v-model="searchQuery" placeholder="Search teamsâ€¦"/></div>
            <div v-if="!filteredTeams.length" class="empty-list">No teams found</div>
            <div v-for="t in filteredTeams" :key="t.id" class="entity-card" :class="{selected:selectedId===t.id}" @click="selectItem('teams',t)">
              <div class="entity-card-name"><div class="team-avatar">{{ teamInitials(t) }}</div>{{ t.name }}</div>
              <div class="entity-card-meta"><span>{{ teamMemberCount(t) }} member(s)</span><span v-if="t.slackChannel" style="font-family:var(--font-mono)">{{ t.slackChannel }}</span></div>
            </div>
          </div>
          <div class="entity-detail" v-if="selectedEntity && currentView==='teams'">
            <div class="detail-header">
              <div><div class="detail-title">{{ selectedEntity.name }}</div><div class="detail-id">ID: {{ selectedEntity.id }}</div></div>
              <div class="detail-actions"><button class="btn btn-secondary" @click="openEditForm('teams',selectedEntity)">Edit</button><button class="btn btn-danger" @click="deleteItem('teams',selectedEntity.id)">Delete</button></div>
            </div>
            <div class="detail-section">
              <div class="detail-section-title">Details</div>
              <div class="detail-grid">
                <span class="detail-label">Description</span><span class="detail-value">{{ selectedEntity.description||'â€”' }}</span>
                <span class="detail-label">Slack Channel</span><span class="detail-value mono">{{ selectedEntity.slackChannel||'â€”' }}</span>
                <span class="detail-label">Email</span><span class="detail-value mono">{{ selectedEntity.contactEmail||'â€”' }}</span>
              </div>
            </div>
            <div class="detail-section">
              <div class="detail-section-title">Members ({{ teamMembers.length }})</div>
              <div v-if="!teamMembers.length" style="color:var(--text-dim);font-size:12px">No members assigned</div>
              <div v-for="m in teamMembers" :key="m.id" class="assignment-row">
                <div class="owner-avatar">{{ ownerInitials(m) }}</div>
                <span style="font-weight:500">{{ m.name }}</span>
                <span style="color:var(--text-dim);font-size:12px">{{ m.email }}</span>
                <span v-if="m.role" class="role-chip">{{ m.role }}</span>
              </div>
            </div>
            <div class="detail-section">
              <div class="detail-section-title">Owned Products</div>
              <div class="relation-list">
                <div v-for="p in teamOwnedProducts" :key="p.id" class="relation-chip" @click="navigate('products');selectItem('products',p)"><span class="badge badge-product">product</span>{{ p.name }}</div>
                <span v-if="!teamOwnedProducts.length" style="color:var(--text-dim);font-size:12px">None</span>
              </div>
            </div>
            <div class="detail-section">
              <div class="detail-section-title">Owned Services</div>
              <div class="relation-list">
                <div v-for="s in teamOwnedServices" :key="s.id" class="relation-chip" @click="navigate('services');selectItem('services',s)"><span :class="'badge badge-'+s.type">{{ typeLabels.service[s.type] }}</span>{{ s.name }}</div>
                <span v-if="!teamOwnedServices.length" style="color:var(--text-dim);font-size:12px">None</span>
              </div>
            </div>
            <div class="detail-section">
              <div class="detail-section-title">Owned Components</div>
              <div class="relation-list">
                <div v-for="c in teamOwnedComponents" :key="c.id" class="relation-chip" @click="navigate('components');selectItem('components',c)"><span :class="'badge badge-'+c.type">{{ typeLabels.component[c.type] }}</span>{{ c.name }}</div>
                <span v-if="!teamOwnedComponents.length" style="color:var(--text-dim);font-size:12px">None</span>
              </div>
            </div>
            <div class="detail-section">
              <div class="detail-section-title">Owned Resources</div>
              <div class="relation-list">
                <div v-for="r in teamOwnedResources" :key="r.id" class="relation-chip" @click="navigate('resources');selectItem('resources',r)"><span :class="'badge badge-'+r.type">{{ typeLabels.resource[r.type] }}</span>{{ r.name }}</div>
                <span v-if="!teamOwnedResources.length" style="color:var(--text-dim);font-size:12px">None</span>
              </div>
            </div>
            <div class="detail-section">
              <div class="detail-section-title">Owned Repositories</div>
              <div class="relation-list">
                <div v-for="r in teamOwnedRepositories" :key="r.id" class="relation-chip" @click="navigate('repositories');selectItem('repositories',r)"><span :class="'badge badge-'+r.provider">{{ providerLabels[r.provider] }}</span>{{ r.name }}</div>
                <span v-if="!teamOwnedRepositories.length" style="color:var(--text-dim);font-size:12px">None</span>
              </div>
            </div>
          </div>
          <div class="empty-state" v-else><div class="empty-state-icon">ðŸ‘¥</div><div style="color:#5a7a96;font-size:14px">Select a team to view details</div></div>
        </div>
      </div>

      <!-- PEOPLE -->
      <div v-if="currentView==='people'" style="display:flex;flex-direction:column;flex:1;overflow:hidden">
        <div class="view-header">
          <div><div class="view-title">People</div><div class="view-subtitle">Individuals assigned to teams and entities as stakeholders, leads, and product managers</div></div>
          <button class="btn btn-primary" style="margin-left:auto" @click="openCreateForm('owners')">+ Add Person</button>
        </div>
        <div class="entity-layout">
          <div class="entity-list">
            <div class="entity-list-toolbar"><input class="search-input" v-model="searchQuery" placeholder="Search peopleâ€¦"/></div>
            <div v-if="!filteredOwners.length" class="empty-list">No people found</div>
            <div v-for="o in filteredOwners" :key="o.id" class="entity-card" :class="{selected:selectedId===o.id}" @click="selectItem('owners',o)">
              <div class="entity-card-name"><div class="owner-avatar">{{ ownerInitials(o) }}</div>{{ o.name }}</div>
              <div class="entity-card-meta"><span>{{ o.email }}</span><span v-if="personTeamName(o.teamId)">{{ personTeamName(o.teamId) }}</span><span v-if="o.role" class="role-chip" style="padding:1px 6px">{{ o.role }}</span></div>
            </div>
          </div>
          <div class="entity-detail" v-if="selectedEntity && currentView==='people'">
            <div class="detail-header">
              <div><div class="detail-title">{{ selectedEntity.name }}</div><div class="detail-id">ID: {{ selectedEntity.id }}</div></div>
              <div class="detail-actions"><button class="btn btn-secondary" @click="openEditForm('owners',selectedEntity)">Edit</button><button class="btn btn-danger" @click="deleteItem('owners',selectedEntity.id)">Delete</button></div>
            </div>
            <div class="detail-section">
              <div class="detail-section-title">Contact</div>
              <div class="detail-grid">
                <span class="detail-label">Email</span><span class="detail-value mono">{{ selectedEntity.email||'â€”' }}</span>
                <span class="detail-label">Team</span><span class="detail-value">{{ personTeamName(selectedEntity.teamId)||'â€”' }}</span>
                <span class="detail-label">Role</span><span class="detail-value">{{ selectedEntity.role||'â€”' }}</span>
                <span class="detail-label">Slack</span><span class="detail-value mono">{{ selectedEntity.slack||'â€”' }}</span>
              </div>
            </div>
            <div class="detail-section">
              <div class="detail-section-title">Assignments</div>
              <div v-if="!personAssignments.length" style="color:var(--text-dim);font-size:12px">No entity assignments</div>
              <div v-for="a in personAssignments" :key="a.entity.id+a.role" class="assignment-row" style="cursor:pointer" @click="navigateTo(a.entity)">
                <span :class="'badge badge-'+(a.entity.type||'product')">{{ getTypeLabel(a.entity) }}</span>
                <span style="font-weight:500">{{ a.entity.name }}</span>
                <span class="role-chip">{{ a.role }}</span>
              </div>
            </div>
          </div>
          <div class="empty-state" v-else><div class="empty-state-icon">ðŸ‘¤</div><div style="color:#5a7a96;font-size:14px">Select a person to view details</div></div>
        </div>
      </div>

      <!-- STATUS PAGE -->
      <div v-if="currentView==='status'" class="status-page">
        <div class="view-header">
          <div><div class="view-title">System Status</div><div class="view-subtitle">Current operational status of all products and applications</div></div>
        </div>
        <div :class="'status-banner '+(statusPageOverall==='outage'?'has-outage':statusPageOverall==='degraded'?'has-issues':'all-ok')">
          <div class="status-banner-icon">{{ statusPageOverall==='outage'?'ðŸ”´':statusPageOverall==='degraded'?'ðŸŸ¡':'ðŸŸ¢' }}</div>
          <div class="status-banner-text">{{ statusPageOverall==='outage'?'System Outage Detected':statusPageOverall==='degraded'?'Partial System Degradation':'All Systems Operational' }}</div>
          <div class="status-banner-sub">Last updated: {{ new Date().toLocaleString() }}</div>
        </div>

        <!-- Active incidents at the top -->
        <div v-for="inc in activeIncidents" :key="'si-'+inc.id" :class="'status-incident-banner '+(inc.severity==='critical'?'':'warn')" style="margin-top:12px">
          <span style="font-size:16px">{{ inc.severity==='critical'?'ðŸ”´':'ðŸŸ¡' }}</span>
          <div style="flex:1">
            <div style="font-weight:600;font-size:13px;color:#003057">{{ inc.title }}</div>
            <div style="font-size:12px;color:var(--text-dim)">{{ inc.description }}</div>
            <div style="font-size:11px;color:var(--text-dim);font-family:var(--font-mono);margin-top:4px">
              <span :class="'badge badge-'+inc.status" style="font-size:10px">{{ inc.status }}</span>
              Â· {{ formatDate(inc.createdAt) }}
              Â· {{ (inc.affectedEntityIds||[]).length }} affected entities
            </div>
          </div>
        </div>

        <div style="padding:8px 0">
          <div v-for="p in statusPageProducts" :key="p.id" class="status-product">
            <div class="status-product-header" @click="toggleStatusProduct(p.id)">
              <div :class="'status-product-indicator '+p.overallStatus"></div>
              <div class="status-product-name">{{ p.name }}</div>
              <span v-if="p.description" style="font-size:12px;color:var(--text-dim);flex:1;text-align:right;margin-right:8px">{{ p.description }}</span>
              <span :class="'status-product-badge '+p.overallStatus">{{ p.overallStatus==='operational'?'Operational':p.overallStatus==='degraded'?'Degraded':'Outage' }}</span>
              <span :class="'status-product-chevron'+(expandedStatusProducts.includes(p.id)?' open':'')">â–¾</span>
            </div>
            <div v-if="expandedStatusProducts.includes(p.id)" class="status-services-list">
              <div v-if="!p.services.length" style="color:var(--text-dim);font-size:12px;padding:8px 0">No services assigned to this product</div>
              <div v-for="s in p.services" :key="s.id" class="status-service-row">
                <div :class="'status-service-dot '+(s.operationalStatus||'operational')"></div>
                <span class="status-service-name">{{ s.name }}</span>
                <span class="status-service-type">{{ typeLabels.service[s.type]||s.type }}</span>
                <span :class="'status-service-status badge badge-'+(s.operationalStatus||'operational')">{{ (s.operationalStatus||'operational').toUpperCase() }}</span>
              </div>
            </div>
          </div>
        </div>

        <div v-if="!inventory.products.length" style="text-align:center;padding:48px;color:var(--text-dim)">No products defined yet. Add products to see their operational status.</div>
      </div>

      <!-- SCORECARDS -->
      <div v-if="currentView==='scorecards'" style="display:flex;flex-direction:column;flex:1;overflow:hidden">
        <div class="view-header">
          <div><div class="view-title">Scorecards</div><div class="view-subtitle">Evaluate entity readiness, compliance, and best practices</div></div>
          <button class="btn btn-primary" style="margin-left:auto" @click="openCreateForm('scorecards')">+ New Scorecard</button>
        </div>
        <div class="entity-layout">
          <div class="entity-list">
            <div class="entity-list-toolbar"><input class="search-input" v-model="searchQuery" placeholder="Search scorecardsâ€¦"/></div>
            <div v-if="!filteredScorecards.length" class="empty-list">No scorecards defined</div>
            <div v-for="sc in filteredScorecards" :key="sc.id" class="entity-card" :class="{selected:selectedId===sc.id}" @click="selectItem('scorecards',sc)">
              <div class="entity-card-name">
                <span :class="'scorecard-mini-grade scorecard-grade grade-'+scorecardOverallGrade(sc).toLowerCase()">{{ scorecardOverallGrade(sc) }}</span>
                {{ sc.name }}
              </div>
              <div class="entity-card-meta">
                <span>{{ sc.criteria.length }} criteria</span>
                <span>{{ sc.entityTypes.map(t => ({products:'Products',services:'Services',components:'Components',resources:'Resources',repositories:'Repos'}[t]||t)).join(', ') }}</span>
                <span>{{ scorecardOverallPct(sc) }}% avg</span>
              </div>
            </div>
          </div>
          <div class="entity-detail" v-if="selectedEntity && currentView==='scorecards'">
            <div class="detail-header">
              <div>
                <div class="detail-title">
                  <span :class="'scorecard-grade grade-'+scorecardOverallGrade(selectedEntity).toLowerCase()" style="margin-right:6px">{{ scorecardOverallGrade(selectedEntity) }}</span>
                  {{ selectedEntity.name }}
                </div>
                <div class="detail-id">{{ selectedEntity.description || 'No description' }}</div>
              </div>
              <div class="detail-actions"><button class="btn btn-secondary" @click="openEditForm('scorecards',selectedEntity)">Edit</button><button class="btn btn-danger" @click="deleteItem('scorecards',selectedEntity.id)">Delete</button></div>
            </div>
            <div class="detail-section">
              <div class="detail-section-title">Overview</div>
              <div class="detail-grid">
                <span class="detail-label">Applies to</span><span class="detail-value">{{ selectedEntity.entityTypes.map(t => ({products:'Products',services:'Services',components:'Components',resources:'Resources',repositories:'Repositories'}[t]||t)).join(', ') }}</span>
                <span class="detail-label">Criteria</span><span class="detail-value mono">{{ selectedEntity.criteria.length }} checks</span>
                <span class="detail-label">Average Score</span><span class="detail-value"><span :class="'scorecard-pct'" :style="'color:'+gradeColor(scorecardOverallGrade(selectedEntity))">{{ scorecardOverallPct(selectedEntity) }}%</span></span>
              </div>
            </div>
            <div class="detail-section">
              <div class="detail-section-title">Criteria</div>
              <div v-for="c in selectedEntity.criteria" :key="c.id" style="padding:8px 0;border-bottom:1px solid var(--surface2)">
                <div style="display:flex;align-items:center;gap:8px">
                  <span style="font-weight:500;font-size:13px">{{ c.name }}</span>
                  <span class="badge" :class="'badge-'+(c.weight>=3?'critical':c.weight>=2?'major':'minor')" style="font-size:9px">wt {{ c.weight }}</span>
                  <span class="badge badge-team" style="font-size:9px">{{ checkTypeLabel(c.check.type) }}</span>
                </div>
                <div v-if="c.description" style="font-size:11px;color:var(--text-dim);margin-top:2px">{{ c.description }}</div>
              </div>
              <div v-if="!selectedEntity.criteria.length" style="color:var(--text-dim);font-size:12px;padding:12px 0">No criteria defined</div>
            </div>
            <div class="detail-section" v-for="eType in selectedEntity.entityTypes" :key="eType">
              <div class="detail-section-title">{{ ({products:'Products',services:'Services',components:'Components',resources:'Resources',repositories:'Repositories'}[eType]||eType) }} Results</div>
              <div v-if="!inventory[eType].length" style="color:var(--text-dim);font-size:12px;padding:8px 0">No {{ eType }} found</div>
              <div v-for="ent in inventory[eType]" :key="ent.id" class="scorecard-entity-row" @click="navigate(eType);$nextTick(()=>selectItem(eType,ent))">
                <span :class="'scorecard-mini-grade scorecard-grade grade-'+entityGrade(selectedEntity,ent).toLowerCase()" style="width:24px;height:24px;font-size:11px;border-width:1.5px">{{ entityGrade(selectedEntity,ent) }}</span>
                <span style="flex:1;font-weight:500;font-size:13px">{{ ent.name }}</span>
                <div class="scorecard-bar" style="max-width:120px">
                  <div :class="'scorecard-bar-fill fill-'+entityGrade(selectedEntity,ent).toLowerCase()" :style="'width:'+entityScorePct(selectedEntity,ent)+'%'"></div>
                </div>
                <span class="scorecard-pct" :style="'color:'+gradeColor(entityGrade(selectedEntity,ent))">{{ entityScorePct(selectedEntity,ent) }}%</span>
              </div>
            </div>
          </div>
          <div class="empty-state" v-else><div class="empty-state-icon">âœ…</div><div style="color:#5a7a96;font-size:14px">Select a scorecard to view results</div></div>
        </div>
      </div>

      <!-- INCIDENTS -->
      <div v-if="currentView==='incidents'" style="display:flex;flex-direction:column;flex:1;overflow:hidden">
        <div class="view-header">
          <div><div class="view-title">Incidents</div><div class="view-subtitle">Track events, outages, and degradations across your systems</div></div>
          <button class="btn btn-primary" style="margin-left:auto" @click="openCreateForm('incidents')">+ Create Incident</button>
        </div>
        <div class="entity-layout">
          <div class="entity-list">
            <div class="entity-list-toolbar">
              <input class="search-input" v-model="searchQuery" placeholder="Search incidentsâ€¦"/>
              <select class="form-control" style="width:120px;flex-shrink:0" v-model="typeFilter"><option value="">All statuses</option><option value="investigating">Investigating</option><option value="identified">Identified</option><option value="monitoring">Monitoring</option><option value="resolved">Resolved</option></select>
            </div>
            <div v-if="!filteredIncidents.length" class="empty-list">No incidents found</div>
            <div v-for="inc in filteredIncidents" :key="inc.id" class="entity-card incident-card" :class="{selected:selectedId===inc.id, 'active-incident':inc.status!=='resolved', 'resolved-incident':inc.status==='resolved'}" @click="selectItem('incidents',inc)">
              <div class="entity-card-name">
                <span :class="'badge badge-'+inc.severity">{{ inc.severity }}</span>
                <span :class="'badge badge-'+inc.status">{{ inc.status }}</span>
                {{ inc.title }}
              </div>
              <div class="entity-card-meta">
                <span>{{ (inc.affectedEntityIds||[]).length }} affected</span>
                <span>{{ formatDate(inc.createdAt) }}</span>
              </div>
            </div>
          </div>
          <div class="entity-detail" v-if="selectedEntity && currentView==='incidents'">
            <div :class="'impact-panel '+(selectedEntity.severity==='critical'?'outage':'degraded')" style="margin-bottom:20px" v-if="selectedEntity.status!=='resolved'">
              <div class="impact-panel-title">
                {{ selectedEntity.severity==='critical'?'ðŸ”´':'ðŸŸ¡' }} {{ selectedEntity.status.toUpperCase() }} â€” {{ selectedEntity.title }}
              </div>
            </div>
            <div class="detail-header">
              <div>
                <div class="detail-title">{{ selectedEntity.title }}
                  <span :class="'badge badge-'+selectedEntity.severity">{{ selectedEntity.severity }}</span>
                  <span :class="'badge badge-'+selectedEntity.status">{{ selectedEntity.status }}</span>
                </div>
                <div class="detail-id">ID: {{ selectedEntity.id }} Â· Created {{ formatDate(selectedEntity.createdAt) }}</div>
              </div>
              <div class="detail-actions">
                <template v-if="selectedEntity.status!=='resolved'">
                  <button v-if="selectedEntity.status==='investigating'" class="btn btn-warning btn-sm" @click="advanceIncidentStatus(selectedEntity,'identified')">â†’ Identified</button>
                  <button v-if="selectedEntity.status==='identified'" class="btn btn-secondary btn-sm" style="border-color:#0069A7;color:#0069A7" @click="advanceIncidentStatus(selectedEntity,'monitoring')">â†’ Monitoring</button>
                  <button class="btn btn-success btn-sm" @click="advanceIncidentStatus(selectedEntity,'resolved')">âœ“ Resolve</button>
                </template>
                <button v-if="selectedEntity.status==='resolved'" class="btn btn-warning btn-sm" @click="reopenIncident(selectedEntity)">â†º Reopen</button>
                <button class="btn btn-secondary" @click="openEditForm('incidents',selectedEntity)">Edit</button>
                <button class="btn btn-danger" @click="deleteItem('incidents',selectedEntity.id)">Delete</button>
              </div>
            </div>
            <div class="detail-section">
              <div class="detail-section-title">Details</div>
              <div class="detail-grid">
                <span class="detail-label">Severity</span><span class="detail-value"><span :class="'badge badge-'+selectedEntity.severity">{{ selectedEntity.severity }}</span></span>
                <span class="detail-label">Status</span><span class="detail-value"><span :class="'badge badge-'+selectedEntity.status">{{ selectedEntity.status }}</span></span>
                <span class="detail-label">Impact</span><span class="detail-value"><span :class="'badge badge-'+selectedEntity.impactType">{{ selectedEntity.impactType }}</span></span>
                <span class="detail-label">Created</span><span class="detail-value mono">{{ formatDate(selectedEntity.createdAt) }}</span>
                <span class="detail-label">Updated</span><span class="detail-value mono">{{ formatDate(selectedEntity.updatedAt) }}</span>
                <span class="detail-label" v-if="selectedEntity.resolvedAt">Resolved</span><span class="detail-value mono" v-if="selectedEntity.resolvedAt">{{ formatDate(selectedEntity.resolvedAt) }}</span>
                <span class="detail-label">Description</span><span class="detail-value">{{ selectedEntity.description||'â€”' }}</span>
              </div>
            </div>
            <div class="detail-section">
              <div class="detail-section-title">Affected Entities ({{ (selectedEntity.affectedEntityIds||[]).length }})</div>
              <div class="relation-list">
                <div v-for="e in incidentAffectedEntities" :key="e.id" :class="'relation-chip'+(e.operationalStatus&&e.operationalStatus!=='operational'?' chip-'+e.operationalStatus:'')" @click="navigateTo(e)">
                  <span :class="'badge badge-'+(e.type||e._entityType)">{{ getTypeLabel(e) }}</span>{{ e.name }}
                </div>
                <span v-if="!incidentAffectedEntities.length" style="color:var(--text-dim);font-size:12px">No affected entities</span>
              </div>
            </div>
            <div class="detail-section">
              <div class="detail-section-title">Timeline</div>
              <div class="timeline" v-if="(selectedEntity.timeline||[]).length">
                <div v-for="(entry,i) in selectedEntity.timeline" :key="i" class="timeline-entry" :class="{resolved:entry.status==='resolved'}">
                  <div class="timeline-time">{{ formatDate(entry.timestamp) }} â€” <span :class="'badge badge-'+entry.status">{{ entry.status }}</span></div>
                  <div class="timeline-text">{{ entry.message }}</div>
                </div>
              </div>
              <div v-else style="color:var(--text-dim);font-size:12px">No timeline entries</div>
              <div v-if="selectedEntity.status!=='resolved'" class="timeline-add">
                <input class="search-input" v-model="timelineMessage" placeholder="Add a timeline updateâ€¦" @keyup.enter="addTimelineEntry(selectedEntity)"/>
                <button class="btn btn-secondary btn-sm" @click="addTimelineEntry(selectedEntity)">Add</button>
              </div>
            </div>
          </div>
          <div class="empty-state" v-else><div class="empty-state-icon">âš¡</div><div style="color:#5a7a96;font-size:14px">Select an incident to view details</div></div>
        </div>
      </div>

      <!-- REPOSITORIES -->
      <div v-if="currentView==='repositories'" style="display:flex;flex-direction:column;flex:1;overflow:hidden">
        <div class="view-header">
          <div><div class="view-title">Repositories</div><div class="view-subtitle">Source code repositories linked to your services and components</div></div>
          <button class="btn btn-primary" style="margin-left:auto" @click="openCreateForm('repositories')">+ Add Repository</button>
        </div>
        <div class="entity-layout">
          <div class="entity-list">
            <div class="entity-list-toolbar">
              <input class="search-input" v-model="searchQuery" placeholder="Search repositoriesâ€¦"/>
              <select class="form-control" style="width:120px;flex-shrink:0" v-model="typeFilter"><option value="">All providers</option><option value="github">GitHub</option><option value="gitlab">GitLab</option><option value="azure_devops">Azure DevOps</option><option value="bitbucket">Bitbucket</option></select>
            </div>
            <div v-if="!filteredRepositories.length" class="empty-list">No repositories found</div>
            <div v-for="r in filteredRepositories" :key="r.id" class="entity-card" :class="{selected:selectedId===r.id}" @click="selectItem('repositories',r)">
              <div class="entity-card-name"><span :class="'badge badge-'+r.provider">{{ providerLabels[r.provider]||r.provider }}</span>{{ r.name }}</div>
              <div class="entity-card-meta">
                <span v-if="r.language">{{ r.language }}</span>
                <span v-if="r.defaultBranch" style="font-family:var(--font-mono)">{{ r.defaultBranch }}</span>
                <span>{{ teamName(r.teamId) }}</span>
              </div>
            </div>
          </div>
          <div class="entity-detail" v-if="selectedEntity && currentView==='repositories'">
            <div class="detail-header">
              <div>
                <div class="detail-title">{{ selectedEntity.name }} <span :class="'badge badge-'+selectedEntity.provider">{{ providerLabels[selectedEntity.provider]||selectedEntity.provider }}</span></div>
                <div class="detail-id">ID: {{ selectedEntity.id }}</div>
              </div>
              <div class="detail-actions">
                <a v-if="selectedEntity.url" :href="selectedEntity.url" target="_blank" class="btn btn-secondary btn-sm">â†— Open Repo</a>
                <button class="btn btn-secondary" @click="openEditForm('repositories',selectedEntity)">Edit</button>
                <button class="btn btn-danger" @click="deleteItem('repositories',selectedEntity.id)">Delete</button>
              </div>
            </div>
            <div class="detail-section">
              <div class="detail-section-title">Details</div>
              <div class="detail-grid">
                <span class="detail-label">Provider</span><span class="detail-value"><span :class="'badge badge-'+selectedEntity.provider">{{ providerLabels[selectedEntity.provider] }}</span></span>
                <span class="detail-label">URL</span><span class="detail-value"><a v-if="selectedEntity.url" :href="selectedEntity.url" target="_blank" class="repo-link">{{ selectedEntity.url }}</a><span v-else>â€”</span></span>
                <span class="detail-label">Default Branch</span><span class="detail-value mono">{{ selectedEntity.defaultBranch||'â€”' }}</span>
                <span class="detail-label">Language</span><span class="detail-value">{{ selectedEntity.language||'â€”' }}</span>
                <span class="detail-label">Team</span><span class="detail-value">{{ teamName(selectedEntity.teamId) }}</span>
                <span class="detail-label">Description</span><span class="detail-value">{{ selectedEntity.description||'â€”' }}</span>
              </div>
            </div>
            <div class="detail-section">
              <div class="detail-section-title">Linked Services</div>
              <div class="relation-list">
                <div v-for="s in repoLinkedServices" :key="s.id" class="relation-chip" @click="navigate('services');selectItem('services',s)"><span :class="'badge badge-'+s.type">{{ typeLabels.service[s.type] }}</span>{{ s.name }}</div>
                <span v-if="!repoLinkedServices.length" style="color:var(--text-dim);font-size:12px">Not linked to any services</span>
              </div>
            </div>
            <div class="detail-section">
              <div class="detail-section-title">Linked Components</div>
              <div class="relation-list">
                <div v-for="c in repoLinkedComponents" :key="c.id" class="relation-chip" @click="navigate('components');selectItem('components',c)"><span :class="'badge badge-'+c.type">{{ typeLabels.component[c.type] }}</span>{{ c.name }}</div>
                <span v-if="!repoLinkedComponents.length" style="color:var(--text-dim);font-size:12px">Not linked to any components</span>
              </div>
            </div>
            <div class="detail-section" v-if="entityScorecards('repositories').length">
              <div class="detail-section-title">Scorecards</div>
              <div v-for="sc in entityScorecards('repositories')" :key="sc.id" class="scorecard-mini" @click="navigate('scorecards');$nextTick(()=>selectItem('scorecards',sc))" style="margin-bottom:6px">
                <span :class="'scorecard-mini-grade scorecard-grade grade-'+entityGrade(sc,selectedEntity).toLowerCase()">{{ entityGrade(sc,selectedEntity) }}</span>
                <div style="flex:1;min-width:0"><div style="font-size:12px;font-weight:600;color:var(--text)">{{ sc.name }}</div><div style="display:flex;align-items:center;gap:8px;margin-top:4px"><div class="scorecard-bar"><div :class="'scorecard-bar-fill fill-'+entityGrade(sc,selectedEntity).toLowerCase()" :style="'width:'+entityScorePct(sc,selectedEntity)+'%'"></div></div><span class="scorecard-pct" :style="'color:'+gradeColor(entityGrade(sc,selectedEntity))">{{ entityScorePct(sc,selectedEntity) }}%</span></div></div>
                <div style="display:flex;gap:3px"><span v-for="c in sc.criteria" :key="c.id" :class="'criteria-icon '+(evaluateCriterion(c,selectedEntity)?'pass':'fail')" :title="c.name">{{ evaluateCriterion(c,selectedEntity)?'âœ“':'âœ—' }}</span></div>
              </div>
            </div>
          </div>
          <div class="empty-state" v-else><div class="empty-state-icon">ðŸ“</div><div style="color:#5a7a96;font-size:14px">Select a repository to view details</div></div>
        </div>
      </div>
    </main>
  </div>

  <!-- MODAL -->
  <transition name="fade">
    <div class="modal-overlay" v-if="showModal" @click.self="closeModal">
      <div class="modal">
        <div class="modal-header">
          <div class="modal-title">{{ modalTitle }}</div>
          <button class="btn btn-ghost btn-sm" @click="closeModal">âœ•</button>
        </div>
        <div class="modal-body">

          <template v-if="formType==='teams'">
            <div class="form-group"><label class="form-label">Name *</label><input class="form-control" v-model="formData.name" placeholder="e.g. Platform Engineering"/></div>
            <div class="form-group"><label class="form-label">Description</label><textarea class="form-control" v-model="formData.description" placeholder="What does this team do?"></textarea></div>
            <div class="form-row"><div class="form-group"><label class="form-label">Slack Channel</label><input class="form-control" v-model="formData.slackChannel" placeholder="#team-platform"/></div><div class="form-group"><label class="form-label">Contact Email</label><input class="form-control" v-model="formData.contactEmail" type="email" placeholder="team@holman.com"/></div></div>
          </template>

          <template v-if="formType==='scorecards'">
            <div class="form-group"><label class="form-label">Name *</label><input class="form-control" v-model="formData.name" placeholder="e.g. Enterprise Readiness"/></div>
            <div class="form-group"><label class="form-label">Description</label><textarea class="form-control" v-model="formData.description" placeholder="What does this scorecard evaluate?"></textarea></div>
            <div class="form-group">
              <label class="form-label">Applies to Entity Types *</label>
              <div class="multi-select-container">
                <label class="multi-select-item"><input type="checkbox" value="products" v-model="formData.entityTypes"/>Products</label>
                <label class="multi-select-item"><input type="checkbox" value="services" v-model="formData.entityTypes"/>Services</label>
                <label class="multi-select-item"><input type="checkbox" value="components" v-model="formData.entityTypes"/>Components</label>
                <label class="multi-select-item"><input type="checkbox" value="resources" v-model="formData.entityTypes"/>Resources</label>
                <label class="multi-select-item"><input type="checkbox" value="repositories" v-model="formData.entityTypes"/>Repositories</label>
              </div>
            </div>
            <div class="form-section-title">Criteria</div>
            <div v-for="(c,i) in formData.criteria" :key="i" style="border:1px solid var(--border);border-radius:var(--radius);padding:12px;margin-bottom:8px;background:var(--surface2)">
              <div style="display:flex;align-items:center;gap:8px;margin-bottom:8px">
                <span style="font-weight:600;font-size:12px;color:var(--text-dim);font-family:var(--font-mono)">#{{ i+1 }}</span>
                <input class="form-control" style="flex:1" v-model="c.name" placeholder="Criterion name"/>
                <button class="btn btn-ghost btn-sm" @click="formData.criteria.splice(i,1)">âœ•</button>
              </div>
              <div class="form-group" style="margin-bottom:8px"><input class="form-control" v-model="c.description" placeholder="Description (optional)"/></div>
              <div style="display:flex;gap:8px;align-items:end">
                <div style="flex:1"><label class="form-label">Check Type</label><select class="form-control" v-model="c.check.type">
                  <option value="hasField">Has field (non-empty)</option>
                  <option value="hasItems">Has items (array not empty)</option>
                  <option value="minItems">Min items in array</option>
                  <option value="fieldEquals">Field equals value</option>
                  <option value="fieldNotEquals">Field not equals value</option>
                  <option value="hasAssignment">Has assignment with role</option>
                  <option value="minAssignments">Min number of assignments</option>
                  <option value="hasAttribute">Has attribute (non-empty)</option>
                  <option value="noActiveIncidents">No active incidents</option>
                  <option value="hasTag">Has specific tag</option>
                </select></div>
                <div v-if="['hasField','hasItems','minItems','fieldEquals','fieldNotEquals','hasAttribute','hasTag'].includes(c.check.type)" style="flex:1"><label class="form-label">Field / Key</label><input class="form-control" v-model="c.check.field" placeholder="e.g. teamId, description, tags"/></div>
                <div v-if="['fieldEquals','fieldNotEquals','hasAssignment','hasTag'].includes(c.check.type)" style="flex:1"><label class="form-label">Value / Role</label><input class="form-control" v-model="c.check.value" placeholder="e.g. active, Lead"/></div>
                <div v-if="['minItems','minAssignments'].includes(c.check.type)" style="width:80px"><label class="form-label">Min</label><input class="form-control" type="number" v-model.number="c.check.min" min="1"/></div>
                <div style="width:80px"><label class="form-label">Weight</label><select class="form-control" v-model.number="c.weight"><option :value="1">1 (Low)</option><option :value="2">2 (Med)</option><option :value="3">3 (High)</option></select></div>
              </div>
            </div>
            <button class="btn btn-secondary btn-sm" @click="formData.criteria.push({id:generateId(),name:'',description:'',weight:1,check:{type:'hasField',field:'',value:'',min:1}})">+ Add Criterion</button>
          </template>

          <template v-if="formType==='owners'">
            <div class="form-row"><div class="form-group"><label class="form-label">Name *</label><input class="form-control" v-model="formData.name" placeholder="Full name"/></div><div class="form-group"><label class="form-label">Email *</label><input class="form-control" v-model="formData.email" type="email" placeholder="email@holman.com"/></div></div>
            <div class="form-row"><div class="form-group"><label class="form-label">Team</label><select class="form-control" v-model="formData.teamId"><option value="">â€” Select â€”</option><option v-for="t in inventory.teams" :key="t.id" :value="t.id">{{ t.name }}</option></select></div><div class="form-group"><label class="form-label">Role</label><input class="form-control" v-model="formData.role" placeholder="Engineer, Manager, Architectâ€¦"/></div></div>
            <div class="form-group"><label class="form-label">Slack Handle</label><input class="form-control" v-model="formData.slack" placeholder="@username"/></div>
          </template>

          <template v-if="formType==='products'">
            <div class="form-group"><label class="form-label">Name *</label><input class="form-control" v-model="formData.name"/></div>
            <div class="form-group"><label class="form-label">Description</label><textarea class="form-control" v-model="formData.description"></textarea></div>
            <div class="form-row"><div class="form-group"><label class="form-label">Team</label><select class="form-control" v-model="formData.teamId"><option value="">â€” Select â€”</option><option v-for="t in inventory.teams" :key="t.id" :value="t.id">{{ t.name }}</option></select></div><div class="form-group"><label class="form-label">Status</label><select class="form-control" v-model="formData.status"><option value="active">Active</option><option value="planned">Planned</option><option value="maintenance">Maintenance</option><option value="deprecated">Deprecated</option></select></div></div>
            <div class="form-row"><div class="form-group"><label class="form-label">Version</label><input class="form-control" v-model="formData.version" placeholder="1.0.0"/></div><div class="form-group"><label class="form-label">Tags (comma separated)</label><input class="form-control" v-model="formData.tagsRaw"/></div></div>
            <div class="form-group"><label class="form-label">Services</label><div class="multi-select-container"><div v-if="!inventory.services.length" style="padding:12px;color:var(--text-dim);font-size:12px">No services yet</div><label v-for="s in inventory.services" :key="s.id" class="multi-select-item"><input type="checkbox" :value="s.id" v-model="formData.serviceIds"/><span :class="'badge badge-'+s.type">{{ typeLabels.service[s.type] }}</span>{{ s.name }}</label></div></div>
            <div class="form-section-title">Assignments</div>
            <div v-for="(a,i) in formData.assignments" :key="i" style="display:flex;gap:8px;margin-bottom:8px;align-items:center">
              <select class="form-control" style="flex:1" v-model="a.personId"><option value="">â€” Person â€”</option><option v-for="o in inventory.owners" :key="o.id" :value="o.id">{{ o.name }}</option></select>
              <select class="form-control" style="flex:1" v-model="a.role"><option value="">â€” Role â€”</option><option value="Product Manager">Product Manager</option><option value="Lead">Lead</option><option value="Stakeholder">Stakeholder</option><option value="Engineer">Engineer</option><option value="Architect">Architect</option></select>
              <button class="btn btn-ghost btn-sm" @click="formData.assignments.splice(i,1)">âœ•</button>
            </div>
            <button class="btn btn-secondary btn-sm" @click="formData.assignments.push({personId:'',role:''})">+ Add Assignment</button>
          </template>

          <template v-if="formType==='services'">
            <div class="form-row"><div class="form-group"><label class="form-label">Name *</label><input class="form-control" v-model="formData.name"/></div><div class="form-group"><label class="form-label">Type *</label><select class="form-control" v-model="formData.type"><option value="">â€” Select â€”</option><option v-for="(label,type) in typeLabels.service" :key="type" :value="type">{{ label }}</option></select></div></div>
            <div class="form-group"><label class="form-label">Description</label><textarea class="form-control" v-model="formData.description"></textarea></div>
            <div class="form-row"><div class="form-group"><label class="form-label">Team</label><select class="form-control" v-model="formData.teamId"><option value="">â€” Select â€”</option><option v-for="t in inventory.teams" :key="t.id" :value="t.id">{{ t.name }}</option></select></div><div class="form-group"><label class="form-label">Status</label><select class="form-control" v-model="formData.status"><option value="active">Active</option><option value="planned">Planned</option><option value="maintenance">Maintenance</option><option value="deprecated">Deprecated</option></select></div></div>
            <template v-if="formData.type"><div class="form-section-title">{{ typeLabels.service[formData.type] }} Attributes</div><template v-for="f in currentTypeFields" :key="f.key"><div class="form-group"><label class="form-label">{{ f.label }}</label><template v-if="f.type==='select'"><select class="form-control" v-model="formData.attributes[f.key]"><option value="">â€”</option><option v-for="opt in f.options" :key="opt" :value="opt">{{ opt }}</option></select></template><template v-else-if="f.type==='checkbox'"><label class="form-check"><input type="checkbox" v-model="formData.attributes[f.key]"/><span>Enabled</span></label></template><template v-else><input :type="f.type" class="form-control" v-model="formData.attributes[f.key]" :placeholder="f.label"/></template></div></template></template>
            <div class="form-group"><label class="form-label">Components</label><div class="multi-select-container"><div v-if="!inventory.components.length" style="padding:12px;color:var(--text-dim);font-size:12px">No components yet</div><label v-for="c in inventory.components" :key="c.id" class="multi-select-item"><input type="checkbox" :value="c.id" v-model="formData.componentIds"/><span :class="'badge badge-'+c.type">{{ typeLabels.component[c.type] }}</span>{{ c.name }}</label></div></div>
            <div class="form-group"><label class="form-label">Runs On (Resources)</label><div class="multi-select-container"><div v-if="!inventory.resources.length" style="padding:12px;color:var(--text-dim);font-size:12px">No resources yet</div><label v-for="r in inventory.resources" :key="r.id" class="multi-select-item"><input type="checkbox" :value="r.id" v-model="formData.resourceIds"/><span :class="'badge badge-'+r.type">{{ typeLabels.resource[r.type] }}</span>{{ r.name }}</label></div></div>
            <div class="form-group"><label class="form-label">Depends On (Services)</label><div class="multi-select-container"><div v-if="!otherServices.length" style="padding:12px;color:var(--text-dim);font-size:12px">No other services</div><label v-for="s in otherServices" :key="s.id" class="multi-select-item"><input type="checkbox" :value="s.id" v-model="formData.dependsOnServiceIds"/><span :class="'badge badge-'+s.type">{{ typeLabels.service[s.type] }}</span>{{ s.name }}</label></div></div>
            <div class="form-group"><label class="form-label">Repositories</label><div class="multi-select-container"><div v-if="!inventory.repositories.length" style="padding:12px;color:var(--text-dim);font-size:12px">No repositories yet</div><label v-for="r in inventory.repositories" :key="r.id" class="multi-select-item"><input type="checkbox" :value="r.id" v-model="formData.repositoryIds"/><span :class="'badge badge-'+r.provider">{{ providerLabels[r.provider] }}</span>{{ r.name }}</label></div></div>
            <div class="form-section-title">Assignments</div>
            <div v-for="(a,i) in formData.assignments" :key="i" style="display:flex;gap:8px;margin-bottom:8px;align-items:center">
              <select class="form-control" style="flex:1" v-model="a.personId"><option value="">â€” Person â€”</option><option v-for="o in inventory.owners" :key="o.id" :value="o.id">{{ o.name }}</option></select>
              <select class="form-control" style="flex:1" v-model="a.role"><option value="">â€” Role â€”</option><option value="Lead">Lead</option><option value="Stakeholder">Stakeholder</option><option value="Engineer">Engineer</option><option value="Architect">Architect</option><option value="On-Call">On-Call</option></select>
              <button class="btn btn-ghost btn-sm" @click="formData.assignments.splice(i,1)">âœ•</button>
            </div>
            <button class="btn btn-secondary btn-sm" @click="formData.assignments.push({personId:'',role:''})">+ Add Assignment</button>
          </template>

          <template v-if="formType==='components'">
            <div class="form-row"><div class="form-group"><label class="form-label">Name *</label><input class="form-control" v-model="formData.name"/></div><div class="form-group"><label class="form-label">Type *</label><select class="form-control" v-model="formData.type"><option value="">â€” Select â€”</option><option v-for="(label,type) in typeLabels.component" :key="type" :value="type">{{ label }}</option></select></div></div>
            <div class="form-group"><label class="form-label">Description</label><textarea class="form-control" v-model="formData.description"></textarea></div>
            <div class="form-row"><div class="form-group"><label class="form-label">Team</label><select class="form-control" v-model="formData.teamId"><option value="">â€” Select â€”</option><option v-for="t in inventory.teams" :key="t.id" :value="t.id">{{ t.name }}</option></select></div><div class="form-group"><label class="form-label">Status</label><select class="form-control" v-model="formData.status"><option value="active">Active</option><option value="planned">Planned</option><option value="maintenance">Maintenance</option><option value="deprecated">Deprecated</option></select></div></div>
            <template v-if="formData.type"><div class="form-section-title">{{ typeLabels.component[formData.type] }} Attributes</div><template v-for="f in currentTypeFields" :key="f.key"><div class="form-group"><label class="form-label">{{ f.label }}</label><template v-if="f.type==='select'"><select class="form-control" v-model="formData.attributes[f.key]"><option value="">â€”</option><option v-for="opt in f.options" :key="opt" :value="opt">{{ opt }}</option></select></template><template v-else-if="f.type==='checkbox'"><label class="form-check"><input type="checkbox" v-model="formData.attributes[f.key]"/><span>Enabled</span></label></template><template v-else><input :type="f.type" class="form-control" v-model="formData.attributes[f.key]" :placeholder="f.label"/></template></div></template></template>
            <div class="form-group"><label class="form-label">Depends On (Components)</label><div class="multi-select-container"><div v-if="!otherComponents.length" style="padding:12px;color:var(--text-dim);font-size:12px">No other components</div><label v-for="c in otherComponents" :key="c.id" class="multi-select-item"><input type="checkbox" :value="c.id" v-model="formData.dependsOnComponentIds"/><span :class="'badge badge-'+c.type">{{ typeLabels.component[c.type] }}</span>{{ c.name }}</label></div></div>
            <div class="form-group"><label class="form-label">Depends On (Services)</label><div class="multi-select-container"><div v-if="!inventory.services.length" style="padding:12px;color:var(--text-dim);font-size:12px">No services yet</div><label v-for="s in inventory.services" :key="s.id" class="multi-select-item"><input type="checkbox" :value="s.id" v-model="formData.dependsOnServiceIds"/><span :class="'badge badge-'+s.type">{{ typeLabels.service[s.type] }}</span>{{ s.name }}</label></div></div>
            <div class="form-group"><label class="form-label">Repositories</label><div class="multi-select-container"><div v-if="!inventory.repositories.length" style="padding:12px;color:var(--text-dim);font-size:12px">No repositories yet</div><label v-for="r in inventory.repositories" :key="r.id" class="multi-select-item"><input type="checkbox" :value="r.id" v-model="formData.repositoryIds"/><span :class="'badge badge-'+r.provider">{{ providerLabels[r.provider] }}</span>{{ r.name }}</label></div></div>
            <div class="form-section-title">Assignments</div>
            <div v-for="(a,i) in formData.assignments" :key="i" style="display:flex;gap:8px;margin-bottom:8px;align-items:center">
              <select class="form-control" style="flex:1" v-model="a.personId"><option value="">â€” Person â€”</option><option v-for="o in inventory.owners" :key="o.id" :value="o.id">{{ o.name }}</option></select>
              <select class="form-control" style="flex:1" v-model="a.role"><option value="">â€” Role â€”</option><option value="Lead">Lead</option><option value="Stakeholder">Stakeholder</option><option value="Engineer">Engineer</option><option value="Architect">Architect</option><option value="On-Call">On-Call</option></select>
              <button class="btn btn-ghost btn-sm" @click="formData.assignments.splice(i,1)">âœ•</button>
            </div>
            <button class="btn btn-secondary btn-sm" @click="formData.assignments.push({personId:'',role:''})">+ Add Assignment</button>
          </template>

          <template v-if="formType==='resources'">
            <div class="form-row"><div class="form-group"><label class="form-label">Name *</label><input class="form-control" v-model="formData.name" placeholder="e.g. prod-api-vm-01"/></div><div class="form-group"><label class="form-label">Type *</label><select class="form-control" v-model="formData.type"><option value="">â€” Select â€”</option><option v-for="(label,type) in typeLabels.resource" :key="type" :value="type">{{ label }}</option></select></div></div>
            <div class="form-group"><label class="form-label">Description</label><textarea class="form-control" v-model="formData.description"></textarea></div>
            <div class="form-row"><div class="form-group"><label class="form-label">Team</label><select class="form-control" v-model="formData.teamId"><option value="">â€” Select â€”</option><option v-for="t in inventory.teams" :key="t.id" :value="t.id">{{ t.name }}</option></select></div><div class="form-group"><label class="form-label">Environment</label><select class="form-control" v-model="formData.environment"><option value="production">Production</option><option value="staging">Staging</option><option value="development">Development</option><option value="dr">DR</option></select></div></div>
            <template v-if="formData.type"><div class="form-section-title">{{ typeLabels.resource[formData.type] }} Attributes</div><template v-for="f in currentTypeFields" :key="f.key"><div class="form-group"><label class="form-label">{{ f.label }}</label><template v-if="f.type==='select'"><select class="form-control" v-model="formData.attributes[f.key]"><option value="">â€”</option><option v-for="opt in f.options" :key="opt" :value="opt">{{ opt }}</option></select></template><template v-else-if="f.type==='checkbox'"><label class="form-check"><input type="checkbox" v-model="formData.attributes[f.key]"/><span>Enabled</span></label></template><template v-else><input :type="f.type" class="form-control" v-model="formData.attributes[f.key]" :placeholder="f.label"/></template></div></template></template>
            <div class="form-section-title">Assignments</div>
            <div v-for="(a,i) in formData.assignments" :key="i" style="display:flex;gap:8px;margin-bottom:8px;align-items:center">
              <select class="form-control" style="flex:1" v-model="a.personId"><option value="">â€” Person â€”</option><option v-for="o in inventory.owners" :key="o.id" :value="o.id">{{ o.name }}</option></select>
              <select class="form-control" style="flex:1" v-model="a.role"><option value="">â€” Role â€”</option><option value="Lead">Lead</option><option value="Stakeholder">Stakeholder</option><option value="Engineer">Engineer</option><option value="Architect">Architect</option><option value="On-Call">On-Call</option></select>
              <button class="btn btn-ghost btn-sm" @click="formData.assignments.splice(i,1)">âœ•</button>
            </div>
            <button class="btn btn-secondary btn-sm" @click="formData.assignments.push({personId:'',role:''})">+ Add Assignment</button>
          </template>

          <template v-if="formType==='incidents'">
            <div class="form-group"><label class="form-label">Title *</label><input class="form-control" v-model="formData.title" placeholder="Brief incident title"/></div>
            <div class="form-group"><label class="form-label">Description</label><textarea class="form-control" v-model="formData.description" placeholder="What happened? What is the impact?"></textarea></div>
            <div class="form-row">
              <div class="form-group"><label class="form-label">Severity *</label><select class="form-control" v-model="formData.severity"><option value="critical">Critical</option><option value="major">Major</option><option value="minor">Minor</option></select></div>
              <div class="form-group"><label class="form-label">Impact Type</label><select class="form-control" v-model="formData.impactType"><option value="outage">Outage</option><option value="degraded">Degraded</option></select></div>
            </div>
            <div class="form-group" v-if="formMode==='edit'"><label class="form-label">Status</label><select class="form-control" v-model="formData.status"><option value="investigating">Investigating</option><option value="identified">Identified</option><option value="monitoring">Monitoring</option><option value="resolved">Resolved</option></select></div>
            <div class="form-group">
              <label class="form-label">Affected Services</label>
              <div class="multi-select-container">
                <div v-if="!inventory.services.length" style="padding:12px;color:var(--text-dim);font-size:12px">No services yet</div>
                <label v-for="s in inventory.services" :key="s.id" class="multi-select-item"><input type="checkbox" :value="s.id" v-model="formData.affectedEntityIds"/><span :class="'badge badge-'+s.type">{{ typeLabels.service[s.type] }}</span>{{ s.name }}</label>
              </div>
            </div>
            <div class="form-group">
              <label class="form-label">Affected Components</label>
              <div class="multi-select-container">
                <div v-if="!inventory.components.length" style="padding:12px;color:var(--text-dim);font-size:12px">No components yet</div>
                <label v-for="c in inventory.components" :key="c.id" class="multi-select-item"><input type="checkbox" :value="c.id" v-model="formData.affectedEntityIds"/><span :class="'badge badge-'+c.type">{{ typeLabels.component[c.type] }}</span>{{ c.name }}</label>
              </div>
            </div>
            <div class="form-group">
              <label class="form-label">Affected Resources</label>
              <div class="multi-select-container">
                <div v-if="!inventory.resources.length" style="padding:12px;color:var(--text-dim);font-size:12px">No resources yet</div>
                <label v-for="r in inventory.resources" :key="r.id" class="multi-select-item"><input type="checkbox" :value="r.id" v-model="formData.affectedEntityIds"/><span :class="'badge badge-'+r.type">{{ typeLabels.resource[r.type] }}</span>{{ r.name }}</label>
              </div>
            </div>
          </template>

          <template v-if="formType==='repositories'">
            <div class="form-group"><label class="form-label">Name *</label><input class="form-control" v-model="formData.name" placeholder="e.g. holman/customer-api"/></div>
            <div class="form-group"><label class="form-label">URL</label><input class="form-control" v-model="formData.url" type="url" placeholder="https://github.com/org/repo"/></div>
            <div class="form-group"><label class="form-label">Description</label><textarea class="form-control" v-model="formData.description"></textarea></div>
            <div class="form-row">
              <div class="form-group"><label class="form-label">Provider *</label><select class="form-control" v-model="formData.provider"><option value="github">GitHub</option><option value="gitlab">GitLab</option><option value="azure_devops">Azure DevOps</option><option value="bitbucket">Bitbucket</option></select></div>
              <div class="form-group"><label class="form-label">Default Branch</label><input class="form-control" v-model="formData.defaultBranch" placeholder="main"/></div>
            </div>
            <div class="form-row">
              <div class="form-group"><label class="form-label">Language</label><input class="form-control" v-model="formData.language" placeholder="Python, TypeScript, C#â€¦"/></div>
              <div class="form-group"><label class="form-label">Team</label><select class="form-control" v-model="formData.teamId"><option value="">â€” Select â€”</option><option v-for="t in inventory.teams" :key="t.id" :value="t.id">{{ t.name }}</option></select></div>
            </div>
            <div class="form-section-title">Assignments</div>
            <div v-for="(a,i) in formData.assignments" :key="i" style="display:flex;gap:8px;margin-bottom:8px;align-items:center">
              <select class="form-control" style="flex:1" v-model="a.personId"><option value="">â€” Person â€”</option><option v-for="o in inventory.owners" :key="o.id" :value="o.id">{{ o.name }}</option></select>
              <select class="form-control" style="flex:1" v-model="a.role"><option value="">â€” Role â€”</option><option value="Lead">Lead</option><option value="Stakeholder">Stakeholder</option><option value="Engineer">Engineer</option><option value="Architect">Architect</option><option value="On-Call">On-Call</option></select>
              <button class="btn btn-ghost btn-sm" @click="formData.assignments.splice(i,1)">âœ•</button>
            </div>
            <button class="btn btn-secondary btn-sm" @click="formData.assignments.push({personId:'',role:''})">+ Add Assignment</button>
          </template>

        </div>
        <div class="modal-footer">
          <button class="btn btn-secondary" @click="closeModal">Cancel</button>
          <button class="btn btn-primary" @click="saveForm">{{ formMode==='create'?'Create':'Save Changes' }}</button>
        </div>
      </div>
    </div>
  </transition>
</div>

<script>
const{createApp}=Vue;

const typeSchemas={
  service:{
    api:{fields:[{key:'endpoint',label:'Base Endpoint',type:'text'},{key:'protocol',label:'Protocol',type:'select',options:['REST','GraphQL','gRPC','SOAP','WebSocket']},{key:'authMethod',label:'Auth Method',type:'select',options:['API Key','OAuth2','JWT','Basic Auth','mTLS','None']},{key:'rateLimit',label:'Rate Limit (req/min)',type:'number'},{key:'sla',label:'SLA (%)',type:'text'},{key:'version',label:'API Version',type:'text'}]},
    web_application:{fields:[{key:'url',label:'URL',type:'text'},{key:'framework',label:'Framework',type:'text'},{key:'hosting',label:'Hosting',type:'select',options:['Azure','AWS','GCP','On-Premise','Hybrid']},{key:'cdn',label:'CDN',type:'text'},{key:'authentication',label:'Authentication',type:'select',options:['SSO','SAML','OAuth2','Local','Mixed']}]},
    database:{fields:[{key:'dbType',label:'Database Type',type:'select',options:['PostgreSQL','MySQL','SQL Server','Oracle','MongoDB','Cosmos DB','Redis','Elasticsearch','Other']},{key:'version',label:'Version',type:'text'},{key:'hosting',label:'Hosting',type:'select',options:['Azure','AWS','GCP','On-Premise','Managed Service']},{key:'backupFrequency',label:'Backup Frequency',type:'select',options:['Continuous','Hourly','Daily','Weekly']},{key:'encryption',label:'Encryption at Rest',type:'checkbox'}]},
    message_queue:{fields:[{key:'broker',label:'Broker',type:'select',options:['Azure Service Bus','RabbitMQ','Apache Kafka','AWS SQS','Redis Streams','Other']},{key:'topics',label:'Topics / Queues',type:'text'},{key:'retentionDays',label:'Retention (days)',type:'number'},{key:'dlq',label:'Dead Letter Queue',type:'checkbox'}]},
    cache:{fields:[{key:'cacheType',label:'Cache Type',type:'select',options:['Redis','Memcached','Azure Cache','CDN','In-Memory','Other']},{key:'ttl',label:'Default TTL (seconds)',type:'number'},{key:'size',label:'Max Size (MB)',type:'number'}]},
    infrastructure:{fields:[{key:'provider',label:'Provider',type:'select',options:['Azure','AWS','GCP','On-Premise','Hybrid']},{key:'region',label:'Region',type:'text'},{key:'redundancy',label:'Redundancy',type:'select',options:['None','Zone Redundant','Geo Redundant','Active-Active']},{key:'iac',label:'IaC Tool',type:'select',options:['Terraform','Bicep','ARM','Pulumi','None']}]}
  },
  component:{
    library:{fields:[{key:'language',label:'Language',type:'select',options:['Python','JavaScript','TypeScript','C#','Java','Go','Rust','Other']},{key:'version',label:'Version',type:'text'},{key:'repository',label:'Repository URL',type:'text'},{key:'license',label:'License',type:'text'}]},
    microservice:{fields:[{key:'runtime',label:'Runtime',type:'text'},{key:'containerized',label:'Containerized',type:'checkbox'},{key:'repository',label:'Repository',type:'text'},{key:'cicd',label:'CI/CD Platform',type:'select',options:['GitHub Actions','Azure DevOps','Jenkins','GitLab CI','Other']}]},
    sdk:{fields:[{key:'vendor',label:'Vendor',type:'text'},{key:'version',label:'Version',type:'text'},{key:'language',label:'Language',type:'text'},{key:'documentation',label:'Documentation URL',type:'text'}]},
    agent:{fields:[{key:'runtime',label:'Runtime',type:'text'},{key:'schedule',label:'Schedule / Trigger',type:'text'},{key:'containerized',label:'Containerized',type:'checkbox'},{key:'repository',label:'Repository',type:'text'}]},
    ui_component:{fields:[{key:'framework',label:'Framework',type:'select',options:['Vue','React','Angular','Web Components','Other']},{key:'repository',label:'Repository',type:'text'},{key:'packageName',label:'Package Name',type:'text'}]}
  },
  resource:{
    ec2:{fields:[{key:'instanceType',label:'Instance Type',type:'text'},{key:'region',label:'Region',type:'text'},{key:'ami',label:'AMI ID',type:'text'},{key:'privateIp',label:'Private IP',type:'text'},{key:'monitoring',label:'Enhanced Monitoring',type:'checkbox'}]},
    virtual_machine:{fields:[{key:'size',label:'VM Size',type:'text'},{key:'os',label:'Operating System',type:'select',options:['Windows Server 2022','Windows Server 2019','Ubuntu 22.04','Ubuntu 20.04','RHEL 8','RHEL 9','Other']},{key:'region',label:'Azure Region',type:'text'},{key:'resourceGroup',label:'Resource Group',type:'text'},{key:'privateIp',label:'Private IP',type:'text'}]},
    logic_app:{fields:[{key:'region',label:'Region',type:'text'},{key:'resourceGroup',label:'Resource Group',type:'text'},{key:'triggerType',label:'Trigger Type',type:'select',options:['HTTP','Schedule','Event Grid','Service Bus','Blob Storage','Other']},{key:'plan',label:'Plan',type:'select',options:['Consumption','Standard','Premium']}]},
    storage_account:{fields:[{key:'region',label:'Region',type:'text'},{key:'resourceGroup',label:'Resource Group',type:'text'},{key:'accountType',label:'Account Kind',type:'select',options:['StorageV2','BlobStorage','FileStorage','BlockBlobStorage']},{key:'replication',label:'Replication',type:'select',options:['LRS','ZRS','GRS','GZRS','RA-GRS']},{key:'tier',label:'Access Tier',type:'select',options:['Hot','Cool','Archive']}]},
    container_instance:{fields:[{key:'image',label:'Container Image',type:'text'},{key:'region',label:'Region',type:'text'},{key:'cpu',label:'CPU Cores',type:'number'},{key:'memory',label:'Memory (GB)',type:'number'},{key:'registry',label:'Container Registry',type:'text'}]},
    kubernetes:{fields:[{key:'clusterName',label:'Cluster Name',type:'text'},{key:'region',label:'Region',type:'text'},{key:'nodeCount',label:'Node Count',type:'number'},{key:'nodeSize',label:'Node Size',type:'text'},{key:'namespace',label:'Namespace',type:'text'},{key:'provider',label:'Provider',type:'select',options:['AKS','EKS','GKE','On-Premise']}]},
    function_app:{fields:[{key:'runtime',label:'Runtime',type:'select',options:['Python','Node.js','C#','.NET','Java','PowerShell']},{key:'region',label:'Region',type:'text'},{key:'resourceGroup',label:'Resource Group',type:'text'},{key:'plan',label:'Plan',type:'select',options:['Consumption','Premium','Dedicated']}]},
    load_balancer:{fields:[{key:'lbType',label:'LB Type',type:'select',options:['Azure Load Balancer','Azure Application Gateway','AWS ALB','AWS NLB','NGINX','HAProxy','Other']},{key:'region',label:'Region',type:'text'},{key:'scheme',label:'Scheme',type:'select',options:['Internal','Public']},{key:'ssl',label:'SSL Termination',type:'checkbox'}]},
    api_gateway:{fields:[{key:'gatewayType',label:'Gateway Type',type:'select',options:['Azure API Management','AWS API Gateway','Kong','Apigee','Other']},{key:'region',label:'Region',type:'text'},{key:'tier',label:'Tier',type:'text'},{key:'rateLimitEnabled',label:'Rate Limiting',type:'checkbox'}]},
    cdn:{fields:[{key:'provider',label:'CDN Provider',type:'select',options:['Cloudflare','Azure CDN','AWS CloudFront','Fastly','Akamai','Other']},{key:'origins',label:'Origin(s)',type:'text'},{key:'cacheRules',label:'Cache Rules',type:'text'},{key:'waf',label:'WAF Enabled',type:'checkbox'}]}
  }
};

const typeLabels={
  service:{api:'API Service',web_application:'Web Application',database:'Database',message_queue:'Message Queue',cache:'Cache',infrastructure:'Infrastructure'},
  component:{library:'Library',microservice:'Microservice',sdk:'SDK / Integration',agent:'Agent / Worker',ui_component:'UI Component'},
  resource:{ec2:'EC2 Instance',virtual_machine:'Virtual Machine',logic_app:'Logic App',storage_account:'Storage Account',container_instance:'Container Instance',kubernetes:'Kubernetes',function_app:'Function App',load_balancer:'Load Balancer',api_gateway:'API Gateway',cdn:'CDN'}
};

const typeColors={
  service:{api:'#0069A7',web_application:'#2C9942',database:'#e08c00',message_queue:'#5a4fcf',cache:'#c0396b',infrastructure:'#5a7a96'},
  component:{library:'#d4650a',microservice:'#c0392b',sdk:'#4a9010',agent:'#5a4fcf',ui_component:'#d4650a'},
  resource:{ec2:'#c07000',virtual_machine:'#0078d4',logic_app:'#7800c8',storage_account:'#0069A7',container_instance:'#007a9e',kubernetes:'#2c60c8',function_app:'#9a6800',load_balancer:'#2C9942',api_gateway:'#003057',cdn:'#5a4fcf'}
};

/* Sample data is loaded from sample-data.json via loadSampleData() */

createApp({
  data(){return{
    inventory:{owners:[],teams:[],products:[],services:[],components:[],resources:[],repositories:[],incidents:[],scorecards:[]},
    currentView:'dashboard',selectedId:null,selectedType:null,
    showModal:false,formType:null,formMode:'create',formData:{},
    searchQuery:'',typeFilter:'',timelineMessage:'',
    graphFilters:['product','service','component','resource'],
    expandedStatusProducts:[],productGraphSimulation:null,
    typeLabels,typeColors,simulation:null,_zoom:null,
    providerLabels:{github:'GitHub',gitlab:'GitLab',azure_devops:'Azure DevOps',bitbucket:'Bitbucket'}
  }},

  computed:{
    selectedEntity(){if(!this.selectedId||!this.selectedType)return null;return this.inventory[this.selectedType]?.find(e=>e.id===this.selectedId)||null},
    activeCount(){return(type)=>this.inventory[type].filter(e=>e.status==='active'||!e.status).length},
    servicesByType(){return this.inventory.services.reduce((a,s)=>{a[s.type]=(a[s.type]||0)+1;return a},{})},
    componentsByType(){return this.inventory.components.reduce((a,c)=>{a[c.type]=(a[c.type]||0)+1;return a},{})},
    resourcesByType(){return this.inventory.resources.reduce((a,r)=>{a[r.type]=(a[r.type]||0)+1;return a},{})},

    // Incident tracking
    degradedItems(){
      const r=[];
      ['services','components','resources'].forEach(t=>{this.inventory[t].forEach(e=>{if(e.operationalStatus==='degraded')r.push({...e,_entityType:t})})});
      return r;
    },
    outageItems(){
      const r=[];
      ['services','components','resources'].forEach(t=>{this.inventory[t].forEach(e=>{if(e.operationalStatus==='outage')r.push({...e,_entityType:t})})});
      return r;
    },
    incidentCount(){return this.degradedItems.length+this.outageItems.length},

    // Team computed
    filteredTeams(){const q=this.searchQuery.toLowerCase();return this.inventory.teams.filter(t=>!q||t.name.toLowerCase().includes(q)||t.description?.toLowerCase().includes(q))},
    teamMembers(){if(!this.selectedEntity)return[];return this.inventory.owners.filter(o=>o.teamId===this.selectedId)},
    teamOwnedProducts(){return this.selectedEntity?this.inventory.products.filter(p=>p.teamId===this.selectedId):[]},
    teamOwnedServices(){return this.selectedEntity?this.inventory.services.filter(s=>s.teamId===this.selectedId):[]},
    teamOwnedComponents(){return this.selectedEntity?this.inventory.components.filter(c=>c.teamId===this.selectedId):[]},
    teamOwnedResources(){return this.selectedEntity?this.inventory.resources.filter(r=>r.teamId===this.selectedId):[]},
    teamOwnedRepositories(){return this.selectedEntity?this.inventory.repositories.filter(r=>r.teamId===this.selectedId):[]},
    // Person computed
    personAssignments(){
      if(!this.selectedEntity)return[];
      const pid=this.selectedId;const results=[];
      ['products','services','components','resources','repositories'].forEach(t=>{
        this.inventory[t].forEach(e=>{
          (e.assignments||[]).forEach(a=>{if(a.personId===pid)results.push({entity:e,entityType:t,role:a.role})});
        });
      });
      return results;
    },

    // Product computed
    productServices(){if(!this.selectedEntity)return[];return(this.selectedEntity.serviceIds||[]).map(id=>this.inventory.services.find(s=>s.id===id)).filter(Boolean)},

    // Service computed
    serviceTypeFields(){if(!this.selectedEntity?.type)return[];return typeSchemas.service[this.selectedEntity.type]?.fields||[]},
    serviceProducts(){if(!this.selectedEntity)return[];return this.inventory.products.filter(p=>(p.serviceIds||[]).includes(this.selectedId))},
    serviceComponents(){if(!this.selectedEntity)return[];return(this.selectedEntity.componentIds||[]).map(id=>this.inventory.components.find(c=>c.id===id)).filter(Boolean)},
    serviceResources(){if(!this.selectedEntity)return[];return(this.selectedEntity.resourceIds||[]).map(id=>this.inventory.resources.find(r=>r.id===id)).filter(Boolean)},
    serviceDependencies(){if(!this.selectedEntity)return[];return(this.selectedEntity.dependsOnServiceIds||[]).map(id=>this.inventory.services.find(s=>s.id===id)).filter(Boolean)},
    downstreamDependentServices(){if(!this.selectedEntity)return[];return this.inventory.services.filter(s=>(s.dependsOnServiceIds||[]).includes(this.selectedId))},

    // Component computed
    componentTypeFields(){if(!this.selectedEntity?.type)return[];return typeSchemas.component[this.selectedEntity.type]?.fields||[]},
    componentServices(){if(!this.selectedEntity)return[];return this.inventory.services.filter(s=>(s.componentIds||[]).includes(this.selectedId))},
    componentDependencies(){if(!this.selectedEntity)return[];return(this.selectedEntity.dependsOnComponentIds||[]).map(id=>this.inventory.components.find(c=>c.id===id)).filter(Boolean)},
    componentServiceDependencies(){if(!this.selectedEntity)return[];return(this.selectedEntity.dependsOnServiceIds||[]).map(id=>this.inventory.services.find(s=>s.id===id)).filter(Boolean)},
    componentsDependingOnService(){if(!this.selectedEntity)return[];return this.inventory.components.filter(c=>(c.dependsOnServiceIds||[]).includes(this.selectedId))},

    // Resource computed
    resourceTypeFields(){if(!this.selectedEntity?.type)return[];return typeSchemas.resource[this.selectedEntity.type]?.fields||[]},
    resourceServices(){if(!this.selectedEntity)return[];return this.inventory.services.filter(s=>(s.resourceIds||[]).includes(this.selectedId))},

    // Repository computed
    entityRepositories(){
      if(!this.selectedEntity)return[];
      const repoIds=this.selectedEntity.repositoryIds||[];
      return repoIds.map(id=>this.inventory.repositories.find(r=>r.id===id)).filter(Boolean);
    },
    repoLinkedServices(){
      if(!this.selectedEntity)return[];
      return this.inventory.services.filter(s=>(s.repositoryIds||[]).includes(this.selectedId));
    },
    repoLinkedComponents(){
      if(!this.selectedEntity)return[];
      return this.inventory.components.filter(c=>(c.repositoryIds||[]).includes(this.selectedId));
    },

    // Incident computed
    activeIncidents(){return this.inventory.incidents.filter(i=>i.status!=='resolved')},
    entityIncidents(){
      if(!this.selectedEntity)return[];
      return this.inventory.incidents.filter(i=>i.status!=='resolved'&&(i.affectedEntityIds||[]).includes(this.selectedId));
    },
    incidentAffectedEntities(){
      if(!this.selectedEntity)return[];
      const ids=this.selectedEntity.affectedEntityIds||[];
      const entities=[];
      ids.forEach(id=>{
        const s=this.inventory.services.find(x=>x.id===id);
        if(s){entities.push({...s,_entityType:'services'});return;}
        const c=this.inventory.components.find(x=>x.id===id);
        if(c){entities.push({...c,_entityType:'components'});return;}
        const r=this.inventory.resources.find(x=>x.id===id);
        if(r){entities.push({...r,_entityType:'resources'});return;}
      });
      return entities;
    },
    filteredIncidents(){
      const q=this.searchQuery.toLowerCase();
      return this.inventory.incidents.filter(i=>
        (!q||i.title.toLowerCase().includes(q)||i.description?.toLowerCase().includes(q))&&
        (!this.typeFilter||i.status===this.typeFilter)
      ).sort((a,b)=>{
        if(a.status==='resolved'&&b.status!=='resolved')return 1;
        if(a.status!=='resolved'&&b.status==='resolved')return -1;
        return new Date(b.createdAt)-new Date(a.createdAt);
      });
    },
    filteredRepositories(){
      const q=this.searchQuery.toLowerCase();
      return this.inventory.repositories.filter(r=>
        (!q||r.name.toLowerCase().includes(q)||r.description?.toLowerCase().includes(q)||r.language?.toLowerCase().includes(q))&&
        (!this.typeFilter||r.provider===this.typeFilter)
      );
    },

    // Filtered lists
    filteredOwners(){const q=this.searchQuery.toLowerCase();return this.inventory.owners.filter(o=>!q||o.name.toLowerCase().includes(q)||o.email?.toLowerCase().includes(q)||o.role?.toLowerCase().includes(q))},
    filteredProducts(){const q=this.searchQuery.toLowerCase();return this.inventory.products.filter(p=>!q||p.name.toLowerCase().includes(q)||p.description?.toLowerCase().includes(q))},
    filteredServices(){const q=this.searchQuery.toLowerCase();return this.inventory.services.filter(s=>(!q||s.name.toLowerCase().includes(q)||s.description?.toLowerCase().includes(q))&&(!this.typeFilter||s.type===this.typeFilter))},
    filteredComponents(){const q=this.searchQuery.toLowerCase();return this.inventory.components.filter(c=>(!q||c.name.toLowerCase().includes(q)||c.description?.toLowerCase().includes(q))&&(!this.typeFilter||c.type===this.typeFilter))},
    filteredResources(){const q=this.searchQuery.toLowerCase();return this.inventory.resources.filter(r=>(!q||r.name.toLowerCase().includes(q)||r.description?.toLowerCase().includes(q))&&(!this.typeFilter||r.type===this.typeFilter))},
    filteredScorecards(){const q=this.searchQuery.toLowerCase();return this.inventory.scorecards.filter(sc=>!q||sc.name.toLowerCase().includes(q)||sc.description?.toLowerCase().includes(q))},

    // Modal
    modalTitle(){const m={teams:'Team',owners:'Person',products:'Product',services:'Service',components:'Component',resources:'Resource',incidents:'Incident',repositories:'Repository',scorecards:'Scorecard'};return`${this.formMode==='create'?'New':'Edit'} ${m[this.formType]||''}`},
    currentTypeFields(){
      if(!this.formData.type)return[];
      if(this.formType==='services')return typeSchemas.service[this.formData.type]?.fields||[];
      if(this.formType==='components')return typeSchemas.component[this.formData.type]?.fields||[];
      if(this.formType==='resources')return typeSchemas.resource[this.formData.type]?.fields||[];
      return[];
    },
    otherServices(){return this.inventory.services.filter(s=>s.id!==this.formData.id)},
    otherComponents(){return this.inventory.components.filter(c=>c.id!==this.formData.id)},

    // Status page computed
    statusPageProducts(){
      return this.inventory.products.map(p=>{
        const services=(p.serviceIds||[]).map(id=>this.inventory.services.find(s=>s.id===id)).filter(Boolean);
        let overallStatus='operational';
        if(services.some(s=>s.operationalStatus==='outage'))overallStatus='outage';
        else if(services.some(s=>s.operationalStatus==='degraded'))overallStatus='degraded';
        return{...p,services,overallStatus};
      });
    },
    statusPageOverall(){
      if(this.statusPageProducts.some(p=>p.overallStatus==='outage'))return'outage';
      if(this.statusPageProducts.some(p=>p.overallStatus==='degraded'))return'degraded';
      return'operational';
    },
    statusPageHasIssues(){return this.statusPageOverall!=='operational'},
  },

  watch:{
    inventory:{deep:true,handler(v){try{localStorage.setItem('appInventory',JSON.stringify(v))}catch(e){}if(this.currentView==='graph')this.$nextTick(()=>this.initGraph())}},
    currentView(v){if(v==='graph')this.$nextTick(()=>this.initGraph())},
    selectedId(v){
      if(v&&this.currentView==='products'){
        this.$nextTick(()=>{
          const ent=this.selectedEntity;
          if(ent)this.initProductGraph(ent);
        });
      }
    },
    'formData.type'(){if(!this.formData.attributes)this.formData.attributes={}}
  },

  methods:{
    navigate(view){this.currentView=view;this.selectedId=null;this.selectedType=null;this.searchQuery='';this.typeFilter='';if(view==='people'){this.currentView='people'}},
    navigateTo(e){
      const t=e._entityType||this.guessEntityType(e);
      this.navigate(t);
      this.$nextTick(()=>this.selectItem(t,e));
    },
    guessEntityType(e){
      if(this.inventory.services.find(x=>x.id===e.id))return'services';
      if(this.inventory.components.find(x=>x.id===e.id))return'components';
      if(this.inventory.resources.find(x=>x.id===e.id))return'resources';
      if(this.inventory.incidents.find(x=>x.id===e.id))return'incidents';
      if(this.inventory.repositories.find(x=>x.id===e.id))return'repositories';
      return'products';
    },
    selectItem(type,item){this.selectedId=item.id;this.selectedType=type},
    ownerName(id){const o=this.inventory.owners.find(o=>o.id===id);return o?o.name:'â€”'},
    ownerInitials(o){return o.name.split(' ').map(n=>n[0]).join('').slice(0,2).toUpperCase()},
    teamName(id){const t=this.inventory.teams.find(t=>t.id===id);return t?t.name:'â€”'},
    teamInitials(t){return t.name.split(/\s+/).map(w=>w[0]).join('').slice(0,2).toUpperCase()},
    teamMemberCount(t){return this.inventory.owners.filter(o=>o.teamId===t.id).length},
    personTeamName(teamId){const t=this.inventory.teams.find(t=>t.id===teamId);return t?t.name:'No Team'},
    findPerson(id){return this.inventory.owners.find(o=>o.id===id)||{name:'Unknown'}},
    isMonoField(k){return['endpoint','url','repository','documentation','packageName','version','email','privateIp','ami','image','origins'].includes(k)},
    generateId(){return Math.random().toString(36).slice(2,9)+Date.now().toString(36)},
    getTypeLabel(e){
      if(typeLabels.service[e.type])return typeLabels.service[e.type];
      if(typeLabels.component[e.type])return typeLabels.component[e.type];
      if(typeLabels.resource[e.type])return typeLabels.resource[e.type];
      return e.type||'Unknown';
    },

    // Scorecard evaluation engine
    evaluateCriterion(criterion, entity){
      const chk=criterion.check;if(!chk||!chk.type)return false;
      switch(chk.type){
        case 'hasField': return !!(entity[chk.field]&&String(entity[chk.field]).trim());
        case 'hasItems': {const arr=entity[chk.field];return Array.isArray(arr)&&arr.length>0;}
        case 'minItems': {const arr=entity[chk.field];return Array.isArray(arr)&&arr.length>=(chk.min||1);}
        case 'fieldEquals': return String(entity[chk.field]||'')===String(chk.value);
        case 'fieldNotEquals': return String(entity[chk.field]||'')!==String(chk.value);
        case 'hasAssignment': return(entity.assignments||[]).some(a=>a.role===chk.value);
        case 'minAssignments': return(entity.assignments||[]).length>=(chk.min||1);
        case 'hasAttribute': return!!(entity.attributes&&entity.attributes[chk.field]&&String(entity.attributes[chk.field]).trim());
        case 'noActiveIncidents': {const id=entity.id;return!this.inventory.incidents.some(i=>i.status!=='resolved'&&(i.affectedEntityIds||[]).includes(id));}
        case 'hasTag': return(entity.tags||[]).some(t=>t.toLowerCase()===String(chk.value||'').toLowerCase());
        default: return false;
      }
    },
    entityScorePct(scorecard, entity){
      if(!scorecard.criteria||!scorecard.criteria.length)return 0;
      let earned=0,total=0;
      scorecard.criteria.forEach(c=>{const w=c.weight||1;total+=w;if(this.evaluateCriterion(c,entity))earned+=w;});
      return total?Math.round(earned/total*100):0;
    },
    entityGrade(scorecard, entity){
      const pct=this.entityScorePct(scorecard,entity);
      if(pct>=90)return'A';if(pct>=75)return'B';if(pct>=60)return'C';if(pct>=40)return'D';return'F';
    },
    scorecardOverallPct(scorecard){
      let total=0,count=0;
      (scorecard.entityTypes||[]).forEach(t=>{
        this.inventory[t]?.forEach(ent=>{total+=this.entityScorePct(scorecard,ent);count++;});
      });
      return count?Math.round(total/count):0;
    },
    scorecardOverallGrade(scorecard){
      const pct=this.scorecardOverallPct(scorecard);
      if(pct>=90)return'A';if(pct>=75)return'B';if(pct>=60)return'C';if(pct>=40)return'D';return'F';
    },
    entityScorecards(entityType){
      return this.inventory.scorecards.filter(sc=>(sc.entityTypes||[]).includes(entityType));
    },
    gradeColor(grade){
      const m={A:'#1a7a2e',B:'#0069A7',C:'#7a4800',D:'#8a3500',F:'#7a0000'};return m[grade]||'#5a7a96';
    },
    checkTypeLabel(type){
      const m={hasField:'Has Field',hasItems:'Has Items',minItems:'Min Items',fieldEquals:'Field Equals',fieldNotEquals:'Field Not Equals',hasAssignment:'Has Assignment',minAssignments:'Min Assignments',hasAttribute:'Has Attribute',noActiveIncidents:'No Incidents',hasTag:'Has Tag'};return m[type]||type;
    },

    // Impact propagation
    setOpStatus(type,entity,status){
      const idx=this.inventory[type].findIndex(e=>e.id===entity.id);
      if(idx!==-1){this.inventory[type][idx]={...this.inventory[type][idx],operationalStatus:status};this.selectedId=entity.id;this.selectedType=type;}
    },
    productImpactStatus(product){
      const services=(product.serviceIds||[]).map(id=>this.inventory.services.find(s=>s.id===id)).filter(Boolean);
      if(services.some(s=>s.operationalStatus==='outage'))return'outage';
      if(services.some(s=>s.operationalStatus==='degraded'))return'degraded';
      return null;
    },
    impactedServicesForProduct(product){
      return(product.serviceIds||[]).map(id=>this.inventory.services.find(s=>s.id===id)).filter(s=>s&&s.operationalStatus&&s.operationalStatus!=='operational');
    },
    getUpstreamImpacts(entityId, entityType){
      const impacts=[];
      if(entityType==='services'||entityType==='service'){
        this.inventory.products.forEach(p=>{if((p.serviceIds||[]).includes(entityId))impacts.push({...p,operationalStatus:'impacted',_entityType:'products'})});
        this.inventory.services.forEach(s=>{if((s.dependsOnServiceIds||[]).includes(entityId))impacts.push({...s,_entityType:'services'})});
        this.inventory.components.forEach(c=>{if((c.dependsOnServiceIds||[]).includes(entityId))impacts.push({...c,_entityType:'components'})});
      }
      if(entityType==='components'||entityType==='component'){
        this.inventory.services.forEach(s=>{if((s.componentIds||[]).includes(entityId))impacts.push({...s,_entityType:'services'})});
      }
      if(entityType==='resources'||entityType==='resource'){
        this.inventory.services.forEach(s=>{if((s.resourceIds||[]).includes(entityId))impacts.push({...s,_entityType:'services'})});
      }
      return impacts;
    },

    openCreateForm(type){
      this.formType=type;this.formMode='create';
      if(type==='teams'){
        this.formData={name:'',description:'',slackChannel:'',contactEmail:''};
      } else if(type==='scorecards'){
        this.formData={name:'',description:'',entityTypes:[],criteria:[]};
      } else if(type==='incidents'){
        this.formData={title:'',description:'',severity:'major',status:'investigating',impactType:'degraded',affectedEntityIds:[],timeline:[],createdAt:new Date().toISOString(),updatedAt:new Date().toISOString(),resolvedAt:null};
      } else if(type==='repositories'){
        this.formData={name:'',url:'',description:'',provider:'github',defaultBranch:'main',language:'',teamId:'',assignments:[]};
      } else if(type==='owners'){
        this.formData={name:'',email:'',role:'',teamId:''};
      } else {
        this.formData={name:'',description:'',teamId:'',status:'active',operationalStatus:'operational',type:'',version:'',environment:'production',tags:[],tagsRaw:'',serviceIds:[],componentIds:[],resourceIds:[],dependsOnServiceIds:[],dependsOnComponentIds:[],repositoryIds:[],attributes:{},assignments:[]};
      }
      this.showModal=true;
    },
    openEditForm(type,entity){
      this.formType=type;this.formMode='edit';
      this.formData={...JSON.parse(JSON.stringify(entity)),tagsRaw:(entity.tags||[]).join(', '),attributes:{...(entity.attributes||{})}};
      if(!this.formData.serviceIds)this.formData.serviceIds=[];
      if(!this.formData.componentIds)this.formData.componentIds=[];
      if(!this.formData.resourceIds)this.formData.resourceIds=[];
      if(!this.formData.dependsOnServiceIds)this.formData.dependsOnServiceIds=[];
      if(!this.formData.dependsOnComponentIds)this.formData.dependsOnComponentIds=[];
      if(!this.formData.repositoryIds)this.formData.repositoryIds=[];
      if(!this.formData.affectedEntityIds)this.formData.affectedEntityIds=[];
      if(!this.formData.assignments)this.formData.assignments=[];
      if(!this.formData.criteria)this.formData.criteria=[];
      if(!this.formData.entityTypes)this.formData.entityTypes=[];
      this.showModal=true;
    },
    closeModal(){this.showModal=false;this.formData={}},
    saveForm(){
      const nameField=this.formType==='incidents'?'title':'name';
      if(!this.formData[nameField]?.trim()){alert((this.formType==='incidents'?'Title':'Name')+' is required');return}
      if(this.formData.tagsRaw!==undefined){this.formData.tags=this.formData.tagsRaw.split(',').map(t=>t.trim()).filter(Boolean);delete this.formData.tagsRaw}
      if(!this.formData.operationalStatus&&this.formType!=='incidents'&&this.formType!=='repositories'&&this.formType!=='teams'&&this.formType!=='owners')this.formData.operationalStatus='operational';
      // Clean up empty assignments
      if(this.formData.assignments){this.formData.assignments=this.formData.assignments.filter(a=>a.personId&&a.role)}
      // Clean up empty criteria
      if(this.formData.criteria){this.formData.criteria=this.formData.criteria.filter(c=>c.name?.trim())}
      if(this.formType==='incidents'){
        this.formData.updatedAt=new Date().toISOString();
        if(this.formMode==='create'){
          this.formData.timeline=[{timestamp:this.formData.createdAt,status:'investigating',message:'Incident created'}];
        }
      }
      const list=this.inventory[this.formType];
      if(this.formMode==='create'){this.formData.id=this.generateId();list.push({...this.formData})}
      else{const idx=list.findIndex(e=>e.id===this.formData.id);if(idx!==-1)list.splice(idx,1,{...this.formData})}
      // Cascade incident status to affected entities
      if(this.formType==='incidents'){
        const savedInc=this.inventory.incidents.find(i=>i.id===this.formData.id);
        if(savedInc&&savedInc.status!=='resolved'){
          this.cascadeIncidentStatus(savedInc);
        }
        // If editing, recalc entities that may have been removed from affectedEntityIds
        if(this.formMode==='edit'){
          const allEntityIds=new Set();
          this.inventory.incidents.forEach(i=>(i.affectedEntityIds||[]).forEach(eid=>allEntityIds.add(eid)));
          allEntityIds.forEach(eid=>this.recalcEntityStatus(eid));
        }
      }
      this.selectedId=this.formData.id;this.selectedType=this.formType;this.closeModal();
    },
    deleteItem(type,id){
      if(!confirm('Delete this item?'))return;
      // Capture affected entity IDs before deleting an incident
      let incidentAffectedIds=[];
      if(type==='incidents'){
        const inc=this.inventory.incidents.find(i=>i.id===id);
        if(inc)incidentAffectedIds=[...(inc.affectedEntityIds||[])];
      }
      this.inventory[type]=this.inventory[type].filter(e=>e.id!==id);
      if(type==='services'){this.inventory.products.forEach(p=>{if(p.serviceIds)p.serviceIds=p.serviceIds.filter(x=>x!==id)});this.inventory.services.forEach(s=>{if(s.dependsOnServiceIds)s.dependsOnServiceIds=s.dependsOnServiceIds.filter(x=>x!==id)});this.inventory.components.forEach(c=>{if(c.dependsOnServiceIds)c.dependsOnServiceIds=c.dependsOnServiceIds.filter(x=>x!==id)})}
      if(type==='components'){this.inventory.services.forEach(s=>{if(s.componentIds)s.componentIds=s.componentIds.filter(x=>x!==id)});this.inventory.components.forEach(c=>{if(c.dependsOnComponentIds)c.dependsOnComponentIds=c.dependsOnComponentIds.filter(x=>x!==id)})}
      if(type==='resources'){this.inventory.services.forEach(s=>{if(s.resourceIds)s.resourceIds=s.resourceIds.filter(x=>x!==id)})}
      if(type==='owners'){['products','services','components','resources','repositories'].forEach(t=>{this.inventory[t].forEach(e=>{if(e.assignments)e.assignments=e.assignments.filter(a=>a.personId!==id)})});this.inventory.owners.forEach(o=>{if(o.teamId===id)o.teamId=''})}
      if(type==='teams'){['products','services','components','resources','repositories'].forEach(t=>{this.inventory[t].forEach(e=>{if(e.teamId===id)e.teamId=''})});this.inventory.owners.forEach(o=>{if(o.teamId===id)o.teamId=''})}
      if(type==='repositories'){['services','components'].forEach(t=>{this.inventory[t].forEach(e=>{if(e.repositoryIds)e.repositoryIds=e.repositoryIds.filter(x=>x!==id)})})}
      if(type==='incidents'){
        // Recalc status for entities that were affected by the deleted incident
        incidentAffectedIds.forEach(eid=>this.recalcEntityStatus(eid));
      }
      // Clean affected entity refs from incidents when entities are deleted
      if(['services','components','resources'].includes(type)){this.inventory.incidents.forEach(i=>{if(i.affectedEntityIds)i.affectedEntityIds=i.affectedEntityIds.filter(x=>x!==id)})}
      if(this.selectedId===id){this.selectedId=null;this.selectedType=null}
    },

    // Incident lifecycle â€” cascading status
    cascadeIncidentStatus(incident){
      // Set affected entities' operationalStatus based on incident impactType
      if(!incident||incident.status==='resolved')return;
      const targetStatus=incident.impactType==='outage'?'outage':'degraded';
      (incident.affectedEntityIds||[]).forEach(eid=>{
        ['services','components','resources'].forEach(t=>{
          const idx=this.inventory[t].findIndex(e=>e.id===eid);
          if(idx===-1)return;
          const entity=this.inventory[t][idx];
          // Only escalate: operationalâ†’degradedâ†’outage, never downgrade from a worse state
          if(entity.operationalStatus==='outage')return;
          if(entity.operationalStatus==='degraded'&&targetStatus==='degraded')return;
          this.inventory[t].splice(idx,1,{...entity,operationalStatus:targetStatus});
        });
      });
    },
    recalcEntityStatus(entityId){
      // Recalculate an entity's status from all active incidents affecting it
      // Returns the worst status from active incidents, or 'operational' if none
      let worst='operational';
      this.inventory.incidents.forEach(inc=>{
        if(inc.status==='resolved')return;
        if(!(inc.affectedEntityIds||[]).includes(entityId))return;
        if(inc.impactType==='outage')worst='outage';
        else if(inc.impactType==='degraded'&&worst!=='outage')worst='degraded';
      });
      ['services','components','resources'].forEach(t=>{
        const idx=this.inventory[t].findIndex(e=>e.id===entityId);
        if(idx!==-1)this.inventory[t].splice(idx,1,{...this.inventory[t][idx],operationalStatus:worst});
      });
    },
    formatDate(d){if(!d)return'â€”';const dt=new Date(d);return dt.toLocaleString('en-US',{month:'short',day:'numeric',hour:'2-digit',minute:'2-digit'})},
    advanceIncidentStatus(incident,newStatus){
      const idx=this.inventory.incidents.findIndex(i=>i.id===incident.id);
      if(idx===-1)return;
      const now=new Date().toISOString();
      const inc={...this.inventory.incidents[idx]};
      inc.status=newStatus;
      inc.updatedAt=now;
      if(newStatus==='resolved')inc.resolvedAt=now;
      if(!inc.timeline)inc.timeline=[];
      const msgs={identified:'Root cause identified',monitoring:'Fix deployed, monitoring for stability',resolved:'Incident resolved'};
      inc.timeline.push({timestamp:now,status:newStatus,message:msgs[newStatus]||'Status updated to '+newStatus});
      this.inventory.incidents.splice(idx,1,inc);
      // Cascade: if resolved, recalc all affected entities; otherwise, apply impact
      if(newStatus==='resolved'){
        (inc.affectedEntityIds||[]).forEach(eid=>this.recalcEntityStatus(eid));
      } else {
        this.cascadeIncidentStatus(inc);
      }
    },
    reopenIncident(incident){
      const idx=this.inventory.incidents.findIndex(i=>i.id===incident.id);
      if(idx===-1)return;
      const now=new Date().toISOString();
      const inc={...this.inventory.incidents[idx]};
      inc.status='investigating';
      inc.updatedAt=now;
      inc.resolvedAt=null;
      if(!inc.timeline)inc.timeline=[];
      inc.timeline.push({timestamp:now,status:'investigating',message:'Incident reopened'});
      this.inventory.incidents.splice(idx,1,inc);
      // Re-cascade impact to affected entities
      this.cascadeIncidentStatus(inc);
    },
    addTimelineEntry(incident){
      if(!this.timelineMessage?.trim())return;
      const idx=this.inventory.incidents.findIndex(i=>i.id===incident.id);
      if(idx===-1)return;
      const now=new Date().toISOString();
      const inc={...this.inventory.incidents[idx]};
      inc.updatedAt=now;
      if(!inc.timeline)inc.timeline=[];
      inc.timeline.push({timestamp:now,status:inc.status,message:this.timelineMessage.trim()});
      this.inventory.incidents.splice(idx,1,inc);
      this.timelineMessage='';
    },
    exportJSON(){const blob=new Blob([JSON.stringify(this.inventory,null,2)],{type:'application/json'});const url=URL.createObjectURL(blob);const a=document.createElement('a');a.href=url;a.download=`app-inventory-${new Date().toISOString().slice(0,10)}.json`;a.click();URL.revokeObjectURL(url)},
    triggerImport(){this.$refs.fileInput.click()},
    handleImport(event){const file=event.target.files[0];if(!file)return;const reader=new FileReader();reader.onload=(e)=>{try{const data=JSON.parse(e.target.result);if(typeof data.owners!=='undefined'||typeof data.teams!=='undefined'){this.inventory={owners:data.owners||[],teams:data.teams||[],products:data.products||[],services:data.services||[],components:data.components||[],resources:data.resources||[],repositories:data.repositories||[],incidents:data.incidents||[],scorecards:data.scorecards||[]};this.selectedId=null;this.selectedType=null}else{alert('Invalid inventory file')}}catch{alert('Failed to parse JSON')}};reader.readAsText(file);event.target.value=''},
    async loadSampleData(){if(this.inventory.products.length&&!confirm('Replace with sample data?'))return;try{const resp=await fetch('sample-data.json');if(!resp.ok)throw new Error('HTTP '+resp.status);const data=await resp.json();this.inventory={owners:data.owners||[],teams:data.teams||[],products:data.products||[],services:data.services||[],components:data.components||[],resources:data.resources||[],repositories:data.repositories||[],incidents:data.incidents||[],scorecards:data.scorecards||[]}}catch(e){alert('Failed to load sample data: '+e.message)}},

    toggleStatusProduct(id){
      const i=this.expandedStatusProducts.indexOf(id);
      if(i===-1)this.expandedStatusProducts.push(id);
      else this.expandedStatusProducts.splice(i,1);
    },

    // Graph
    toggleGraphFilter(f){
      if(f==='incidents_only'){
        const i=this.graphFilters.indexOf('incidents_only');
        if(i===-1)this.graphFilters.push('incidents_only');else this.graphFilters.splice(i,1);
      } else {
        const i=this.graphFilters.indexOf(f);
        if(i===-1)this.graphFilters.push(f);else if(this.graphFilters.filter(x=>x!=='incidents_only').length>1)this.graphFilters.splice(i,1);
      }
      this.$nextTick(()=>this.initGraph());
    },
    resetGraphZoom(){if(!this._zoom||!this.$refs.graphSvg)return;const W=this.$refs.graphContainer.clientWidth,H=this.$refs.graphContainer.clientHeight;d3.select(this.$refs.graphSvg).transition().duration(600).call(this._zoom.transform,d3.zoomIdentity.translate(W/2,H/2).scale(1))},

    // Product-specific dependency graph
    initProductGraph(product){
      const container=this.$refs.productGraphContainer,svgEl=this.$refs.productGraphSvg;
      if(!container||!svgEl)return;
      const W=container.clientWidth||600,H=container.clientHeight||340;
      if(this.productGraphSimulation)this.productGraphSimulation.stop();
      d3.select(svgEl).selectAll('*').remove();
      const svg=d3.select(svgEl).attr('width',W).attr('height',H).style('background','#f5f7fa');

      // Build scoped nodes/links: product -> its services -> their components, resources, service-deps
      // For service dependencies, if the dep belongs to ANOTHER product, show that product as a boundary node
      const nodes=[],links=[],ids=new Set();
      const productServiceIds=new Set(product.serviceIds||[]);

      // Product node
      nodes.push({id:product.id,name:product.name,entityType:'product',type:null,opStatus:'operational'});
      ids.add(product.id);

      // Services of this product
      (product.serviceIds||[]).forEach(sid=>{
        const svc=this.inventory.services.find(s=>s.id===sid);
        if(!svc)return;
        nodes.push({id:svc.id,name:svc.name,entityType:'service',type:svc.type,opStatus:svc.operationalStatus||'operational'});
        ids.add(svc.id);
        links.push({source:product.id,target:svc.id,type:'product-service'});
      });

      // Components, resources, and service deps for each service of THIS product
      (product.serviceIds||[]).forEach(sid=>{
        const svc=this.inventory.services.find(s=>s.id===sid);
        if(!svc)return;
        // Components
        (svc.componentIds||[]).forEach(cid=>{
          const cmp=this.inventory.components.find(c=>c.id===cid);
          if(!cmp)return;
          if(!ids.has(cmp.id)){nodes.push({id:cmp.id,name:cmp.name,entityType:'component',type:cmp.type,opStatus:cmp.operationalStatus||'operational'});ids.add(cmp.id);}
          links.push({source:svc.id,target:cmp.id,type:'service-component'});
          // Component deps on other components
          (cmp.dependsOnComponentIds||[]).forEach(depId=>{
            const dep=this.inventory.components.find(c=>c.id===depId);
            if(!dep)return;
            if(!ids.has(dep.id)){nodes.push({id:dep.id,name:dep.name,entityType:'component',type:dep.type,opStatus:dep.operationalStatus||'operational'});ids.add(dep.id);}
            links.push({source:cmp.id,target:dep.id,type:'comp-dep'});
          });
        });
        // Resources
        (svc.resourceIds||[]).forEach(rid=>{
          const res=this.inventory.resources.find(r=>r.id===rid);
          if(!res)return;
          if(!ids.has(res.id)){nodes.push({id:res.id,name:res.name,entityType:'resource',type:res.type,opStatus:res.operationalStatus||'operational'});ids.add(res.id);}
          links.push({source:svc.id,target:res.id,type:'runs-on'});
        });
        // Service dependencies
        (svc.dependsOnServiceIds||[]).forEach(depId=>{
          const depSvc=this.inventory.services.find(s=>s.id===depId);
          if(!depSvc)return;
          if(productServiceIds.has(depId)){
            // Internal dependency within this product
            links.push({source:svc.id,target:depId,type:'service-dep'});
          } else {
            // External: belongs to another product - show that product as boundary
            const otherProduct=this.inventory.products.find(p=>p.id!==product.id&&(p.serviceIds||[]).includes(depId));
            if(otherProduct){
              if(!ids.has(otherProduct.id)){nodes.push({id:otherProduct.id,name:otherProduct.name,entityType:'product',type:null,opStatus:this.productImpactStatus(otherProduct)||'operational',boundary:true});ids.add(otherProduct.id);}
              links.push({source:svc.id,target:otherProduct.id,type:'product-boundary'});
            } else {
              // Service not in any product, show it directly
              if(!ids.has(depSvc.id)){nodes.push({id:depSvc.id,name:depSvc.name,entityType:'service',type:depSvc.type,opStatus:depSvc.operationalStatus||'operational',external:true});ids.add(depSvc.id);}
              links.push({source:svc.id,target:depId,type:'service-dep'});
            }
          }
        });
      });

      if(!nodes.length){svg.append('text').attr('x',W/2).attr('y',H/2).attr('text-anchor','middle').attr('fill','#5a7a96').attr('font-family',"'Poppins',sans-serif").attr('font-size','13px').text('No dependencies to display.');return;}

      const defs=svg.append('defs');
      [['pg-arr1','#003057',24],['pg-arr2','#2C9942',16],['pg-arr3','#c07000',16],['pg-arr4','#5a7a96',24]].forEach(([id,fill,refX])=>{
        defs.append('marker').attr('id',id).attr('viewBox','0 -4 8 8').attr('refX',refX).attr('refY',0).attr('markerWidth',5).attr('markerHeight',5).attr('orient','auto').append('path').attr('d','M0,-4L8,0L0,4').attr('fill',fill);
      });
      const glow=defs.append('filter').attr('id','pg-glow').attr('x','-50%').attr('y','-50%').attr('width','200%').attr('height','200%');
      glow.append('feGaussianBlur').attr('stdDeviation','2').attr('result','coloredBlur');
      const fm=glow.append('feMerge');fm.append('feMergeNode').attr('in','coloredBlur');fm.append('feMergeNode').attr('in','SourceGraphic');

      const g=svg.append('g');
      const zoom=d3.zoom().scaleExtent([0.3,4]).on('zoom',e=>g.attr('transform',e.transform));
      svg.call(zoom).call(zoom.transform,d3.zoomIdentity.translate(W/2,H/2).scale(0.85));

      const vm=this;
      this.productGraphSimulation=d3.forceSimulation(nodes)
        .force('link',d3.forceLink(links).id(d=>d.id).distance(d=>d.type==='product-service'?100:d.type==='runs-on'?60:d.type==='product-boundary'?140:75).strength(0.7))
        .force('charge',d3.forceManyBody().strength(-300))
        .force('center',d3.forceCenter(0,0))
        .force('collide',d3.forceCollide(d=>this.getNodeRadius(d)+20));

      const link=g.append('g').selectAll('line').data(links).join('line')
        .attr('stroke',d=>d.type==='product-service'?'#00305760':d.type==='service-component'?'#0069A750':d.type==='service-dep'?'#2C994260':d.type==='runs-on'?'#c0700050':d.type==='product-boundary'?'#5a7a9660':'#d4650a50')
        .attr('stroke-width',d=>d.type==='product-service'?2:1.5)
        .attr('stroke-dasharray',d=>d.type==='service-dep'||d.type==='comp-dep'?'5,4':d.type==='runs-on'?'2,3':d.type==='product-boundary'?'8,4':null)
        .attr('marker-end',d=>d.type==='service-dep'||d.type==='comp-dep'?'url(#pg-arr2)':d.type==='runs-on'?'url(#pg-arr3)':d.type==='product-boundary'?'url(#pg-arr4)':'url(#pg-arr1)');

      const node=g.append('g').selectAll('g').data(nodes).join('g').attr('cursor','pointer')
        .call(d3.drag()
          .on('start',(e,d)=>{if(!e.active)vm.productGraphSimulation.alphaTarget(0.3).restart();d.fx=d.x;d.fy=d.y})
          .on('drag',(e,d)=>{d.fx=e.x;d.fy=e.y})
          .on('end',(e,d)=>{if(!e.active)vm.productGraphSimulation.alphaTarget(0);d.fx=null;d.fy=null}))
        .on('click',(e,d)=>{
          e.stopPropagation();
          const tt=d.entityType+'s';
          vm.navigate(tt);
          const ent=vm.inventory[tt]?.find(x=>x.id===d.id);
          if(ent)vm.selectItem(tt,ent);
        });

      // Pulse for degraded/outage
      node.filter(d=>d.opStatus==='degraded'||d.opStatus==='outage').append('circle')
        .attr('r',d=>vm.getNodeRadius(d)+5).attr('fill','none')
        .attr('stroke',d=>d.opStatus==='outage'?'#c0392b':'#e08c00').attr('stroke-width',1.5)
        .each(function(d){const el=d3.select(this);const baseR=vm.getNodeRadius(d)+5;(function pulse(){el.attr('r',baseR).attr('opacity',0.5).transition().duration(800).attr('r',baseR+6).attr('opacity',0.05).transition().duration(800).attr('r',baseR).attr('opacity',0.5).on('end',pulse)})()});

      // Boundary product nodes get dashed outline
      node.filter(d=>d.boundary).append('circle').attr('r',d=>vm.getNodeRadius(d)+3).attr('fill','none').attr('stroke','#5a7a96').attr('stroke-width',1.5).attr('stroke-dasharray','4,3');

      // Node circles
      node.append('circle').attr('r',d=>vm.getNodeRadius(d))
        .attr('fill',d=>vm.getNodeColor(d)+(d.opStatus==='outage'?'33':d.opStatus==='degraded'?'44':d.boundary?'11':'22'))
        .attr('stroke',d=>d.opStatus==='outage'?'#c0392b':d.opStatus==='degraded'?'#e08c00':d.boundary?'#5a7a96':vm.getNodeColor(d))
        .attr('stroke-width',d=>d.entityType==='product'?2.5:1.8)
        .attr('filter','url(#pg-glow)');

      // Inner shapes
      node.filter(d=>d.entityType!=='product'&&d.entityType!=='resource').append('circle').attr('r',d=>vm.getNodeRadius(d)*.45).attr('fill',d=>vm.getNodeColor(d));
      node.filter(d=>d.entityType==='product').append('rect').attr('x',-6).attr('y',-6).attr('width',12).attr('height',12).attr('rx',2).attr('fill',d=>d.boundary?'#5a7a96':vm.getNodeColor(d)).attr('transform','rotate(45)');
      node.filter(d=>d.entityType==='resource').append('rect').attr('x',d=>-vm.getNodeRadius(d)*.4).attr('y',d=>-vm.getNodeRadius(d)*.4).attr('width',d=>vm.getNodeRadius(d)*.8).attr('height',d=>vm.getNodeRadius(d)*.8).attr('rx',2).attr('fill',d=>vm.getNodeColor(d));

      // Status dots
      node.filter(d=>d.opStatus==='degraded'||d.opStatus==='outage').append('circle')
        .attr('r',3.5).attr('cx',d=>vm.getNodeRadius(d)-2).attr('cy',d=>-vm.getNodeRadius(d)+2)
        .attr('fill',d=>d.opStatus==='outage'?'#c0392b':'#e08c00').attr('stroke','#fff').attr('stroke-width',1.5);

      // Labels
      node.append('text').attr('dy',d=>vm.getNodeRadius(d)+12).attr('text-anchor','middle')
        .attr('fill',d=>d.boundary?'#5a7a96':'#003057').attr('font-family',"'Poppins',sans-serif")
        .attr('font-size',d=>d.entityType==='product'?11:9).attr('font-weight',d=>d.entityType==='product'?600:400)
        .text(d=>d.name.length>20?d.name.slice(0,18)+'\u2026':d.name);

      this.productGraphSimulation.on('tick',()=>{
        link.attr('x1',d=>d.source.x).attr('y1',d=>d.source.y).attr('x2',d=>d.target.x).attr('y2',d=>d.target.y);
        node.attr('transform',d=>`translate(${d.x},${d.y})`);
      });
    },

    getNodeColor(n){
      if(n.entityType==='product')return'#003057';
      if(n.entityType==='service')return typeColors.service[n.type]||'#0069A7';
      if(n.entityType==='resource')return typeColors.resource[n.type]||'#c07000';
      return typeColors.component[n.type]||'#d4650a';
    },
    getNodeRadius(n){
      if(n.entityType==='product')return 22;
      if(n.entityType==='service')return 17;
      if(n.entityType==='resource')return 13;
      return 11;
    },
    getOpStatus(n){
      const allItems=[...this.inventory.services,...this.inventory.components,...this.inventory.resources];
      const found=allItems.find(e=>e.id===n.id);
      return found?.operationalStatus||'operational';
    },

    buildGraphData(){
      const nodes=[],links=[],ids=new Set();
      const incOnly=this.graphFilters.includes('incidents_only');
      const incidentIds=new Set([...this.degradedItems,...this.outageItems].map(e=>e.id));
      // Also add upstream of incidents
      if(incOnly){
        [...this.degradedItems,...this.outageItems].forEach(e=>{
          this.getUpstreamImpacts(e.id,e._entityType).forEach(u=>incidentIds.add(u.id));
        });
      }
      const shouldShow=(id)=>!incOnly||incidentIds.has(id);

      if(this.graphFilters.includes('product'))this.inventory.products.forEach(p=>{if(shouldShow(p.id)){nodes.push({id:p.id,name:p.name,entityType:'product',type:null,teamId:p.teamId,opStatus:'operational'});ids.add(p.id)}});
      if(this.graphFilters.includes('service'))this.inventory.services.forEach(s=>{if(shouldShow(s.id)){nodes.push({id:s.id,name:s.name,entityType:'service',type:s.type,teamId:s.teamId,opStatus:s.operationalStatus||'operational'});ids.add(s.id)}});
      if(this.graphFilters.includes('component'))this.inventory.components.forEach(c=>{if(shouldShow(c.id)){nodes.push({id:c.id,name:c.name,entityType:'component',type:c.type,teamId:c.teamId,opStatus:c.operationalStatus||'operational'});ids.add(c.id)}});
      if(this.graphFilters.includes('resource'))this.inventory.resources.forEach(r=>{if(shouldShow(r.id)){nodes.push({id:r.id,name:r.name,entityType:'resource',type:r.type,teamId:r.teamId,opStatus:r.operationalStatus||'operational'});ids.add(r.id)}});

      if(this.graphFilters.includes('product')&&this.graphFilters.includes('service'))this.inventory.products.forEach(p=>(p.serviceIds||[]).forEach(sid=>{if(ids.has(p.id)&&ids.has(sid))links.push({source:p.id,target:sid,type:'product-service'})}));
      if(this.graphFilters.includes('service')&&this.graphFilters.includes('component'))this.inventory.services.forEach(s=>(s.componentIds||[]).forEach(cid=>{if(ids.has(s.id)&&ids.has(cid))links.push({source:s.id,target:cid,type:'service-component'})}));
      if(this.graphFilters.includes('service'))this.inventory.services.forEach(s=>(s.dependsOnServiceIds||[]).forEach(sid=>{if(ids.has(s.id)&&ids.has(sid))links.push({source:s.id,target:sid,type:'service-dep'})}));
      if(this.graphFilters.includes('component'))this.inventory.components.forEach(c=>(c.dependsOnComponentIds||[]).forEach(cid=>{if(ids.has(c.id)&&ids.has(cid))links.push({source:c.id,target:cid,type:'comp-dep'})}));
      if(this.graphFilters.includes('component')&&this.graphFilters.includes('service'))this.inventory.components.forEach(c=>(c.dependsOnServiceIds||[]).forEach(sid=>{if(ids.has(c.id)&&ids.has(sid))links.push({source:c.id,target:sid,type:'service-dep'})}));
      if(this.graphFilters.includes('service')&&this.graphFilters.includes('resource'))this.inventory.services.forEach(s=>(s.resourceIds||[]).forEach(rid=>{if(ids.has(s.id)&&ids.has(rid))links.push({source:s.id,target:rid,type:'runs-on'})}));

      return{nodes,links};
    },

    initGraph(){
      const container=this.$refs.graphContainer,svgEl=this.$refs.graphSvg;
      if(!container||!svgEl)return;
      const W=container.clientWidth,H=container.clientHeight;
      const{nodes,links}=this.buildGraphData();
      d3.select(svgEl).selectAll('*').remove();
      const svg=d3.select(svgEl).attr('width',W).attr('height',H).style('background','#f5f7fa');
      const defs=svg.append('defs');
      const pat=defs.append('pattern').attr('id','grid').attr('width',40).attr('height',40).attr('patternUnits','userSpaceOnUse');
      pat.append('path').attr('d','M 40 0 L 0 0 0 40').attr('fill','none').attr('stroke','#b0c8de30').attr('stroke-width','1');
      svg.append('rect').attr('width','100%').attr('height','100%').attr('fill','url(#grid)');

      // Arrow markers
      [['arr1','#003057',28],['arr2','#2C9942',18],['arr3','#c07000',18]].forEach(([id,fill,refX])=>{
        defs.append('marker').attr('id',id).attr('viewBox','0 -4 8 8').attr('refX',refX).attr('refY',0).attr('markerWidth',5).attr('markerHeight',5).attr('orient','auto').append('path').attr('d','M0,-4L8,0L0,4').attr('fill',fill);
      });

      // Glow filter
      const glow=defs.append('filter').attr('id','glow').attr('x','-50%').attr('y','-50%').attr('width','200%').attr('height','200%');
      glow.append('feGaussianBlur').attr('stdDeviation','3').attr('result','coloredBlur');
      const fm=glow.append('feMerge');fm.append('feMergeNode').attr('in','coloredBlur');fm.append('feMergeNode').attr('in','SourceGraphic');

      const g=svg.append('g');
      const zoom=d3.zoom().scaleExtent([0.05,5]).on('zoom',e=>g.attr('transform',e.transform));
      this._zoom=zoom;svg.call(zoom).call(zoom.transform,d3.zoomIdentity.translate(W/2,H/2));
      if(this.simulation)this.simulation.stop();
      if(!nodes.length){svg.append('text').attr('x',W/2).attr('y',H/2).attr('text-anchor','middle').attr('fill','#5a7a96').attr('font-family',"'Poppins',sans-serif").attr('font-size','14px').text('No entities to display.');return}

      this.simulation=d3.forceSimulation(nodes)
        .force('link',d3.forceLink(links).id(d=>d.id).distance(d=>d.type==='product-service'?130:d.type==='runs-on'?70:90).strength(0.6))
        .force('charge',d3.forceManyBody().strength(-400))
        .force('center',d3.forceCenter(0,0))
        .force('collide',d3.forceCollide(d=>this.getNodeRadius(d)+26));

      const link=g.append('g').selectAll('line').data(links).join('line')
        .attr('stroke',d=>d.type==='product-service'?'#00305750':d.type==='service-component'?'#0069A740':d.type==='service-dep'?'#2C994250':d.type==='runs-on'?'#c0700040':'#d4650a40')
        .attr('stroke-width',d=>d.type==='product-service'?2:1.5)
        .attr('stroke-dasharray',d=>(d.type==='service-dep'||d.type==='comp-dep')?'5,4':d.type==='runs-on'?'2,3':null)
        .attr('marker-end',d=>d.type==='service-dep'||d.type==='comp-dep'?'url(#arr2)':d.type==='runs-on'?'url(#arr3)':'url(#arr1)');

      const vm=this;
      const node=g.append('g').selectAll('g').data(nodes).join('g').attr('cursor','pointer')
        .call(d3.drag()
          .on('start',(e,d)=>{if(!e.active)vm.simulation.alphaTarget(0.3).restart();d.fx=d.x;d.fy=d.y})
          .on('drag',(e,d)=>{d.fx=e.x;d.fy=e.y})
          .on('end',(e,d)=>{if(!e.active)vm.simulation.alphaTarget(0);d.fx=null;d.fy=null}))
        .on('click',(e,d)=>{
          e.stopPropagation();
          const tt=d.entityType+'s';
          vm.navigate(tt);
          const ent=vm.inventory[tt]?.find(x=>x.id===d.id);
          if(ent)vm.selectItem(tt,ent);
        })
        .on('mouseover',(e,d)=>{
          const t=vm.$refs.graphTooltip;
          vm.$refs.tooltipName.textContent=d.name;
          vm.$refs.tooltipType.textContent=d.entityType==='product'?'Product':d.entityType==='service'?typeLabels.service[d.type]||d.type:d.entityType==='resource'?typeLabels.resource[d.type]||d.type:typeLabels.component[d.type]||d.type;
          const statusEl=vm.$refs.tooltipStatus;
          if(d.opStatus&&d.opStatus!=='operational'){statusEl.textContent=d.opStatus.toUpperCase();statusEl.className='graph-tooltip-status '+d.opStatus}else{statusEl.textContent='';statusEl.className=''}
          vm.$refs.tooltipOwner.textContent=d.teamId?'Team: '+vm.teamName(d.teamId):'';
          t.classList.add('visible');
        })
        .on('mousemove',(e)=>{const t=vm.$refs.graphTooltip,r=container.getBoundingClientRect();t.style.left=(e.clientX-r.left+14)+'px';t.style.top=(e.clientY-r.top-10)+'px'})
        .on('mouseout',()=>vm.$refs.graphTooltip.classList.remove('visible'));

      // Pulse ring for degraded/outage nodes
      node.filter(d=>d.opStatus==='degraded'||d.opStatus==='outage').append('circle')
        .attr('r',d=>vm.getNodeRadius(d)+6)
        .attr('fill','none')
        .attr('stroke',d=>d.opStatus==='outage'?'#c0392b':'#e08c00')
        .attr('stroke-width',2)
        .attr('opacity',0.5)
        .style('animation',d=>`${d.opStatus==='outage'?'pulse-ring-outage':'pulse-ring-degraded'} 1.5s ease-in-out infinite`);

      // Add CSS animation for pulse rings inline
      if(!document.getElementById('pulse-style')){
        const style=document.createElement('style');
        style.id='pulse-style';
        style.textContent=`
          @keyframes pulse-ring-degraded{0%,100%{r:${0};opacity:.6;transform:scale(1)}50%{opacity:.1;transform:scale(1.5)}}
          @keyframes pulse-ring-outage{0%,100%{opacity:.8;transform:scale(1)}50%{opacity:.1;transform:scale(1.6)}}
        `;
        document.head.appendChild(style);
      }

      // Use JS animation for pulse rings (D3 approach)
      node.filter(d=>d.opStatus==='degraded'||d.opStatus==='outage').selectAll('circle:first-child')
        .each(function(d){
          const el=d3.select(this);
          const baseR=vm.getNodeRadius(d)+6;
          const color=d.opStatus==='outage'?'#c0392b':'#e08c00';
          (function pulse(){
            el.attr('r',baseR).attr('opacity',0.6).attr('stroke',color)
              .transition().duration(900).attr('r',baseR+8).attr('opacity',0.05)
              .transition().duration(900).attr('r',baseR).attr('opacity',0.6)
              .on('end',pulse);
          })();
        });

      // Node background circles
      node.append('circle').attr('r',d=>vm.getNodeRadius(d)).attr('fill',d=>vm.getNodeColor(d)+(d.opStatus==='outage'?'33':d.opStatus==='degraded'?'44':'22')).attr('stroke',d=>d.opStatus==='outage'?'#c0392b':d.opStatus==='degraded'?'#e08c00':vm.getNodeColor(d)).attr('stroke-width',d=>d.entityType==='product'?2.5:1.8).attr('filter','url(#glow)');

      // Inner fill
      node.filter(d=>d.entityType!=='product'&&d.entityType!=='resource').append('circle').attr('r',d=>vm.getNodeRadius(d)*0.45).attr('fill',d=>vm.getNodeColor(d));
      // Product diamond
      node.filter(d=>d.entityType==='product').append('rect').attr('x',-7).attr('y',-7).attr('width',14).attr('height',14).attr('rx',2).attr('fill',d=>vm.getNodeColor(d)).attr('transform','rotate(45)');
      // Resource square
      node.filter(d=>d.entityType==='resource').append('rect').attr('x',d=>-vm.getNodeRadius(d)*0.45).attr('y',d=>-vm.getNodeRadius(d)*0.45).attr('width',d=>vm.getNodeRadius(d)*0.9).attr('height',d=>vm.getNodeRadius(d)*0.9).attr('rx',2).attr('fill',d=>vm.getNodeColor(d));

      // Status indicator dot for incidents
      node.filter(d=>d.opStatus==='degraded'||d.opStatus==='outage').append('circle')
        .attr('r',4).attr('cx',d=>vm.getNodeRadius(d)-3).attr('cy',d=>-vm.getNodeRadius(d)+3)
        .attr('fill',d=>d.opStatus==='outage'?'#c0392b':'#e08c00').attr('stroke','#fff').attr('stroke-width',1.5);

      // Labels
      node.append('text').attr('dy',d=>vm.getNodeRadius(d)+13).attr('text-anchor','middle').attr('fill','#003057').attr('font-family',"'Poppins',sans-serif").attr('font-size',d=>d.entityType==='product'?12:10).attr('font-weight',d=>d.entityType==='product'?600:400).text(d=>d.name.length>22?d.name.slice(0,20)+'â€¦':d.name);

      this.simulation.on('tick',()=>{
        link.attr('x1',d=>d.source.x).attr('y1',d=>d.source.y).attr('x2',d=>d.target.x).attr('y2',d=>d.target.y);
        node.attr('transform',d=>`translate(${d.x},${d.y})`);
      });
    }
  },

  mounted(){try{const saved=localStorage.getItem('appInventory');if(saved){const d=JSON.parse(saved);this.inventory={owners:d.owners||[],teams:d.teams||[],products:d.products||[],services:d.services||[],components:d.components||[],resources:d.resources||[],repositories:d.repositories||[],incidents:d.incidents||[],scorecards:d.scorecards||[]}}}catch(e){}}
}).mount('#app');
</script>
</body>
</html>